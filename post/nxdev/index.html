<html>
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Jasonfan Blog</title>
<meta name="description" content="每个人的生活都是一条通向自身的道路，找到自我，在心中坚守一生，全心全意，永不停息 🌱🌱🌱" />
<link rel="shortcut icon" href="https://fanguyun214.github.io/favicon.ico?v=1614135863875">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link href="https://cdn.jsdelivr.net/npm/remixicon@2.3.0/fonts/remixicon.css" rel="stylesheet">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Droid+Serif:400,700">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.2/animate.min.css">

<link rel="stylesheet" href="https://fanguyun214.github.io/styles/main.css">



  </head>
  <body>
    <div id="app" class="main px-4 flex flex-col lg:flex-row">
      <div id="sidebar" class="sidebar-wrapper lg:static lg:w-1/4">
  <div class="lg:sticky top-0">
    <div class="sidebar-content">
      <div class="flex lg:block p-4 lg:px-0 items-center fixed lg:static lg:block top-0 right-0 left-0 bg-white z-50">
        <i class="ri-menu-2-line lg:mt-4 text-2xl cursor-pointer animated fadeIn" onclick="openMenu()"></i>
        <a href="https://fanguyun214.github.io">
          <img class="animated fadeInLeft avatar rounded-lg mx-4 lg:mt-32 lg:mx-0 mt-0 lg:w-24 lg:h-24 w-12 w-12" src="https://fanguyun214.github.io/images/avatar.png?v=1614135863875" alt="">
        </a>
        <h1 class="animated fadeInLeft lg:text-4xl font-extrabold lg:mt-8 mt-0 text-xl" style="animation-delay: 0.2s">Jasonfan Blog</h1>
      </div>
      
        <div class="animated fadeInLeft" style="animation-delay: 0.4s">
          <p class="my-4 text-gray-600 font-light hidden lg:block">
            文章目录
          </p>
          <div class="toc-container hidden lg:block">
            <ul class="markdownIt-TOC">
<li>
<ul>
<li>
<ul>
<li><a href="#tldr">TLDR</a></li>
<li><a href="#%E5%88%9B%E5%BB%BAnx%E5%B7%A5%E4%BD%9C%E5%8C%BA">创建Nx工作区</a></li>
<li><a href="#%E6%B7%BB%E5%8A%A0%E5%8A%9F%E8%83%BD">添加功能</a></li>
<li><a href="#%E5%88%9B%E5%BB%BA%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F">创建第一个应用程序</a></li>
<li><a href="#%E8%BF%90%E8%A1%8C%E5%BA%94%E7%94%A8">运行应用</a></li>
<li><a href="#%E6%9E%84%E5%BB%BA%E5%A4%9A%E5%BA%94%E7%94%A8%E5%B7%A5%E4%BD%9C%E5%8C%BA">构建多应用工作区</a>
<ul>
<li><a href="#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%A9%BA%E5%B7%A5%E4%BD%9C%E5%8C%BA">创建一个空工作区</a></li>
<li><a href="#%E5%88%9B%E5%BB%BA%E5%89%8D%E7%AB%AF%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F">创建前端应用程序</a></li>
<li><a href="#%E5%88%9B%E5%BB%BAapi%E5%BA%94%E7%94%A8%E5%B9%B6%E5%9C%A8%E5%89%8D%E7%AB%AF%E5%BC%95%E5%85%A5api">创建API应用并在前端引入API</a></li>
<li><a href="#%E6%B7%BB%E5%8A%A0api%E6%8E%A5%E5%8F%A3">添加API接口</a></li>
</ul>
</li>
<li><a href="#%E5%9C%A8%E5%89%8D%E7%AB%AF%E5%92%8C%E5%90%8E%E7%AB%AF%E4%B9%8B%E9%97%B4%E5%85%B1%E4%BA%AB%E4%BB%A3%E7%A0%81">在前端和后端之间共享代码</a></li>
<li><a href="#%E5%BA%94%E7%94%A8%E4%BE%9D%E8%B5%96%E5%85%B3%E7%B3%BB">应用依赖关系</a></li>
<li><a href="#%E5%88%9B%E5%BB%BAlibs">创建Libs</a>
<ul>
<li><a href="#%E5%85%AC%E5%85%B1api">公共API</a></li>
<li><a href="#ui-libs">UI Libs</a></li>
<li><a href="#%E6%B7%BB%E5%8A%A0%E7%BB%84%E4%BB%B6">添加组件</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8ui%E5%BA%93app%E6%8C%82%E8%BD%BDlib">使用UI库，app挂载lib</a></li>
</ul>
</li>
<li><a href="#app%E5%92%8Clibs">app和Libs</a></li>
<li><a href="#%E6%87%92%E5%8A%A0%E8%BD%BD%E5%BA%93">懒加载库</a></li>
<li><a href="#%E5%BF%AB%E6%8D%B7%E4%BD%BF%E7%94%A8">快捷使用</a>
<ul>
<li><a href="#%E5%88%9B%E5%BB%BA-app-%E5%92%8C-lib">创建 app 和 lib</a></li>
<li><a href="#%E4%BF%AE%E6%94%B9-angularjson">修改 angular.json：</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      
    </div>
  </div>
</div>

<div class="menu-container">
  <i class="ri-arrow-left-line text-2xl cursor-pointer animated fadeIn close-menu-btn" onclick="closeMenu()"></i>
  <div>
    
      
        <a href="/" class="menu" style="animation-delay: 0s">
          首页
        </a>
      
    
      
        <a href="/archives" class="menu" style="animation-delay: 0.2s">
          归档
        </a>
      
    
      
        <a href="/tags" class="menu" style="animation-delay: 0.4s">
          标签
        </a>
      
    
      
        <a href="/post/about" class="menu" style="animation-delay: 0.6000000000000001s">
          关于
        </a>
      
    
  </div>
  <div class="site-footer">
    <div class="py-4 text-gray-700">Powered by Jasonfan & Grider  🖥</div>
    <a class="rss" href="https://fanguyun214.github.io/atom.xml" target="_blank">RSS</a>
  </div>
</div>
<div class="mask" onclick="closeMenu()">
</div>
      <div class="content-wrapper py-32 lg:p-8 lg:w-3/4 post-detail animated fadeIn">
        <h1 class="text-3xl font-bold lg:mt-16">Nx:构建企业级Monorepo应用程序的新方法</h1>
        <div class="text-sm text-gray-700 lg:my-8">
          2019-07-25 / 16 min read
        </div>
        
          <img class="post-feature-image rounded-lg mx-auto my-4" src="https://fanguyun214.github.io/post-images/nxdev.png" alt="">
        
        <div class="post-content yue">
          <p>现代Web开发工具。</p>
<!-- more -->
<p>使用Nx，您可以：</p>
<ul>
<li>使用Cypress，Jest，Prettier，TypeScript等现代工具......</li>
<li>使用Angular和Node.js构建全栈应用程序</li>
<li>使用Google，Facebook和Microsoft开创的有效开发实践</li>
</ul>
<h3 id="tldr">TLDR</h3>
<pre><code>npx create-nx-workspace myapp --preset=angular
cd myapp
ng serve myapp
</code></pre>
<h3 id="创建nx工作区">创建Nx工作区</h3>
<p>运用 npx</p>
<pre><code>npx create-nx-workspace@latest myworkspace
</code></pre>
<p>运用npm init</p>
<pre><code>npm init nx-workspace myworkspace
</code></pre>
<p>运用yarn create</p>
<pre><code>yarn create nx-workspace myworkspace
</code></pre>
<p><em><strong>添加到现有Angular CLI工作区</strong></em><br>
如果您已经有一个常规的Angular CLI项目，则可以通过运行以下命令来添加Nx：</p>
<pre><code>ng add @nrwl/workspace
</code></pre>
<h3 id="添加功能">添加功能</h3>
<p>如果您尚未指定任何预设，您将获得一个空的Nx工作区。没有用于构建，服务和测试的应用程序。您可以运行以下命令向工作区添加功能：<br>
运用 npm</p>
<pre><code>npm install --dev @nrwl/angular # Adds Angular capabilities
npm install --dev @nrwl/web # Adds Web capabilities
npm install --dev @nrwl/react # Adds React capabilities
npm install --dev @nrwl/node # Adds Node capabilities
npm install --dev @nrwl/express # Adds Express capabilities
npm install --dev @nrwl/nest # Adds Nest capabilities
</code></pre>
<p>运用yarn</p>
<pre><code>yarn add --dev @nrwl/react # Adds React capabilities
yarn add --dev @nrwl/web # Adds Web capabilities
yarn add --dev @nrwl/angular # Adds Angular capabilities
yarn add --dev @nrwl/node # Adds Node capabilities
yarn add --dev @nrwl/express # Adds Express capabilities
yarn add --dev @nrwl/nest # Adds Nest capabilities
</code></pre>
<p>运用ng add</p>
<pre><code>ng add @nrwl/angular # Adds Angular capabilities
ng add @nrwl/web # Adds Web capabilities
ng add @nrwl/react # Adds React capabilities
ng add @nrwl/node # Adds Node capabilities
ng add @nrwl/express # Adds Express capabilities
ng add @nrwl/nest # Adds Nest capabilities
</code></pre>
<h3 id="创建第一个应用程序">创建第一个应用程序</h3>
<p>添加功能后，您现在可以通过以下方式创建第一个应用程序</p>
<pre><code>ng g @nrwl/angular:application myapp
</code></pre>
<p>结果将如下所示：</p>
<pre><code>&lt;workspace name&gt;/
├── apps/
│   ├── myapp/
│   │   ├── src/
│   │   │   ├── app/
│   │   │   ├── assets/
│   │   │   ├── environments/
│   │   │   ├── favicon.ico
│   │   │   ├── index.html
│   │   │   ├── main.ts
│   │   │   ├── polyfills.ts
│   │   │   ├── styles.scss
│   │   │   └── test.ts
│   │   ├── browserslist
│   │   ├── jest.config.js
│   │   ├── tsconfig.app.json
│   │   ├── tsconfig.json
│   │   ├── tsconfig.spec.json
│   │   └── tslint.json
│   └── myapp-e2e/
│       ├── src/
│       │   ├── fixtures/
│       │   │   └── example.json
│       │   ├── integration/
│       │   │   └── app.spec.ts
│       │   ├── plugins/
│       │   │   └── index.ts
│       │   └── support/
│       │       ├── app.po.ts
│       │       ├── commands.ts
│       │       └── index.ts
│       ├── cypress.json
│       ├── tsconfig.e2e.json
│       ├── tsconfig.json
│       └── tslint.json
├── libs/
├── tools/
├── README.md
├── angular.json
├── nx.json
├── package.json
├── tsconfig.json
└── tslint.json
</code></pre>
<p>Angular CLI在新项目中拥有的所有文件仍然在这里，只是在不同的文件夹结构中，这使得将来更容易创建更多的应用程序和库。</p>
<h3 id="运行应用">运行应用</h3>
<pre><code>ng serve myapp
</code></pre>
<h3 id="构建多应用工作区">构建多应用工作区</h3>
<ul>
<li>使用Angular和Nest构建一个完整的堆栈应用程序。</li>
<li>在前端和后端之间共享代码</li>
</ul>
<h4 id="创建一个空工作区">创建一个空工作区</h4>
<pre><code>npx create-nx-workspace@latest myorg
cd myorg
</code></pre>
<h4 id="创建前端应用程序">创建前端应用程序</h4>
<p>使用Angular创建一个前端应用程序</p>
<pre><code>ng add @nrwl/angular # Add Angular Capabilities to the workspace
ng g @nrwl/angular:application frontend # Create an Angular Application
</code></pre>
<p>这将创建以下内容:</p>
<pre><code>myorg/
├── apps/
│   ├── frontend/
│   │   ├── src/
│   │   │   ├── app/
│   │   │   │   ├── app.component.html
│   │   │   │   ├── app.component.scss
│   │   │   │   ├── app.component.spec.ts
│   │   │   │   ├── app.component.ts
│   │   │   │   ├── app.module.ts
│   │   │   ├── assets/
│   │   │   ├── environments/
│   │   │   ├── favicon.ico
│   │   │   ├── index.html
│   │   │   ├── main.ts
│   │   │   ├── polyfills.ts
│   │   │   ├── styles.scss
│   │   │   └── test.ts
│   │   ├── browserslist
│   │   ├── jest.config.js
│   │   ├── tsconfig.app.json
│   │   ├── tsconfig.json
│   │   ├── tsconfig.spec.json
│   │   └── tslint.json
│   └── frontend-e2e/
├── README.md
├── libs/
├── tools/
├── angular.json
├── nx.json
├── package.json
├── tsconfig.json
└── tslint.json
</code></pre>
<p>运行：</p>
<pre><code>ng serve frontend 为应用程序服务
ng build frontend 构建应用程序
ng test frontend 测试应用程序
</code></pre>
<h4 id="创建api应用并在前端引入api">创建API应用并在前端引入API</h4>
<p>添加HttpClientModule到apps/frontend/src/app/app.module.ts：</p>
<pre><code>import { BrowserModule } from '@angular/platform-browser';
import { NgModule } from '@angular/core';
import { HttpClientModule } from '@angular/common/http';

import { AppComponent } from './app.component';

@NgModule({
  declarations: [AppComponent],
  imports: [BrowserModule, HttpClientModule],
  providers: [],
  bootstrap: [AppComponent]
})
export class AppModule {}
</code></pre>
<p>编辑apps/frontend/src/app/app.component.ts以从Todos API获取Todos：</p>
<pre><code>import { Component } from '@angular/core';
import { HttpClient } from '@angular/common/http';

import { Observable } from 'rxjs';

interface Todo {
  title: string;
}

@Component({
  selector: 'myorg-root',
  template: `
    &lt;h1&gt;Todos&lt;/h1&gt;
    &lt;ul&gt;
      &lt;li *ngFor=&quot;let t of (todos | async)&quot;&gt;{{ t.title }}&lt;/li&gt;
    &lt;/ul&gt;
  `
})
export class AppComponent {
  todos: Observable&lt;Todo[]&gt;;

  constructor(http: HttpClient) {
    this.todos = http.get&lt;Todo[]&gt;('/api/todos');
  }
}
</code></pre>
<p>由于API不存在，因此尚未显示任何待办事项。所以下一步是使用Nest创建api。<br>
创建一个类似于之前创建Angular应用程序的Nest应用程序：</p>
<pre><code>ng add @nrwl/nest # Add Node Capabilities to the workspace
ng g @nrwl/nest:application api --frontend-project frontend # sets up the proxy configuration so you can access the API in development
</code></pre>
<p>这将创建以下内容:</p>
<pre><code>myorg/
├── apps/
│   ├── frontend/
│   ├── frontend-e2e/
│   └── api/
│       ├── src/
│       │   ├── app/
│       │   │   ├── app.controller.spec.ts
│       │   │   ├── app.controller.ts
│       │   │   ├── app.module.ts
│       │   │   ├── app.service.spec.ts
│       │   │   ├── app.service.ts
│       │   ├── assets/
│       │   ├── environments/
│       │   └── main.ts
│       ├── jest.config.js
│       ├── tsconfig.app.json
│       ├── tsconfig.json
│       ├── tsconfig.spec.json
│       └── tslint.json
├── libs/
├── nx.json
├── package.json
├── tools/
├── tsconfig.json
└── tslint.json
</code></pre>
<p>apps目录是Nx放置运行应用的地方：前端应用程序，后端应用程序，e2e测试套件等。</p>
<p>Nest是一个很棒的框架，它与Angular分享了许多核心概念。它使用模块，提供程序，依赖注入等。因此，大多数Angular开发人员发现Nest易于使用。<br>
运行API应用</p>
<pre><code>ng serve api 为应用程序服务
ng build api 构建应用程序
ng test api 测试应用程序
</code></pre>
<p>生成的apps/api/src/app/app.module.ts内容如下所示：</p>
<pre><code>import { Module } from '@nestjs/common';

import { AppController } from './app.controller';
import { AppService } from './app.service';

@Module({
  imports: [],
  controllers: [AppController],
  providers: [AppService]
})
export class AppModule {}
</code></pre>
<ul>
<li>如果您愿意express，请改为运行以下命令：</li>
</ul>
<pre><code>ng add @nrwl/express # Add Express Capabilities to the workspace
ng g @nrwl/express:application api --frontend-project frontend
</code></pre>
<h4 id="添加api接口">添加API接口</h4>
<p>现在，通过更新添加接口以获取待办事项 app.service.ts</p>
<pre><code>import { Injectable } from '@nestjs/common';

export interface Todo {
  title: string;
}

@Injectable()
export class AppService {
  getTodos(): Todo[] {
    return [{ title: 'Fix my computer!' }, { title: 'Fix my desk' }];
  }
}
</code></pre>
<p>和 app.controller.ts</p>
<pre><code>import { Controller, Get } from '@nestjs/common';

import { AppService, Todo } from './app.service';

@Controller()
export class AppController {
  constructor(private readonly appService: AppService) {}

  @Get('todos')
  getTodos(): Todo[] {
    return this.appService.getTodos();
  }
}
</code></pre>
<p>现在，运行ng serve  &amp; ng serve api并打开http：// localhost：4200以查看前端和后端是否正常工作:<br>
<img src="https://fanguyun214.github.io/post-images/1564193094260.png" alt="" loading="lazy"><br>
有一个小问题。该Todo接口被定义了两次：一次是在前端，一旦在后端。这种重复将不可避免地导致两个接口不同步，这意味着运行时错误将会蔓延。最好共享此接口。</p>
<h3 id="在前端和后端之间共享代码">在前端和后端之间共享代码</h3>
<p>在Nx中，代码通过创建库来共享。因为所有内容都在一个存储库中，所以可以导入库而无需将它们发布到注册表。</p>
<p>通过以下方式创建新库：</p>
<pre><code>ng g @nrwl/workspace:library data # This generates a barebone library with only Typescript setup
</code></pre>
<pre><code>&lt;workspace name&gt;/
├── apps/
│   ├── frontend/
│   ├── frontend-e2e/
│   └── api/
├── libs/
│   └── data/
│       ├── src/
│       │   ├── lib/
│       │   │   └── data.ts
│       │   └── index.ts
│       ├── jest.config.js
│       ├── tsconfig.app.json
│       ├── tsconfig.json
│       ├── tsconfig.spec.json
│       └── tslint.json
├── nx.json
├── package.json
├── tools/
├── tsconfig.json
└── tslint.json
</code></pre>
<p>接下来，Todo进入libs/data/src/lib/data.ts：</p>
<pre><code>export interface Todo {
  title: string;
}
</code></pre>
<p>最后，更新前端和后端以从库中导入接口。<br>
更新apps/frontend/src/app/app.component.ts：</p>
<pre><code>import { Observable } from 'rxjs';
import { Component } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { Todo } from '@myorg/data';

@Component({
  selector: 'myorg-root',
  template: `
    &lt;h1&gt;Todos&lt;/h1&gt;
    &lt;ul&gt;
      &lt;li *ngFor=&quot;let t of (todos | async)&quot;&gt;{{ t.title }}&lt;/li&gt;
    &lt;/ul&gt;
  `
})
export class AppComponent {
  todos: Observable&lt;Todo[]&gt;;

  constructor(http: HttpClient) {
    this.todos = http.get&lt;Todo[]&gt;('/api/todos');
  }
}
</code></pre>
<p>更新apps/api/src/app/app.service.ts：</p>
<pre><code>import { Injectable } from '@nestjs/common';
import { Todo } from '@myorg/data';

@Injectable()
export class AppService {
  getTodos(): Todo[] {
    return [{ title: 'Fix my computer!' }, { title: 'Fix my desk' }];
  }
}
</code></pre>
<p>更新apps/api/src/app/app.controller.ts：</p>
<pre><code>import { Controller, Get } from '@nestjs/common';

import { Todo } from '@myorg/data';

import { AppService } from './app.service';

@Controller()
export class AppController {
  constructor(private readonly appService: AppService) {}

  @Get('todos')
  getTodos(): Todo[] {
    return this.appService.getTodos();
  }
}
</code></pre>
<p>在这个重构之后，后端和前端将共享相同的定义。能够将代码分解为许多具有定义良好的公共API的小型库，然后可以在后端和前端使用，这是Nx的一个关键特性。</p>
<h3 id="应用依赖关系">应用依赖关系</h3>
<p>拥有前端代码和后端代码已经令人惊叹了。只需几分钟，您就拥有了一个可以构建多个前端和后端应用程序并在它们之间共享代码的存储库。</p>
<p>但Nx可以做的远不止这些。在Nx中，您的库，后端应用程序，前端应用程序都是相同依赖关系图的一部分，您可以通过以下方式查看：</p>
<pre><code>npm run dep-graph
</code></pre>
<figure data-type="image" tabindex="1"><img src="https://fanguyun214.github.io/post-images/1564193447705.png" alt="" loading="lazy"></figure>
<h3 id="创建libs">创建Libs</h3>
<p>Libs不仅仅是在Nx中共享代码的一种方式。它们也可用于将代码分解为具有定义良好的公共API的小单元。</p>
<h4 id="公共api">公共API</h4>
<p>每个Libs都有一个index.ts文件，用于定义其公共API。其他应用程序和库应该只访问index.ts导出的内容。图书馆的其他所有内容都是私密的</p>
<h4 id="ui-libs">UI Libs</h4>
<p>为了说明库的有用性，可以创建一个Angular ui库:</p>
<pre><code>ng g @nrwl/angular:lib ui
</code></pre>
<p>你应该看到以下内容：</p>
<pre><code>myorg/
├── apps/
│   ├── todos/
│   ├── todos-e2e/
│   └── api/
├── libs/
│   ├── data/
│   └── ui/
│       ├── src/
│       │   ├── lib/
│       │   │   ├── ui.module.spec.ts
│       │   │   └── ui.module.ts
│       │   └── index.ts
│       ├── jest.conf.js
│       ├── tsconfig.app.json
│       ├── tsconfig.json
│       ├── tsconfig.spec.json
│       └── tslint.json
├── nx.json
├── package.json
├── tools/
├── tsconfig.json
└── tslint.json
</code></pre>
<p>该libs/ui/src/lib/ui.module.ts文件如下所示：</p>
<pre><code>import { NgModule } from '@angular/core';
import { CommonModule } from '@angular/common';

@NgModule({
  imports: [CommonModule]
})
export class UiModule {}
</code></pre>
<h4 id="添加组件">添加组件</h4>
<p>通过运行以下命令将组件添加到新创建的ui库:</p>
<pre><code>ng g component todos --project=ui --export
</code></pre>
<pre><code>myorg/
├── apps/
│   ├── todos/
│   ├── todos-e2e/
│   └── api/
├── libs/
│   ├── data/
│   └── ui/
│       ├── src/
│       │   ├── lib/
│       │   │   ├── todos/
│       │   │   │   ├── todos.component.css
│       │   │   │   ├── todos.component.html
│       │   │   │   ├── todos.component.spec.ts
│       │   │   │   └── todos.component.ts
│       │   │   ├── ui.module.spec.ts
│       │   │   └── ui.module.ts
│       │   └── index.ts
│       ├── jest.conf.js
│       ├── tsconfig.app.json
│       ├── tsconfig.json
│       ├── tsconfig.spec.json
│       └── tslint.json
├── nx.json
├── package.json
├── tools/
├── tsconfig.json
└── tslint.json
</code></pre>
<p>添加todos输入libs/src/lib/todos/todos.component.ts:</p>
<pre><code>import { Component, OnInit, Input } from '@angular/core';
import { Todo } from '@myorg/data';

@Component({
  selector: 'myorg-todos',
  templateUrl: './todos.component.html',
  styleUrls: ['./todos.component.css']
})
export class TodosComponent implements OnInit {
  @Input() todos: Todo[];

  constructor() {}

  ngOnInit() {}
}
</code></pre>
<p>并更新todos.component.html以显示给定的待办事项：</p>
<pre><code>&lt;ul&gt;
  &lt;li *ngFor=&quot;let t of todos&quot;&gt;{{ t.title }}&lt;/li&gt;
&lt;/ul&gt;
</code></pre>
<h4 id="使用ui库app挂载lib">使用UI库，app挂载lib</h4>
<p>现在导入UiModule到apps/todos/src/app/app.module.ts：</p>
<pre><code>import { BrowserModule } from '@angular/platform-browser';
import { NgModule } from '@angular/core';

import { AppComponent } from './app.component';
import { HttpClientModule } from '@angular/common/http';
import { UiModule } from '@myorg/ui';

@NgModule({
  declarations: [AppComponent],
  imports: [BrowserModule, HttpClientModule, UiModule],
  providers: [],
  bootstrap: [AppComponent]
})
export class AppModule {}
</code></pre>
<p>更新app.component.html：</p>
<pre><code>&lt;h1&gt;Todos&lt;/h1&gt;

&lt;myorg-todos [todos]=&quot;todos&quot;&gt;&lt;/myorg-todos&gt;

&lt;button (click)=&quot;addTodo()&quot;&gt;Add Todo&lt;/button&gt;
</code></pre>
<h3 id="app和libs">app和Libs</h3>
<p>根据项目复杂度可将架构拆分为多个app，对应的app可以挂载对应的lib。<br>
app配置依赖注入和连接Libs。它们不应包含任何组件，服务或业务逻辑。<br>
Libs包含服务，组件，实用程序等。它们具有定义良好的公共API。<br>
典型的Nx工作区比app具有更多的Libs，因此要特别注意libs目录的组织。</p>
<p>将特定于app的libs放入与app名称匹配的目录中是一个很好的约定：</p>
<pre><code>happynrwl/
├── apps/
│   ├── happynrwlapp/
│   ├── happynrwlapp-e2e/
│   ├── adminapp/
│   └── adminapp-e2e/
├── libs/
│   ├── happynrwlapp/
│   │   ├── feature-main/
│   │   ├── ui-table/
│   │   └── utils-testing/
│   ├── adminapp/
│   │   ├── feature-main/
│   │   ├── feature-login/
│   │   ├── ui/
│   │   └── utils-testing/
│   └── shared/
│       ├── ui/
│       └── utils-testing/
├── tools/
├── angular.json
├── nx.json
├── package.json
├── tsconfig.json
└── tslint.json
</code></pre>
<p>对于较大的项目，最好将库分组到应用程序部分:</p>
<pre><code>happynrwl/
├── apps/
├── libs/
│   ├── happynrwlapp/
│   │    ├── registration/
│   │    │   ├── feature-main/
│   │    │   ├── feature-login/
│   │    │   ├── ui-form/
│   │    │   └── utils-testing/
│   │    ├── search/
│   │    │   ├── feature-results/
│   │    │   └── utils-testing/
│   │    └── shared/
│   │        └── ui/
│   ├── adminapp/
|   └── shared/
│       ├── ui/
│       └── utils-testing/
├── tools/
├── angular.json
├── nx.json
├── package.json
├── tsconfig.json
└── tslint.json
</code></pre>
<p>这里：</p>
<pre><code>happynrwlapp/registration/feature-main- 在一个地方使用的范围库
happynrwlapp/shared/ui- 在单个应用程序中使用的共享库
shared/ui- 跨应用程序使用的共享库
</code></pre>
<h3 id="懒加载库">懒加载库</h3>
<p>Lazing加载此代码有助于捆绑包大小，减少应用程序的启动时间：</p>
<pre><code>ng g @nrwl/angular:lib todo-list-shell --router --lazy --parentModule=apps/todos/src/app/app.module.ts
</code></pre>
<ul>
<li>--routing：添加路由器配置。</li>
<li>--lazy：RouterModule.forChild设置为true时添加，设置为false时为简单路径数组。</li>
<li>--parentModule：更新父模块。</li>
</ul>
<pre><code>myorg/
├── apps/
│   ├── todos/
│   ├── todos-e2e/
│   └── api/
├── libs/
│   └── todo-list-shell/
│       ├── jest.conf.js
│       ├── src/
│       │   ├── lib/
│       │   │  ├── todo-list-shell.module.spec.ts
│       │   │  └── todo-list-shell.module.ts
│       │   └── index.ts
│       ├── tsconfig.app.json
│       ├── tsconfig.json
│       ├── tsconfig.spec.json
│       └── tslint.json
├── nx.json
├── package.json
├── tools/
├── tsconfig.json
└── tslint.json
</code></pre>
<p>todo-list-shell.module.ts:</p>
<pre><code>import { NgModule } from '@angular/core';
import { CommonModule } from '@angular/common';
import { RouterModule } from '@angular/router';

@NgModule({
  imports: [
    CommonModule,

    RouterModule.forChild([
      /* {path: '', pathMatch: 'full', component: InsertYourComponentHere} */
    ])
  ]
})
export class FeatureShellModule {}
</code></pre>
<p>添加组件，现在将一个组件添加到新创建的todo-list-shell库中：</p>
<pre><code>ng g component main --project=todo-list-shell
</code></pre>
<pre><code>myorg/
├── apps/
│   ├── todos/
│   ├── todos-e2e/
│   └── api/
├── libs/
│   └── todo-list-shell/
│       ├── jest.conf.js
│       ├── src/
│       │   ├── lib/
│       │   │  ├── todo-list/
│       │   │  │   ├── todo-list.component.css
│       │   │  │   ├── todo-list.component.html
│       │   │  │   ├── todo-list.component.spec.ts
│       │   │  │   └── todo-list.component.ts
│       │   │  ├── todo-list-shell.module.spec.ts
│       │   │  └── todo-list-shell.module.ts
│       │   └── index.ts
│       ├── tsconfig.app.json
│       ├── tsconfig.json
│       ├── tsconfig.spec.json
│       └── tslint.json
├── nx.json
├── package.json
├── tools/
├── tsconfig.json
└── tslint.json
</code></pre>
<p>接下来，更新TodoListShellModule以使用组件：</p>
<pre><code>import { NgModule } from '@angular/core';
import { CommonModule } from '@angular/common';
import { RouterModule } from '@angular/router';
import { TodoListComponent } from './todo-list/todo-list.component';

@NgModule({
  imports: [
    CommonModule,
    RouterModule.forChild([
      { path: '', pathMatch: 'full', component: TodoListComponent }
    ])
  ]
})
export class TodoListShellModule {}
</code></pre>
<p>app.module.ts通过使用loadChildren属性添加惰性路由:</p>
<pre><code>import { BrowserModule } from '@angular/platform-browser';
import { NgModule } from '@angular/core';

import { AppComponent } from './app.component';

// You can add multiple routes as your needs
const routes: Routes = [
  {
    path: 'list',
    loadChildren: () =&gt;
      import('@myorg/todo-list-shell').then(m =&gt; m.TodoListShellModule)
  }
];

@NgModule({
  declarations: [AppComponent],
  imports: [BrowserModule, RouterModule.forRoot(routes)],
  providers: [],
  bootstrap: [AppComponent]
})
export class AppModule {}
</code></pre>
<h3 id="快捷使用">快捷使用</h3>
<h4 id="创建-app-和-lib">创建 app 和 lib</h4>
<p>创建App：<br>
yarn ng g @nrwl/angular:application demo --routing --style=less。添加参数 --dry-run （或 -d 简写）来查看当前操作将会创建的文件<br>
创建Lib：<br>
yarn ng g lib demo --routing --lazy --parent-module=apps/demo/src/app/app.module.ts --directory=demo/views。</p>
<h4 id="修改-angularjson">修改 angular.json：</h4>
<pre><code>{
  &quot;projects&quot;: {
    &quot;demo&quot;: {
      &quot;architect&quot;: {
        &quot;build&quot;: {
          &quot;options&quot;: {
          &quot;styles&quot;: [
              &quot;apps/demo/src/styles.less&quot;, // 引用当前 app 的样式
+             &quot;styles/styles.less&quot;          // 引用全局公共样式
            ],
          },
          &quot;configurations&quot;: {
            &quot;production&quot;: {
+              &quot;baseHref&quot;: &quot;/&quot;,
            }
          }
        },
        &quot;serve&quot;: {
          &quot;options&quot;: {
+            &quot;port&quot;: 5001, // 每个 app 设置不一样的端口
+            &quot;proxyConfig&quot;: &quot;proxy.conf.js&quot;,
          }
        }
      }
    }
  }
} 
</code></pre>
<p><a href="https://github.com/angular/angular-cli/wiki/stories-configure-hmr">配置热更新</a></p>

        </div>

        
          <a class="animated fadeInUp p-2 items-center text-sm text-gray-700 border hover:bg-gray-300 leading-none rounded-full flex lg:inline-flex m-4 " href="https://fanguyun214.github.io/tag/8-pCBu3Tk/">
            <span class="flex-auto">NX</span>
          </a>
        
          <a class="animated fadeInUp p-2 items-center text-sm text-gray-700 border hover:bg-gray-300 leading-none rounded-full flex lg:inline-flex m-4 " href="https://fanguyun214.github.io/tag/zw8cBAsq1V/">
            <span class="flex-auto">架构</span>
          </a>
        


        <div class="flex justify-between py-8">
          
            <div class="prev-post">
              <a href="https://fanguyun214.github.io/post/mongodb-bi-ji-1jian-jie/">
                <h3 class="post-title">
                  <i class="ri-arrow-left-line"></i>
                  MongoDB笔记-1（简介）
                </h3>
              </a>
            </div>
          

          
            <div class="next-post">
              <a href="https://fanguyun214.github.io/post/apollo-client-16authentication/">
                <h3 class="post-title">
                  Apollo Client - 16.Authentication
                  <i class="ri-arrow-right-line"></i>
                </h3>
              </a>
            </div>
          
        </div>

        
          
            <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>

<div id="gitalk-container"></div>

<script>

  var gitalk = new Gitalk({
    clientID: '94fca913faabe61337e0',
    clientSecret: '9ee8a359f64b424f77e6fba28063b59788b92af1',
    repo: 'fanguyun214.github.io',
    owner: 'fanguyun214',
    admin: ['fanguyun214'],
    id: (location.pathname).substring(0, 49),      // Ensure uniqueness and length less than 50
    distractionFreeMode: false  // Facebook-like distraction free mode
  })

  gitalk.render('gitalk-container')

</script>

          

          
        

      </div>
    </div>

    <script src="https://fanguyun214.github.io/media/prism.js"></script>  
<script>

Prism.highlightAll()
let mainNavLinks = document.querySelectorAll(".markdownIt-TOC a");

// This should probably be throttled.
// Especially because it triggers during smooth scrolling.
// https://lodash.com/docs/4.17.10#throttle
// You could do like...
// window.addEventListener("scroll", () => {
//    _.throttle(doThatStuff, 100);
// });
// Only not doing it here to keep this Pen dependency-free.

window.addEventListener("scroll", event => {
  let fromTop = window.scrollY;

  mainNavLinks.forEach((link, index) => {
    let section = document.getElementById(decodeURI(link.hash).substring(1));
    let nextSection = null
    if (mainNavLinks[index + 1]) {
      nextSection = document.getElementById(decodeURI(mainNavLinks[index + 1].hash).substring(1));
    }
    if (section.offsetTop <= fromTop) {
      if (nextSection) {
        if (nextSection.offsetTop > fromTop) {
          link.classList.add("current");
        } else {
          link.classList.remove("current");    
        }
      } else {
        link.classList.add("current");
      }
    } else {
      link.classList.remove("current");
    }
  });
});


document.addEventListener("DOMContentLoaded", function() {
  var lazyImages = [].slice.call(document.querySelectorAll(".post-feature-image.lazy"));

  if ("IntersectionObserver" in window) {
    let lazyImageObserver = new IntersectionObserver(function(entries, observer) {
      entries.forEach(function(entry) {
        if (entry.isIntersecting) {
          let lazyImage = entry.target
          lazyImage.style.backgroundImage = `url(${lazyImage.dataset.bg})`
          lazyImage.classList.remove("lazy")
          lazyImageObserver.unobserve(lazyImage)
        }
      });
    });

    lazyImages.forEach(function(lazyImage) {
      lazyImageObserver.observe(lazyImage)
    })
  } else {
    // Possibly fall back to a more compatible method here
  }
});

const menuContainer = document.querySelector('.menu-container')
const menus = document.querySelectorAll('.menu-container .menu')
const mask = document.querySelector('.mask')
const contentWrapper = document.querySelector('.content-wrapper')
const latestArticle = document.querySelector('.latest-article')
const readMore = document.querySelector('.read-more')
const indexPage = document.querySelector('.index-page')

const isHome = location.pathname === '/'
if (latestArticle) {
  latestArticle.style.display = isHome ? 'block' : 'none'
  readMore.style.display = isHome ? 'block' : 'none'
  indexPage.style.display = isHome ? 'none' : 'block'
}

const openMenu = () => {
  menuContainer.classList.add('open')
  menus.forEach(menu => {
    menu.classList.add('animated', 'fadeInLeft')
  })
  mask.classList.add('open')
  contentWrapper.classList.add('is-second')
}

const closeMenu = () => {
  menuContainer.classList.remove('open')
  menus.forEach(menu => {
    menu.classList.remove('animated', 'fadeInLeft')
  })
  mask.classList.remove('open')
  contentWrapper.classList.remove('is-second')
}
</script>
  
  </body>
</html>
