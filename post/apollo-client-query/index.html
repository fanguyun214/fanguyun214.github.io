<html>
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Apollo Client - 2.Query | Jasonå‡¡ Blog</title>
<meta name="description" content="ğŸŒ±ğŸŒ±ğŸŒ± æ¯ä¸ªäººçš„ç”Ÿæ´»éƒ½æ˜¯ä¸€æ¡é€šå‘è‡ªèº«çš„é“è·¯ï¼Œæ‰¾åˆ°è‡ªæˆ‘ï¼Œåœ¨å¿ƒä¸­åšå®ˆä¸€ç”Ÿï¼Œå…¨å¿ƒå…¨æ„ï¼Œæ°¸ä¸åœæ¯ ğŸŒ±ğŸŒ±ğŸŒ±" />
<link rel="shortcut icon" href="https://fanguyun214.github.io/favicon.ico?v=1608116157194">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://fanguyun214.github.io/styles/main.css">

<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Droid+Serif:400,700">


<script async src="https://www.googletagmanager.com/gtag/js?id=UA-144114666-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-144114666-1');
</script>


  </head>
  <body>
    <div class="main">
      <div class="main-content">
        <div class="site-header">
  <a href="https://fanguyun214.github.io">
  <img class="avatar" src="https://fanguyun214.github.io/images/avatar.png?v=1608116157194" alt="">
  </a>
  <h1 class="site-title">
    Jasonå‡¡ Blog
  </h1>
  <p class="site-description">
    ğŸŒ±ğŸŒ±ğŸŒ± æ¯ä¸ªäººçš„ç”Ÿæ´»éƒ½æ˜¯ä¸€æ¡é€šå‘è‡ªèº«çš„é“è·¯ï¼Œæ‰¾åˆ°è‡ªæˆ‘ï¼Œåœ¨å¿ƒä¸­åšå®ˆä¸€ç”Ÿï¼Œå…¨å¿ƒå…¨æ„ï¼Œæ°¸ä¸åœæ¯ ğŸŒ±ğŸŒ±ğŸŒ±
  </p>
  <div class="menu-container">
    
      
        <a href="/" class="menu">
          é¦–é¡µ
        </a>
      
    
      
        <a href="/archives" class="menu">
          å½’æ¡£
        </a>
      
    
      
        <a href="/tags" class="menu">
          æ ‡ç­¾
        </a>
      
    
      
        <a href="/post/about" class="menu">
          å…³äº
        </a>
      
    
  </div>
  <div class="social-container">
    
      
        <a href="https://github.com/fanguyun214" target="_blank">
          <i class="fab fa-github"></i>
        </a>
      
    
      
        <a href="https://twitter.com/home" target="_blank">
          <i class="fab fa-twitter"></i>
        </a>
      
    
      
        <a href="https://weibo.com/3307571020/profile" target="_blank">
          <i class="fab fa-weibo"></i>
        </a>
      
    
      
    
      
    
  </div>
</div>

        <div class="post-detail">
          <article class="post">
            <h2 class="post-title">
              Apollo Client - 2.Query
            </h2>
            <div class="post-info">
              <span>
                2019-07-18
              </span>
              <span>
                14 min read
              </span>
              
                <a href="https://fanguyun214.github.io/tag/AmO1ThlSR/" class="post-tag">
                  # Apollo Client
                </a>
              
                <a href="https://fanguyun214.github.io/tag/dW_UwyEf6P/" class="post-tag">
                  # Graphql
                </a>
              
            </div>
            
              <img class="post-feature-image" src="https://fanguyun214.github.io/post-images/apollo-client-query.png" alt="">
            
            <div class="post-content-wrapper">
              <div class="post-content">
                <p>å­¦ä¹ å¦‚ä½•ä½¿ç”¨ Query ç»„ä»¶è·å–æ•°æ®</p>
<!-- more -->
<p>ä»¥ç®€å•å¯é¢„æµ‹çš„æ–¹å¼è·å–æ•°æ®æ˜¯ Apollo Client çš„æ ¸å¿ƒåŠŸèƒ½ä¹‹ä¸€ã€‚ åœ¨æœ¬æŒ‡å—ä¸­ï¼Œæ‚¨å°†å­¦ä¹ å¦‚ä½•æ„å»º Query ç»„ä»¶ä»¥è·å– GraphQL æ•°æ®å¹¶å°†ç»“æœé™„åŠ åˆ° UIã€‚ æ‚¨è¿˜å°†äº†è§£ Apollo Client å¦‚ä½•é€šè¿‡è·Ÿè¸ªé”™è¯¯å’ŒåŠ è½½çŠ¶æ€æ¥ç®€åŒ–æ•°æ®ç®¡ç†ä»£ç ã€‚</p>
<p>å‡è®¾æ‚¨ç†Ÿæ‚‰æ„å»º GraphQL æŸ¥è¯¢ã€‚ å¦‚æœä½ æƒ³å¤ä¹ ä¸€ä¸‹, æˆ‘ä»¬æ¨è <a href="http://graphql.org/learn/queries/">é˜…è¯»æœ¬æŒ‡å—</a> å’Œç»ƒä¹  <a href="../features/developer-tooling.html#features">åœ¨GraphiQLä¸­è¿è¡ŒæŸ¥è¯¢</a>. ç”±äº Apollo Client æŸ¥è¯¢æ˜¯æ ‡å‡†çš„ GraphQLï¼Œå› æ­¤æ‚¨åœ¨ GraphiQL ä¸­æˆåŠŸè¿è¡Œçš„ä»»ä½•æŸ¥è¯¢ä¹Ÿå°†åœ¨ Apollo Query ç»„ä»¶ä¸­è¿è¡Œã€‚</p>
<p>ä»¥ä¸‹ç¤ºä¾‹å‡è®¾æ‚¨å·²ç»è®¾ç½®äº† Apollo Client å¹¶å°†æ‚¨çš„ React åº”ç”¨ç¨‹åºåŒ…è£…åœ¨ <code>ApolloProvider</code> ç»„ä»¶ä¸­ã€‚ é˜…è¯»æˆ‘ä»¬çš„ <a href="./get-started.html">å…¥é—¨</a> æŒ‡å—, å¦‚æœæ‚¨éœ€è¦æœ‰å…³è¿™ä¸¤ä¸ªæ­¥éª¤çš„å¸®åŠ©ã€‚</p>
<blockquote>
<p>å¦‚æœä½ æƒ³å‚è€ƒè¿™äº›ä¾‹å­ï¼Œè¯·æ‰“å¼€ CodeSandbox ä¸Šçš„ <a href="https://codesandbox.io/s/j2ly83749w">å¯åŠ¨é¡¹ç›®</a>å’Œ <a href="https://codesandbox.IO/S/32ypr38l61">this CodeSandbox</a> ä¸Šçš„ç¤ºä¾‹ GraphQL æœåŠ¡å™¨ã€‚ æ‚¨å¯ä»¥æŸ¥çœ‹åº”ç”¨ç¨‹åºçš„ <a href="https://codesandbox.io/s/n3jykqpxwm">å®Œæ•´ç‰ˆæœ¬</a>ã€‚</p>
</blockquote>
<h2 id="queryç»„ä»¶">Queryç»„ä»¶</h2>
<p>Query ç»„ä»¶æ˜¯ Apollo åº”ç”¨ç¨‹åºæœ€é‡è¦çš„æ„å»ºå—ä¹‹ä¸€ã€‚ è¦åˆ›å»º Query ç»„ä»¶ï¼Œ åªéœ€å°†åŒ…å« <code>gql</code> å‡½æ•°çš„ GraphQL æŸ¥è¯¢å­—ç¬¦ä¸²ä¼ é€’ç»™ <code>this.props.query</code> ï¼Œå¹¶ä¸º <code>this.props.children</code> æä¾›ä¸€ä¸ªå‡½æ•°ï¼Œå‘Šè¯‰ React è¦å‘ˆç°ä»€ä¹ˆã€‚<br>
<code>Query</code> ç»„ä»¶æ˜¯ä½¿ç”¨ <a href="https://reactjs.org/docs/render-props.html">render prop</a> æ¨¡å¼çš„Reactç»„ä»¶çš„ç¤ºä¾‹ã€‚ Reactå°†ä½¿ç”¨ Apollo Client ä¸­çš„å¯¹è±¡è°ƒç”¨æ‚¨æä¾›çš„ render prop å‡½æ•°ï¼Œè¯¥å¯¹è±¡åŒ…å«å¯ç”¨äºå‘ˆç° UI çš„åŠ è½½ï¼Œé”™è¯¯å’Œæ•°æ®å±æ€§ã€‚ æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p>
<p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬åˆ›å»º GraphQL æŸ¥è¯¢ã€‚ è¯·è®°ä½å°†æŸ¥è¯¢å­—ç¬¦ä¸²åŒ…è£…åœ¨ <code>gql</code> å‡½æ•°ä¸­ï¼Œä»¥ä¾¿å°†å…¶è§£æä¸ºæŸ¥è¯¢æ–‡æ¡£ã€‚ ä¸€æ—¦æˆ‘ä»¬åˆ›å»ºå¥½ GraphQL æŸ¥è¯¢ï¼Œè®©æˆ‘ä»¬é€šè¿‡å°†å®ƒä¼ é€’ç»™ <code>query</code> prop æ¥å°†å®ƒé™„åŠ åˆ°æˆ‘ä»¬çš„ <code>Query</code> ç»„ä»¶ã€‚</p>
<p>æˆ‘ä»¬è¿˜éœ€è¦ä¸º <code>Query</code> ç»„ä»¶æä¾›ä¸€ä¸ªå­å‡½æ•°ï¼Œå®ƒå°†å‘Šè¯‰ React æˆ‘ä»¬æƒ³è¦å‘ˆç°ä»€ä¹ˆã€‚ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>Query</code> ç»„ä»¶ä¸ºæˆ‘ä»¬æä¾›çš„ <code>loading</code>ï¼Œ<code>error</code> å’Œ <code>data</code> å±æ€§ï¼Œä»¥ä¾¿æ ¹æ®æŸ¥è¯¢çš„çŠ¶æ€æ™ºèƒ½åœ°å‘ˆç°ä¸åŒçš„ UIã€‚ è®©æˆ‘ä»¬çœ‹çœ‹è¿™æ˜¯ä»€ä¹ˆæ ·çš„ï¼</p>
<pre><code class="language-jsx">import gql from &quot;graphql-tag&quot;;
import { Query } from &quot;react-apollo&quot;;

const GET_DOGS = gql`
  {
    dogs {
      id
      breed
    }
  }
`;

const Dogs = ({ onDogSelected }) =&gt; (
  &lt;Query query={GET_DOGS}&gt;
    {({ loading, error, data }) =&gt; {
      if (loading) return &quot;Loading...&quot;;
      if (error) return `Error! ${error.message}`;

      return (
        &lt;select name=&quot;dog&quot; onChange={onDogSelected}&gt;
          {data.dogs.map(dog =&gt; (
            &lt;option key={dog.id} value={dog.breed}&gt;
              {dog.breed}
            &lt;/option&gt;
          ))}
        &lt;/select&gt;
      );
    }}
  &lt;/Query&gt;
);
</code></pre>
<p>å¦‚æœä½ åœ¨ <code>App</code> ç»„ä»¶ä¸­æ¸²æŸ“ <code>Dogs</code>ï¼Œä¸€æ—¦ Apollo Client ä»æœåŠ¡å™¨æ¥æ”¶æ•°æ®ï¼Œä½ å°†é¦–å…ˆçœ‹åˆ°åŠ è½½çŠ¶æ€ï¼Œç„¶åæ˜¯å¸¦æœ‰ç‹—å“ç§åˆ—è¡¨çš„è¡¨å•ã€‚ å½“è¡¨å•å€¼æ”¹å˜æ—¶ï¼Œæˆ‘ä»¬å°†é€šè¿‡ <code>this.props.onDogSelected</code> å°†å€¼å‘é€ç»™çˆ¶ç»„ä»¶ï¼Œ æœ€ç»ˆå°†å€¼ä¼ é€’ç»™ <code>DogPhoto</code> ç»„ä»¶ã€‚</p>
<p>åœ¨ä¸‹ä¸€æ­¥ä¸­ï¼Œæˆ‘ä»¬å°†é€šè¿‡æ„å»ºä¸€ä¸ª <code>DogPhoto</code> ç»„ä»¶å°†è¡¨å•æŒ‚è½½åˆ°ä¸€ä¸ªæ›´å¤æ‚çš„å˜é‡æŸ¥è¯¢ã€‚</p>
<h2 id="æ¥æ”¶æ•°æ®">æ¥æ”¶æ•°æ®</h2>
<p>æ‚¨å·²ç»åœ¨ render prop å‡½æ•°ä¸­çœ‹åˆ°äº†å¦‚ä½•å¤„ç†æŸ¥è¯¢ç»“æœã€‚ å½“æˆ‘ä»¬ä» <code>Query</code> ç»„ä»¶ä¸­è·å–æ•°æ®æ—¶ï¼Œè®©æˆ‘ä»¬æ·±å…¥äº†è§£ Apollo Client å¹•åå‘ç”Ÿçš„äº‹æƒ…ã€‚</p>
<ol>
<li>å½“ <code>Query</code> ç»„ä»¶å®‰è£…æ—¶ï¼ŒApollo Client ä¼šä¸ºæˆ‘ä»¬çš„æŸ¥è¯¢åˆ›å»ºä¸€ä¸ª observableã€‚ æˆ‘ä»¬çš„ç»„ä»¶é€šè¿‡ Apollo Client ç¼“å­˜è®¢é˜…æŸ¥è¯¢ç»“æœã€‚</li>
<li>é¦–å…ˆï¼Œæˆ‘ä»¬å°è¯• ä» Apollo ç¼“å­˜åŠ è½½æŸ¥è¯¢ç»“æœã€‚ å¦‚æœç¼“å­˜ä¸­ä¸å­˜åœ¨ï¼Œæˆ‘ä»¬å°†è¯·æ±‚å‘é€åˆ°æœåŠ¡å™¨ã€‚</li>
<li>ä¸€æ—¦æ•°æ®è¿”å›ï¼Œæˆ‘ä»¬å°†å…¶æ ‡å‡†åŒ–å¹¶å°†å…¶å­˜å‚¨åœ¨ Apollo ç¼“å­˜ä¸­ã€‚ ç”±äº <code>Query</code> ç»„ä»¶è®¢é˜…äº†ç»“æœï¼Œå› æ­¤å®ƒä¼šè‡ªåŠ¨æ›´æ–°æ•°æ®ã€‚</li>
</ol>
<p>è¦æŸ¥çœ‹ Apollo Client çš„ç¼“å­˜æ“ä½œï¼Œè®©æˆ‘ä»¬æ„å»ºæˆ‘ä»¬çš„ <code>DogPhoto</code> ç»„ä»¶ã€‚ <code>DogPhoto</code> æ¥å—ä¸€ä¸ªåä¸º <code>breed</code> çš„é“å…·ï¼Œå®ƒåæ˜ äº†ä¸Šé¢ <code>Dogs</code> ç»„ä»¶ä¸­æˆ‘ä»¬è¡¨å•çš„å½“å‰å€¼ã€‚</p>
<pre><code class="language-jsx">const GET_DOG_PHOTO = gql`
  query Dog($breed: String!) {
    dog(breed: $breed) {
      id
      displayImage
    }
  }
`;

const DogPhoto = ({ breed }) =&gt; (
  &lt;Query query={GET_DOG_PHOTO} variables={{ breed }}&gt;
    {({ loading, error, data }) =&gt; {
      if (loading) return null;
      if (error) return `Error!: ${error}`;

      return (
        &lt;img src={data.dog.displayImage} style={{ height: 100, width: 100 }} /&gt;
      );
    }}
  &lt;/Query&gt;
);
</code></pre>
<p>æ‚¨ä¼šæ³¨æ„åˆ° <code>Query</code> ç»„ä»¶ä¸Šæœ‰ä¸€ä¸ªæ–°çš„é…ç½®é€‰é¡¹ã€‚ prop<code>variable</code> æ˜¯ä¸€ä¸ªåŒ…å«æˆ‘ä»¬æƒ³è¦ä¼ é€’ç»™ GraphQL æŸ¥è¯¢çš„å˜é‡å¯¹è±¡ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›å°†è¡¨æ ¼ä¸­çš„å“ç§ä¼ é€’ç»™æˆ‘ä»¬çš„æŸ¥è¯¢ã€‚</p>
<p>å°è¯•ä»åˆ—è¡¨ä¸­é€‰æ‹© &quot;bulldog&quot; ä»¥æŸ¥çœ‹å…¶ç…§ç‰‡æ˜¾ç¤ºã€‚ ç„¶åï¼Œåˆ‡æ¢åˆ°å¦ä¸€ä¸ªå“ç§å¹¶åˆ‡æ¢å› &quot;bulldog&quot;ã€‚ ä½ ä¼šæ³¨æ„åˆ°ç‰›å¤´çŠ¬ç…§ç‰‡ç¬¬äºŒæ¬¡ç¬é—´åŠ è½½ã€‚ è¿™æ˜¯ Apollo ç¼“å­˜åœ¨èµ·ä½œç”¨ï¼</p>
<p>æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬å­¦ä¹ ä¸€äº›ç¡®ä¿æ•°æ®æ–°é²œçš„æŠ€æœ¯ï¼Œä¾‹å¦‚è½®è¯¢å’Œé‡æ–°è·å–ã€‚</p>
<h2 id="è½®è¯¢å’Œé‡æ–°è·å–">è½®è¯¢å’Œé‡æ–°è·å–</h2>
<p>Apollo Client ä¸ºæ‚¨ç¼“å­˜æ•°æ®çœŸæ˜¯å¤ªæ£’äº†ï¼Œä½†æ˜¯å½“æˆ‘ä»¬éœ€è¦æ–°æ•°æ®æ—¶æˆ‘ä»¬åº”è¯¥æ€ä¹ˆåšï¼Ÿ ä¸¤ç§è§£å†³æ–¹æ¡ˆæ˜¯è½®è¯¢å’Œé‡æ–°è·å–ã€‚</p>
<p>è½®è¯¢å¯ä»¥é€šè¿‡åœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”å†…é‡æ–°è·å–æ¥å¸®åŠ©æˆ‘ä»¬å®ç°æ¥è¿‘å®æ—¶çš„æ•°æ®ã€‚ è¦å®ç°è½®è¯¢ï¼Œåªéœ€å°† <code>pollInterval</code> propä¼ é€’ç»™ <code>Query</code> ç»„ä»¶ï¼Œé—´éš”ä¸º msã€‚ å¦‚æœä¼ å…¥ 0ï¼ŒæŸ¥è¯¢å°†ä¸ä¼šè½®è¯¢ã€‚ æ‚¨è¿˜å¯ä»¥é€šè¿‡åœ¨ä¼ é€’ç»™ render prop å‡½æ•°çš„ç»“æœå¯¹è±¡ä¸Šä½¿ç”¨ <code>startPolling</code> å’Œ <code>stopPolling</code> å‡½æ•°æ¥å®ç°åŠ¨æ€è½®è¯¢ã€‚</p>
<pre><code class="language-jsx">const DogPhoto = ({ breed }) =&gt; (
  &lt;Query
    query={GET_DOG_PHOTO}
    variables={{ breed }}
    skip={!breed}
    pollInterval={500}
  &gt;
    {({ loading, error, data, startPolling, stopPolling }) =&gt; {
      if (loading) return null;
      if (error) return `Error!: ${error}`;

      return (
        &lt;img src={data.dog.displayImage} style={{ height: 100, width: 100 }} /&gt;
      );
    }}
  &lt;/Query&gt;
);
</code></pre>
<p>é€šè¿‡å°† <code>pollInterval</code> è®¾ç½®ä¸º 500 ï¼Œæ‚¨åº”è¯¥æ¯éš” 0.5 ç§’çœ‹åˆ°ä¸€ä¸ªæ–°çš„ç‹—å›¾åƒã€‚ è½®è¯¢æ˜¯å®ç°è¿‘å®æ—¶æ•°æ®çš„ç»ä½³æ–¹å¼ï¼Œè€Œæ— éœ€å¤æ‚çš„è®¾ç½® GraphQL è®¢é˜…ã€‚</p>
<p>å¦‚æœè¦é‡æ–°åŠ è½½æŸ¥è¯¢ä»¥å“åº”ç”¨æˆ·æ“ä½œè€Œä¸æ˜¯é—´éš”ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿ è¿™å°±æ˜¯ <code>refetch</code> å‡½æ•°çš„ç”¨æ­¦ä¹‹åœ°ï¼ åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬åœ¨ <code>DogPhoto</code> ç»„ä»¶ä¸­æ·»åŠ äº†ä¸€ä¸ªæŒ‰é’®ï¼Œè¯¥æŒ‰é’®ä¼šåœ¨å•å‡»æ—¶è§¦å‘é‡æ–°è·å–ã€‚<code>refetch</code> æ¥å—å˜é‡ï¼Œä½†å¦‚æœæˆ‘ä»¬ä¸ä¼ å…¥æ–°å˜é‡ï¼Œå®ƒå°†ä½¿ç”¨æˆ‘ä»¬ä¹‹å‰æŸ¥è¯¢ä¸­çš„ç›¸åŒå˜é‡ã€‚</p>
<pre><code class="language-jsx">const DogPhoto = ({ breed }) =&gt; (
  &lt;Query
    query={GET_DOG_PHOTO}
    variables={{ breed }}
    skip={!breed}
  &gt;
    {({ loading, error, data, refetch }) =&gt; {
      if (loading) return null;
      if (error) return `Error!: ${error}`;

      return (
        &lt;div&gt;
          &lt;img
            src={data.dog.displayImage}
            style={{ height: 100, width: 100 }}
          /&gt;
          &lt;button onClick={() =&gt; refetch()}&gt;Refetch!&lt;/button&gt;
        &lt;/div&gt;
      );
    }}
  &lt;/Query&gt;
);
</code></pre>
<p>å¦‚æœå•å‡»è¯¥æŒ‰é’®ï¼Œæ‚¨ä¼šæ³¨æ„åˆ°æˆ‘ä»¬çš„ UI æ›´æ–°äº†æœ€æ–°çš„æ•°æ®ã€‚ é‡æ–°è·å–æ˜¯ä¿è¯æ–°æ•°æ®çš„ä¸€ç§å¾ˆå¥½çš„æ–¹æ³•ï¼Œä½†å®ƒåœ¨åŠ è½½çŠ¶æ€æ—¶å¼•å…¥äº†ä¸€äº›é¢å¤–çš„å¤æ‚æ€§ã€‚ åœ¨ä¸‹ä¸€èŠ‚ä¸­ï¼Œæ‚¨å°†å­¦ä¹ å¤„ç†å¤æ‚åŠ è½½å’Œé”™è¯¯çŠ¶æ€çš„ç­–ç•¥ã€‚</p>
<h2 id="åŠ è½½å’Œé”™è¯¯çŠ¶æ€">åŠ è½½å’Œé”™è¯¯çŠ¶æ€</h2>
<p>æˆ‘ä»¬å·²ç»çœ‹åˆ° Apollo Client å¦‚ä½•åœ¨æ¸²æŸ“å‡½æ•°ä¸­å…¬å¼€æˆ‘ä»¬çš„æŸ¥è¯¢çš„åŠ è½½å’Œé”™è¯¯çŠ¶æ€ã€‚ è¿™äº›å±æ€§å¯¹äºåˆæ¬¡æŸ¥è¯¢åŠ è½½æ—¶æœ‰ç”¨ï¼Œä½†æ˜¯å½“æˆ‘ä»¬é‡æ–°è·å–æˆ–è½®è¯¢æ—¶ï¼Œæˆ‘ä»¬çš„åŠ è½½çŠ¶æ€ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</p>
<p>è®©æˆ‘ä»¬å›åˆ°ä¸Šä¸€èŠ‚ä¸­çš„ç¤ºä¾‹ã€‚ å¦‚æœå•å‡» â€œRefetchâ€ æŒ‰é’®ï¼Œæ‚¨å°†çœ‹åˆ°ç»„ä»¶åœ¨æ–°æ•°æ®åˆ°è¾¾ä¹‹å‰ä¸ä¼šé‡æ–°å‘ˆç°ã€‚ å¦‚æœæˆ‘ä»¬æƒ³å‘ç”¨æˆ·è¡¨æ˜æˆ‘ä»¬æ­£åœ¨é‡æ–°è·å–ç…§ç‰‡æ€ä¹ˆåŠï¼Ÿ</p>
<p>å¹¸è¿çš„æ˜¯ï¼ŒApollo Client é€šè¿‡ render prop å‡½æ•°ä¸­ç»“æœå¯¹è±¡çš„ <code>networkStatus</code> å±æ€§æä¾›æœ‰å…³æŸ¥è¯¢çŠ¶æ€çš„ç»†ç²’åº¦ä¿¡æ¯ã€‚ æˆ‘ä»¬è¿˜éœ€è¦å°† prop çš„ notifyOnNetworkStatusChange è®¾ç½®ä¸º true ï¼Œä»¥ä¾¿æˆ‘ä»¬çš„æŸ¥è¯¢ç»„ä»¶åœ¨é‡æ–°åŠ è½½æ—¶é‡æ–°æ¸²æŸ“ã€‚</p>
<pre><code class="language-jsx">const DogPhoto = ({ breed }) =&gt; (
  &lt;Query
    query={GET_DOG_PHOTO}
    variables={{ breed }}
    skip={!breed}
    notifyOnNetworkStatusChange
  &gt;
    {({ loading, error, data, refetch, networkStatus }) =&gt; {
      if (networkStatus === 4) return &quot;Refetching!&quot;;
      if (loading) return null;
      if (error) return `Error!: ${error}`;

      return (
        &lt;div&gt;
          &lt;img
            src={data.dog.displayImage}
            style={{ height: 100, width: 100 }}
          /&gt;
          &lt;button onClick={() =&gt; refetch()}&gt;Refetch!&lt;/button&gt;
        &lt;/div&gt;
      );
    }}
  &lt;/Query&gt;
);
</code></pre>
<p><code>networkStatus</code> å±æ€§æ˜¯ä¸€ä¸ªæšä¸¾ï¼Œå…¶æ•°å­—å€¼ä¸º 1-8ï¼Œè¡¨ç¤ºä¸åŒçš„åŠ è½½çŠ¶æ€ã€‚ 4 å¯¹åº”é‡æ–°è·å–ï¼Œä½†ä¹Ÿæœ‰ç”¨äºè½®è¯¢å’Œåˆ†é¡µçš„æ•°å­—å€¼ã€‚ æœ‰å…³æ‰€æœ‰å¯èƒ½åŠ è½½çŠ¶æ€çš„å®Œæ•´åˆ—è¡¨ï¼Œè¯·æŸ¥çœ‹<a href="../api/react-apollo.html#graphql-query-data-networkStatus">å‚è€ƒæŒ‡å—</a>ã€‚</p>
<p>è™½ç„¶æ²¡æœ‰åŠ è½½çŠ¶æ€é‚£ä¹ˆå¤æ‚ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥é€šè¿‡ <code>Query</code> ç»„ä»¶ä¸Šçš„ <code>errorPolicy</code> prop æ¥è‡ªå®šä¹‰ç»„ä»¶ä¸­çš„é”™è¯¯ã€‚ <code>errorPolicy</code> çš„é»˜è®¤å€¼æ˜¯ â€œnoneâ€ ï¼Œæˆ‘ä»¬å°†æ‰€æœ‰ GraphQL é”™è¯¯è§†ä¸ºè¿è¡Œæ—¶é”™è¯¯ã€‚ å¦‚æœå‘ç”Ÿé”™è¯¯ï¼ŒApollo Client å°†ä¸¢å¼ƒéšè¯·æ±‚è¿”å›çš„ä»»ä½•æ•°æ®ï¼Œå¹¶å°† render prop å‡½æ•°ä¸­çš„ <code>error</code> å±æ€§è®¾ç½®ä¸º trueã€‚ å¦‚æœæ‚¨æƒ³æ˜¾ç¤ºä»»ä½•éƒ¨åˆ†æ•°æ®ä»¥åŠä»»ä½•é”™è¯¯ä¿¡æ¯ï¼Œè¯·å°† <code>errorPolicy</code> è®¾ç½®ä¸º â€œallâ€ã€‚</p>
<h2 id="æ‰‹åŠ¨è§¦å‘æŸ¥è¯¢">æ‰‹åŠ¨è§¦å‘æŸ¥è¯¢</h2>
<p>å½“ React å®‰è£…ä¸€ä¸ª <code>Query</code> ç»„ä»¶æ—¶ï¼ŒApollo Client ä¼šè‡ªåŠ¨è§¦å‘ä½ çš„æŸ¥è¯¢ã€‚ å¦‚æœæ‚¨æƒ³å»¶è¿Ÿè§¦å‘æŸ¥è¯¢ï¼Œç›´åˆ°ç”¨æˆ·æ‰§è¡Œæ“ä½œï¼ˆä¾‹å¦‚å•å‡»æŒ‰é’®ï¼‰ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿ å¯¹äºè¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬æƒ³è¦ä½¿ç”¨ <code>ApolloConsumer</code> ç»„ä»¶å¹¶ç›´æ¥è°ƒç”¨ <code>client.query()</code>ã€‚</p>
<pre><code class="language-jsx">import React, { Component } from 'react';
import { ApolloConsumer } from 'react-apollo';

class DelayedQuery extends Component {
  state = { dog: null };

  onDogFetched = dog =&gt; this.setState(() =&gt; ({ dog }));

  render() {
    return (
      &lt;ApolloConsumer&gt;
        {client =&gt; (
          &lt;div&gt;
            {this.state.dog &amp;&amp; &lt;img src={this.state.dog.displayImage} /&gt;}
            &lt;button
              onClick={async () =&gt; {
                const { data } = await client.query({
                  query: GET_DOG_PHOTO,
                  variables: { breed: &quot;bulldog&quot; }
                });
                this.onDogFetched(data.dog);
              }}
            &gt;
              Click me!
            &lt;/button&gt;
          &lt;/div&gt;
        )}
      &lt;/ApolloConsumer&gt;
    );
  }
}
</code></pre>
<p>ä»¥è¿™ç§æ–¹å¼è·å–æ˜¯éå¸¸å†—é•¿çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å»ºè®®å°½å¯èƒ½ä½¿ç”¨ <code>Query</code> ç»„ä»¶ï¼</p>
<blockquote>
<p>å¦‚æœæ‚¨æƒ³æŸ¥çœ‹æˆ‘ä»¬åˆšåˆšæ„å»ºçš„åº”ç”¨ç¨‹åºçš„å®Œæ•´ç‰ˆæœ¬ï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹CodeSandbox <a href="https://codesandbox.io/s/n3jykqpxwm">æ­¤å¤„</a>.</p>
</blockquote>
<h2 id="query-api-æ¦‚è§ˆ">Query API æ¦‚è§ˆ</h2>
<p>å¦‚æœæ‚¨æ­£åœ¨å¯»æ‰¾æ‰€æœ‰ <code>Query</code> ç»„ä»¶æ¥å—åŠå…¶æ¸²æŸ“æ–¹æ³•åŠŸèƒ½çš„æ¦‚è¿°ï¼Œè¯·ä¸è¦å†çœ‹äº†ï¼ å¤§å¤šæ•° <code>Query</code> ç»„ä»¶ä¸éœ€è¦æ‰€æœ‰è¿™äº›é…ç½®é€‰é¡¹ï¼Œä½†çŸ¥é“å®ƒä»¬å­˜åœ¨æ˜¯æœ‰ç”¨çš„ã€‚ å¦‚æœæ‚¨æƒ³é€šè¿‡ä½¿ç”¨ç¤ºä¾‹æ›´è¯¦ç»†åœ°äº†è§£ <code>Query</code> ç»„ä»¶ APIï¼Œè¯·è®¿é—®æˆ‘ä»¬çš„<a href="../api/react-apollo.html">å‚è€ƒæŒ‡å—</a>.</p>
<h3 id="props">Props</h3>
<p>Query ç»„ä»¶æ¥å—ä»¥ä¸‹ propsã€‚ åªæœ‰ <code>query</code> å’Œ <code>children</code>æ˜¯å¿…é¡»çš„ <strong>required</strong>.</p>
<dl>
  <dt>`query`: DocumentNode</dt>
  <dd>GraphQLæŸ¥è¯¢æ–‡æ¡£é€šè¿‡`graphql-tag`è§£æä¸ºASTã€‚ **Required**</dd>
  <dt>`children`: (result: QueryResult) => React.ReactNode</dt>
  <dd>ä¸€ä¸ªå‡½æ•°ï¼Œæ ¹æ®æŸ¥è¯¢ç»“æœè¿”å›è¦æ¸²æŸ“çš„ UIã€‚**Required**</dd>
  <dt>`variables`: { [key: string]: any }</dt>
  <dd>åŒ…å«æ‰§è¡ŒæŸ¥è¯¢éœ€è¦çš„æ‰€æœ‰å˜é‡å¯¹è±¡</dd>
  <dt>`pollInterval`: number</dt>
  <dd>æŒ‡å®šç»„ä»¶è½®è¯¢æ•°æ®çš„æ—¶é—´é—´éš”ï¼ˆä»¥æ¯«ç§’ä¸ºå•ä½ï¼‰ã€‚ é»˜è®¤ä¸º 0ï¼ˆæ— è½®è¯¢ï¼‰ã€‚</dd>
  <dt>`notifyOnNetworkStatusChange`: boolean</dt>
  <dd>æ˜¯å¦æ›´æ–°ç½‘ç»œçŠ¶æ€æˆ–ç½‘ç»œé”™è¯¯åº”é‡æ–°å‘ˆç°ç»„ä»¶ã€‚ é»˜è®¤ä¸ºfalseã€‚</dd>
  <dt>`fetchPolicy`: FetchPolicy</dt>
  <dd>æ‚¨å¸Œæœ›ç»„ä»¶å¦‚ä½•ä¸ Apollo ç¼“å­˜äº¤äº’ã€‚ é»˜è®¤ä¸º â€œcache-firstâ€ã€‚</dd>
  <dt>`errorPolicy`: ErrorPolicy</dt>
  <dd>æ‚¨å¸Œæœ›ç»„ä»¶å¦‚ä½•å¤„ç†ç½‘ç»œå’Œ GraphQL é”™è¯¯ã€‚ é»˜è®¤ä¸º â€œnoneâ€ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å°† GraphQL é”™è¯¯è§†ä¸ºè¿è¡Œæ—¶é”™è¯¯ã€‚</dd>
  <dt>`ssr`: boolean</dt>
  <dd>ä¼ å…¥ false ä»¥åœ¨æœåŠ¡ç«¯æ¸²æŸ“æœŸé—´è·³è¿‡æŸ¥è¯¢ã€‚</dd>
  <dt>`displayName`: string</dt>
  <dd>è¦åœ¨ React DevTools ä¸­æ˜¾ç¤ºçš„ç»„ä»¶çš„åç§°ã€‚ é»˜è®¤ä¸º 'Query'ã€‚</dd>
  <dt>`skip`: boolean</dt>
  <dd>å¦‚æœ skip ä¸º trueï¼Œåˆ™å°†å®Œå…¨è·³è¿‡æŸ¥è¯¢ã€‚</dd>
  <dt>`onCompleted`: (data: TData | {}) => void</dt>
  <dd>æŸ¥è¯¢æˆåŠŸå®Œæˆåæ‰§è¡Œçš„å›è°ƒã€‚</dd>
  <dt>`onError`: (error: ApolloError) => void</dt>
  <dd>å‘ç”Ÿé”™è¯¯æ—¶æ‰§è¡Œçš„å›è°ƒã€‚</dd>
  <dt>`context`: Record<string, any></dt>
  <dd>æŸ¥è¯¢ç»„ä»¶ä¸ç½‘ç»œæ¥å£ï¼ˆApollo Linkï¼‰ä¹‹é—´çš„å…±äº«ä¸Šä¸‹æ–‡ã€‚ ç”¨äºä»é“å…·è®¾ç½®æ ‡é¢˜æˆ–å°†ä¿¡æ¯å‘é€åˆ° Apollo Boost çš„ `request` åŠŸèƒ½ã€‚</dd>
  <dt>`partialRefetch`: boolean</dt>
  <dd>å¦‚æœæ˜¯ `true`ï¼Œå¦‚æœæŸ¥è¯¢ç»“æœè¢«æ ‡è®°ä¸ºéƒ¨åˆ†ï¼Œåˆ™æ‰§è¡ŒæŸ¥è¯¢ `refetch`ï¼Œå¹¶ä¸”ç”± Apollo Client `QueryManager` å°†è¿”å›çš„æ•°æ®é‡ç½®ä¸ºç©ºå¯¹è±¡ï¼ˆç”±äºé«˜é€Ÿç¼“å­˜æœªå‘½ä¸­ï¼‰ã€‚ å‡ºäºå‘åå…¼å®¹æ€§çš„åŸå› ï¼Œé»˜è®¤å€¼ä¸º â€œfalseâ€ï¼Œä½†å¯¹äºå¤§å¤šæ•°å®ä¾‹ï¼Œåº”å°†å…¶æ›´æ”¹ä¸ºtrueã€‚</dd>
</dl>
<h3 id="render-prop-function">Render prop function</h3>
<p>ä½¿ç”¨å…·æœ‰ä»¥ä¸‹å±æ€§çš„å¯¹è±¡ï¼ˆ<code>QueryResult</code>ï¼‰è°ƒç”¨ä¼ é€’ç»™ <code>Query</code> çš„ <code>children</code> prop çš„ render prop å‡½æ•°ã€‚ æ­¤å¯¹è±¡åŒ…å«æ‚¨çš„æŸ¥è¯¢ç»“æœï¼Œä»¥åŠä¸€äº›æœ‰ç”¨çš„å‡½æ•°ï¼Œç”¨äºé‡æ–°è·å–ï¼ŒåŠ¨æ€è½®è¯¢å’Œåˆ†é¡µã€‚</p>
<dl>
  <dt>`data`: TData</dt>
  <dd>åŒ…å« GraphQL æŸ¥è¯¢ç»“æœçš„å¯¹è±¡ã€‚ é»˜è®¤ä¸ºç©ºå¯¹è±¡ã€‚</dd>
  <dt>`loading`: boolean</dt>
  <dd>ä¸€ä¸ªå¸ƒå°”å€¼ï¼ŒæŒ‡ç¤ºè¯·æ±‚æ˜¯å¦åœ¨æ‰§è¡Œä¸­</dd>
  <dt>`error`: ApolloError</dt>
  <dd>ä½¿ç”¨ `graphQLErrors` å’Œ `networkError` å±æ€§çš„è¿è¡Œæ—¶é”™è¯¯</dd>
  <dt>`variables`: { [key: string]: any }</dt>
  <dd>åŒ…å«è°ƒç”¨æŸ¥è¯¢çš„å˜é‡å¯¹è±¡</dd>
  <dt>`networkStatus`: NetworkStatus</dt>
  <dd>1-8 ä¹‹é—´çš„æ•°å­—ï¼Œå¯¹åº”ç½‘ç»œè¯·æ±‚çš„è¯¦ç»†çŠ¶æ€ã€‚ åŒ…æ‹¬æœ‰å…³é‡æ–°è·å–å’Œè½®è¯¢çŠ¶æ€çš„ä¿¡æ¯ã€‚ ä¸ `notifyOnNetworkStatusChange` é“å…·ä¸€èµ·ä½¿ç”¨ã€‚
</dd>
  <dt>`refetch`: (variables?: TVariables) => Promise<ApolloQueryResult></dt>
  <dd>ä¸€ä¸ªå…è®¸æ‚¨é‡æ–°è·å–æŸ¥è¯¢å¹¶å¯é€‰åœ°ä¼ å…¥æ–°å˜é‡çš„å‡½æ•°</dd>
  <dt>`fetchMore`: ({ query?: DocumentNode, variables?: TVariables, updateQuery: Function}) => Promise<ApolloQueryResult></dt>
  <dd>ä¸ºæ‚¨çš„æŸ¥è¯¢å¯ç”¨ [pagination](../features/pagination.html) çš„å‡½æ•°</dd>
  <dt>`startPolling`: (interval: number) => void</dt>
  <dd>æ­¤å‡½æ•°ä»¥ ms ä¸ºå•ä½è®¾ç½®é—´éš”ï¼Œå¹¶åœ¨æ¯æ¬¡æŒ‡å®šçš„é—´éš”é€šè¿‡æ—¶è·å–æŸ¥è¯¢ã€‚</dd>
  <dt>`stopPolling`: () => void</dt>
  <dd>æ­¤å‡½æ•°åœæ­¢æŸ¥è¯¢è½®è¯¢ã€‚</dd>
  <dt>`subscribeToMore`: (options: { document: DocumentNode, variables?: TVariables, updateQuery?: Function, onError?: Function}) => () => void</dt>
  <dd>è®¾ç½® [subscription](../advanced/subscriptions.html) çš„å‡½æ•°ã€‚ `subscribeToMore` è¿”å›ä¸€ä¸ªå¯ç”¨äºå–æ¶ˆè®¢é˜…çš„å‡½æ•°ã€‚</dd>
  <dt>`updateQuery`: (previousResult: TData, options: { variables: TVariables }) => TData</dt>
  <dd>å‡½æ•°ï¼Œå…è®¸æ‚¨åœ¨è·å–ï¼Œå˜å¼‚æˆ–è®¢é˜…çš„ä¸Šä¸‹æ–‡ä¹‹å¤–çš„ç¼“å­˜ä¸­æ›´æ–°æŸ¥è¯¢çš„ç»“æœ</dd>
  <dt>`client`: ApolloClient</dt>
  <dd>ä½ çš„ 'ApolloClient` å®ä¾‹ã€‚ ç”¨äºæ‰‹åŠ¨è§¦å‘æŸ¥è¯¢æˆ–å°†æ•°æ®å†™å…¥ã€‚</dd>
</dl>
<h2 id="ä¸‹ä¸€æ­¥">ä¸‹ä¸€æ­¥</h2>
<p>å­¦ä¹ å¦‚ä½•æ„å»º <code>Query</code> ç»„ä»¶æ¥è·å–æ•°æ®æ˜¯æŒæ¡ Apollo Client å¼€å‘çš„æœ€é‡è¦æŠ€èƒ½ä¹‹ä¸€ã€‚ æ—¢ç„¶æ‚¨æ˜¯è·å–æ•°æ®çš„ä¸“å®¶ï¼Œä¸ºä»€ä¹ˆä¸å°è¯•æ„å»º <code>Mutation</code> ç»„ä»¶æ¥æ›´æ–°æ‚¨çš„æ•°æ®ï¼Ÿ ä»¥ä¸‹æ˜¯æˆ‘ä»¬è®¤ä¸ºå¯ä»¥å¸®åŠ©æ‚¨æå‡æŠ€èƒ½çš„ä¸€äº›èµ„æºï¼š</p>
<ul>
<li><a href="./mutations.html">Mutations</a>: äº†è§£å¦‚ä½•ä½¿ç”¨çªå˜æ›´æ–°æ•°æ®ä»¥åŠä½•æ—¶éœ€è¦æ›´æ–° Apollo ç¼“å­˜ã€‚ æœ‰å…³é€‰é¡¹çš„å®Œæ•´åˆ—è¡¨ï¼Œè¯·æŸ¥çœ‹ <code>Mutation</code> ç»„ä»¶çš„APIå‚è€ƒã€‚</li>
<li><a href="./local-state.html">Local state management</a>: å­¦ä¹ å¦‚ä½•ä½¿ç”¨ <code>apollo-link-state</code> æŸ¥è¯¢æœ¬åœ°æ•°æ®ã€‚</li>
<li><a href="../features/pagination.html">Pagination</a>: åŸºäº Apollo Client çš„ <code>fetchMore</code> åŠŸèƒ½ï¼Œæ„å»ºåˆ—è¡¨ä»æœªå¦‚æ­¤ç®€å•ã€‚ åœ¨æˆ‘ä»¬çš„åˆ†é¡µæ•™ç¨‹ä¸­äº†è§£æ›´å¤šä¿¡æ¯ã€‚</li>
<li><a href="https://youtu.be/YHJ2CaS0vpM">Query component video by Sara Vieira</a>: å¦‚æœæ‚¨éœ€è¦é€šè¿‡è§‚çœ‹è§†é¢‘è¿›è¡Œå¤ä¹ æˆ–å­¦ä¹ ï¼Œè¯·æŸ¥çœ‹ Sara çš„ <code>Query</code> ç»„ä»¶çš„æ•™ç¨‹ï¼</li>
</ul>

              </div>
              <div class="toc-container">
                <ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#query%E7%BB%84%E4%BB%B6">Queryç»„ä»¶</a></li>
<li><a href="#%E6%8E%A5%E6%94%B6%E6%95%B0%E6%8D%AE">æ¥æ”¶æ•°æ®</a></li>
<li><a href="#%E8%BD%AE%E8%AF%A2%E5%92%8C%E9%87%8D%E6%96%B0%E8%8E%B7%E5%8F%96">è½®è¯¢å’Œé‡æ–°è·å–</a></li>
<li><a href="#%E5%8A%A0%E8%BD%BD%E5%92%8C%E9%94%99%E8%AF%AF%E7%8A%B6%E6%80%81">åŠ è½½å’Œé”™è¯¯çŠ¶æ€</a></li>
<li><a href="#%E6%89%8B%E5%8A%A8%E8%A7%A6%E5%8F%91%E6%9F%A5%E8%AF%A2">æ‰‹åŠ¨è§¦å‘æŸ¥è¯¢</a></li>
<li><a href="#query-api-%E6%A6%82%E8%A7%88">Query API æ¦‚è§ˆ</a>
<ul>
<li><a href="#props">Props</a></li>
<li><a href="#render-prop-function">Render prop function</a></li>
</ul>
</li>
<li><a href="#%E4%B8%8B%E4%B8%80%E6%AD%A5">ä¸‹ä¸€æ­¥</a></li>
</ul>
</li>
</ul>

              </div>
            </div>
          </article>
        </div>

        
          <div class="next-post">
            <div class="next">ä¸‹ä¸€ç¯‡</div>
            <a href="https://fanguyun214.github.io/post/gitlab-ci-qian-duan-chi-xu-ji-cheng/">
              <h3 class="post-title">
                Gitlab-CIå‰ç«¯æŒç»­é›†æˆ
              </h3>
            </a>
          </div>
        

        
          
            <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>

<div id="gitalk-container"></div>

<script>

  var gitalk = new Gitalk({
    clientID: '94fca913faabe61337e0',
    clientSecret: '9ee8a359f64b424f77e6fba28063b59788b92af1',
    repo: 'fanguyun214.github.io',
    owner: 'fanguyun214',
    admin: ['fanguyun214'],
    id: (location.pathname).substring(0, 49),      // Ensure uniqueness and length less than 50
    distractionFreeMode: false  // Facebook-like distraction free mode
  })

  gitalk.render('gitalk-container')

</script>

          

          
        

        <div class="site-footer">
  Powered by Jasonfan & Grider  ğŸ–¥ | 
  <a class="rss" href="https://fanguyun214.github.io/atom.xml" target="_blank">RSS</a>
</div>

<script>
  hljs.initHighlightingOnLoad()

  let mainNavLinks = document.querySelectorAll(".markdownIt-TOC a");

  // This should probably be throttled.
  // Especially because it triggers during smooth scrolling.
  // https://lodash.com/docs/4.17.10#throttle
  // You could do like...
  // window.addEventListener("scroll", () => {
  //    _.throttle(doThatStuff, 100);
  // });
  // Only not doing it here to keep this Pen dependency-free.

  window.addEventListener("scroll", event => {
    let fromTop = window.scrollY;

    mainNavLinks.forEach((link, index) => {
      let section = document.getElementById(decodeURI(link.hash).substring(1));
      let nextSection = null
      if (mainNavLinks[index + 1]) {
        nextSection = document.getElementById(decodeURI(mainNavLinks[index + 1].hash).substring(1));
      }
      console.log('section.offsetHeight', section.offsetHeight);
      if (section.offsetTop <= fromTop) {
        if (nextSection) {
          if (nextSection.offsetTop > fromTop) {
            link.classList.add("current");
          } else {
            link.classList.remove("current");    
          }
        } else {
          link.classList.add("current");
        }
      } else {
        link.classList.remove("current");
      }
    });
  });

</script>

      </div>
    </div>
  </body>
</html>
