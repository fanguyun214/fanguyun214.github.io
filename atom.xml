<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://fanguyun214.github.io</id>
    <title>Jasonå‡¡ Blog</title>
    <updated>2020-12-16T10:55:59.433Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://fanguyun214.github.io"/>
    <link rel="self" href="https://fanguyun214.github.io/atom.xml"/>
    <subtitle>ğŸŒ±ğŸŒ±ğŸŒ± æ¯ä¸ªäººçš„ç”Ÿæ´»éƒ½æ˜¯ä¸€æ¡é€šå‘è‡ªèº«çš„é“è·¯ï¼Œæ‰¾åˆ°è‡ªæˆ‘ï¼Œåœ¨å¿ƒä¸­åšå®ˆä¸€ç”Ÿï¼Œå…¨å¿ƒå…¨æ„ï¼Œæ°¸ä¸åœæ¯ ğŸŒ±ğŸŒ±ğŸŒ±</subtitle>
    <logo>https://fanguyun214.github.io/images/avatar.png</logo>
    <icon>https://fanguyun214.github.io/favicon.ico</icon>
    <rights>All rights reserved 2020, Jasonå‡¡ Blog</rights>
    <entry>
        <title type="html"><![CDATA[Docker&k8så…¥é—¨]]></title>
        <id>https://fanguyun214.github.io/post/dockerandk8s-ru-men/</id>
        <link href="https://fanguyun214.github.io/post/dockerandk8s-ru-men/">
        </link>
        <updated>2020-12-16T10:45:28.000Z</updated>
        <summary type="html"><![CDATA[<p>Docker æ˜¯ä¸€ä¸ªå¼€æºçš„åº”ç”¨å®¹å™¨å¼•æ“ï¼ŒåŸºäº Go è¯­è¨€ å¹¶éµä» Apache2.0 åè®®å¼€æºã€‚<br>
Docker å¯ä»¥è®©å¼€å‘è€…æ‰“åŒ…ä»–ä»¬çš„åº”ç”¨ä»¥åŠä¾èµ–åŒ…åˆ°ä¸€ä¸ªè½»é‡çº§ã€å¯ç§»æ¤çš„å®¹å™¨ä¸­ï¼Œç„¶åå‘å¸ƒåˆ°ä»»ä½•æµè¡Œçš„ Linux æœºå™¨ä¸Šï¼Œä¹Ÿå¯ä»¥å®ç°è™šæ‹ŸåŒ–ã€‚<br>
å®¹å™¨æ˜¯å®Œå…¨ä½¿ç”¨æ²™ç®±æœºåˆ¶ï¼Œç›¸äº’ä¹‹é—´ä¸ä¼šæœ‰ä»»ä½•æ¥å£ï¼ˆç±»ä¼¼ iPhone çš„ appï¼‰,æ›´é‡è¦çš„æ˜¯å®¹å™¨æ€§èƒ½å¼€é”€æä½ã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>Docker æ˜¯ä¸€ä¸ªå¼€æºçš„åº”ç”¨å®¹å™¨å¼•æ“ï¼ŒåŸºäº Go è¯­è¨€ å¹¶éµä» Apache2.0 åè®®å¼€æºã€‚<br>
Docker å¯ä»¥è®©å¼€å‘è€…æ‰“åŒ…ä»–ä»¬çš„åº”ç”¨ä»¥åŠä¾èµ–åŒ…åˆ°ä¸€ä¸ªè½»é‡çº§ã€å¯ç§»æ¤çš„å®¹å™¨ä¸­ï¼Œç„¶åå‘å¸ƒåˆ°ä»»ä½•æµè¡Œçš„ Linux æœºå™¨ä¸Šï¼Œä¹Ÿå¯ä»¥å®ç°è™šæ‹ŸåŒ–ã€‚<br>
å®¹å™¨æ˜¯å®Œå…¨ä½¿ç”¨æ²™ç®±æœºåˆ¶ï¼Œç›¸äº’ä¹‹é—´ä¸ä¼šæœ‰ä»»ä½•æ¥å£ï¼ˆç±»ä¼¼ iPhone çš„ appï¼‰,æ›´é‡è¦çš„æ˜¯å®¹å™¨æ€§èƒ½å¼€é”€æä½ã€‚</p>
<!-- more -->
<h3 id="dopckerå¸¸ç”¨å‘½ä»¤">Dopckerå¸¸ç”¨å‘½ä»¤</h3>
<pre><code>docker pull image - æ‹‰å–Image
docker container ls -a - åˆ—å‡ºæ‰€æœ‰å®¹å™¨
docker run -it centos - äº¤äº’å¼è¿è¡Œ
docker run -d containerid - åå°æ‰§è¡Œ
docker run -p 80 imageid - å°†å®¹å™¨çš„80ç«¯å£éšæœºæ˜ å°„åˆ°å®¿ä¸»æœºçš„ä¸€ä¸ªç«¯å£ä¸Š
docker run -p 8000:80 imageid - å°†å®¹å™¨çš„80ç«¯å£æ˜ å°„åˆ°å®¿ä¸»æœºçš„8000ç«¯å£ä¸Š
docker run --name web image - ä»¥åˆ«åå¯åŠ¨Image
docker container rm id - åˆ é™¤container
docker imgae rm id - åˆ é™¤Image
docker container ls -aq  - åˆ—å‡ºæ‰€æœ‰container ID
docker rm $(docker container ls -aq) - åˆ é™¤æ‰€æœ‰container
docker rm $(docker coontainer ls -f &quot;status=exited&quot; -q) - åˆ é™¤æ‰€æœ‰å·²é€€å‡ºçš„container
docker commit containerName repository - åŸºäºcontaineræ„å»ºImageï¼ˆä¸æå€¡ï¼Œå»ºè®®é€šè¿‡Dockfileï¼‰
docker history imageid  - Imageå†å²è®°å½•
docker build -t repository . - åŸºäºå½“å‰ç›®å½•Dockerfileæ„å»ºImage
more Dockerfile - æŸ¥çœ‹Dockerfile
docker ps -a - æ˜¾ç¤ºæ‰€æœ‰çš„å®¹å™¨ï¼ŒåŒ…æ‹¬æœªè¿è¡Œçš„
docker run -d --link redis --name flask-redis -e REDIS_HOST=redis -p 6000:5000 jasonfan123/flask-redis - containeiäº’ç›¸è®¿é—®è®¾ç½®ï¼ˆ-eè®¾ç½®ç¯å¢ƒå˜é‡ï¼‰
docker rm -f container - å¼ºåˆ¶åœæ­¢å¹¶åˆ é™¤container
Dokcer Containeræ“ä½œ
docker exex -it containerid /bin/bash - è¿›å…¥æŒ‡å®šå®¹å™¨æ‰§è¡ŒæŒ‡å®šå‘½ä»¤
docker stop containerid - åœæ­¢è¿è¡Œä¸­çš„container
docker start containerid - å¯åŠ¨åœæ­¢çš„container
docker inspect containerid - containerè¯¦ç»†ä¿¡æ¯
</code></pre>
<h3 id="dockerfileåŸºæœ¬è¯­æ³•">DockerfileåŸºæœ¬è¯­æ³•</h3>
<pre><code># FROM - åŸºç¡€é•œåƒï¼Œå°½é‡ä½¿ç”¨å®˜æ–¹Imageä½œä¸ºBaseImage
FROM scratch # - åˆ¶ä½œbaseImageï¼ˆä¸ä½¿ç”¨ä»»ä½•Imageï¼‰
FROM centos # - ä½¿ç”¨baseImage
# LABEL - Imageä¿¡æ¯æè¿°,Metadataä¸å¯å°‘
LABEL version=&quot;1.0&quot;
LABEL description=&quot;this is des&quot;
# RUN - æ‰§è¡Œå‘½ä»¤å¹¶åˆ›å»ºæ–°çš„Image Layerï¼Œé¿å…æ— ç”¨åˆ†å±‚ï¼Œåˆå¹¶å¤šæ¡å‘½ä»¤ä¸ºä¸€è¡Œç”¨&amp;&amp;ï¼Œ å¤æ‚çš„å¯ç”¨åæ–œæ \æ¢è¡Œ
RUN yum update &amp;&amp; yum install -y vim \ python-dev  # - åæ–œæ†æ¢è¡Œ
RUN apt-get update &amp;&amp; apt-get install -y perl &amp;&amp; rm -rf \ var/lib/apt/list/* # - æ³¨æ„æ¸…ç†cache
# WORKDIR - è®¾å®šå½“å‰å·¥ä½œç›®å½•,ç”¨WORKDIR,ä¸è¦ç”¨RUN cdï¼Œå°½é‡ä½¿ç”¨ç»å¯¹ç›®å½•
WORKDIR /test # - å¦‚æœæ²¡æœ‰ä¼šè‡ªåŠ¨åˆ›å»ºtestç›®å½•
WORKDIR demo
RUN pwd # - è¾“å‡ºç»“æœåº”è¯¥æ˜¯/test/demo
# ADD &amp;&amp; COPY - æŠŠæœ¬åœ°ç¯å¢ƒæ–‡ä»¶æ·»åŠ åˆ°docker Imageä¸­
# ADD or COPY - å¤§éƒ¨åˆ†æƒ…å†µCOPYä¼˜äºADDï¼ŒADDé™¤äº†COPYè¿˜æœ‰é¢å¤–åŠŸèƒ½ï¼ˆè§£å‹ï¼‰ï¼Œæ·»åŠ è¿œç¨‹æ–‡ä»¶/ç›®å½•è¯·ä½¿ç”¨curlæˆ–è€…wget
ADD hello /
ADD test.tar.gz / # - æ·»åŠ åˆ°æ ¹ç›®å½•å¹¶è§£å‹
WORKDIR /root
ADD hello test/ - /root/test/hello
WORKDIR /ROOT
COPY hello test/ 
# ENV - è®¾ç½®ç¯å¢ƒå¸¸é‡ï¼Œå°½é‡ä½¿ç”¨ENVå¢åŠ å¯ç»´æŠ¤æ€§
ENV MYSQL_VERSION 5.6 # - è®¾ç½®å¸¸é‡
RUN apt-get install -y mysql-server=&quot;${MYSQL_VERSION}&quot; \ &amp;&amp; rm -rf /var/lib/apt/lists/* # - å¼•ç”¨å¸¸é‡
# VOLUME &amp;&amp; EXPOER - å­˜å‚¨å’Œç½‘ç»œ
# CMD &amp;&amp; ENTRYPOINT
# CMD - è®¾ç½®å®¹å™¨å¯åŠ¨åé»˜è®¤æ‰§è¡Œçš„å‘½ä»¤å’Œå‚æ•°ï¼Œå¦‚æœdocker runæŒ‡å®šäº†å…¶ä»–å‘½ä»¤ï¼ŒCMDå‘½ä»¤è¢«å¿½ç•¥ï¼Œå¦‚æœå®šä¹‰äº†å¤šä¸ªCMDï¼Œåªæœ‰æœ€åä¸€ä¸ªä¼šæ‰§è¡Œ
# ENTRYPOINT -  è®¾ç½®å®¹å™¨å¯åŠ¨æ—¶è¿è¡Œçš„å‘½ä»¤ï¼Œè®©å®¹å™¨ä»¥åº”ç”¨ç¨‹åºæˆ–è€…æœåŠ¡çš„å½¢å¼è¿è¡Œï¼Œä¸ä¼šè¢«å¿½ç•¥ä¸€å®šä¼šæ‰§è¡Œï¼Œæœ€ä½³å®è·µï¼šå†™ä¸€ä¸ªshellè„šæœ¬ä½œä¸ºentrypoint
COPY docker-entrypoint.sh /usr/local/bin/
ENTRYPOINT [&quot;docker-entrypoint.sh&quot;]
# Shellå’ŒExecæ ¼å¼
# Shellæ ¼å¼ - é»˜è®¤shell
RUN apt-get install -y vim
CMD echo &quot;hello docker&quot;
ENTRYPOINT echo â€œhello dockerâ€ 
# Execæ ¼å¼ - æŒ‡å®š
RUN [&quot;apt-get&quot;,&quot;install&quot;, &quot;-y&quot;,&quot;vim&quot;]
CMD [&quot;/bin/echo&quot;, &quot;hello docker&quot;]
ENTRYPOINT [&quot;/bin/echo&quot;, &quot;hello docker&quot;]
Docker Image Push
docker login
docker push jasonfan123/centos-vim-new:latest
</code></pre>
<h3 id="æ•°æ®æŒä¹…åŒ–">æ•°æ®æŒä¹…åŒ–</h3>
<pre><code># Dockerfile VOLUME # volumeç»•è¿‡containerçš„æ–‡ä»¶ç³»ç»Ÿï¼Œç›´æ¥å°†æ•°æ®å†™åˆ°hostæœºå™¨ä¸Šï¼Œåªæ˜¯volumeæ˜¯è¢«dockerç®¡ç†çš„ï¼Œdockerä¸‹æ‰€æœ‰çš„volumeéƒ½åœ¨hostæœºå™¨ä¸Šçš„æŒ‡å®šç›®å½•ä¸‹/var/lib/docker/volumes
# VOLUME /var/lib/mysql
docker volume ls - æŸ¥çœ‹volume
docker run -v mysql:/var/lib/mysql - é‡å‘½åvolume:è·¯åŠ²
# Bind Mouting
docker -v $(pwd):/root/aaa - å°†å®¿ä¸»æœºå½“å‰ç›®å½•æ˜ å°„åˆ°å®¹å™¨ç›®å½•
</code></pre>
<h3 id="docker-compose">Docker Compose</h3>
<pre><code>å¤šå®¹å™¨åº”ç”¨ï¼šæ‹‰å–å¤šä¸ªimageã€åˆ›å»ºå¤šä¸ªcontainerã€è¦ç®¡ç†è¿™äº›container
Docker Compose æ‰¹å¤„ç†ï¼ŒåŸºäºDockerçš„å‘½ä»¤è¡Œå·¥å…·ï¼Œé€šè¿‡ä¸€ä¸ªymlæ–‡ä»¶å®šä¹‰å¤šå®¹å™¨çš„Dockeråº”ç”¨ï¼Œé€šè¿‡ä¸€æ¡å‘½ä»¤å°±å¯ä»¥æ ¹æ®ymlæ–‡ä»¶å»åˆ›å»ºæˆ–è€…ç®¡ç†è¿™ä¸ªå¤šä¸ªå®¹å™¨
# é»˜è®¤åå­—ï¼šdocker-compose.yml
# ä¸‰å¤§æ¦‚å¿µï¼š Servicesã€Networksã€Volumes
# Servicesï¼š
    ä¸€ä¸ªserviceä»£è¡¨ä¸€ä¸ªcontainerï¼Œå¯ä»¥ä»è¿œç¨‹æ‹‰å–iamgeï¼Œä¹Ÿå¯ä»¥ä»æœ¬åœ°çš„dockerfile buildå‡ºæ¥image
    serviceçš„å¯åŠ¨ç±»ä¼¼docker runï¼Œå¯ä»¥æŒ‡å®šnetworkå’Œvolume
# docker-compose up - å¯åŠ¨å¤šæœ‰ymlæ–‡ä»¶å®¹å™¨ï¼Œé»˜è®¤æ–‡ä»¶docker-compose.yml
# docker-compose up -d - åå°è¿è¡Œ
# docker-compose -f xx.yml up - æŒ‡å®šymlæ–‡ä»¶  
# docker-compose ps - åˆ—å‡ºservices
# docker-compose start - åœæ­¢
# docker-compose stop - åœæ­¢
# docker-compose down - åœæ­¢å¹¶åˆ é™¤
# docker-compose exec mysql bash - è¿›å…¥å®¹å™¨å¹¶æ‰§è¡Œ
# docker-compose up --scale service=3 -d - ç»™serviceæŒ‡å®šå®¹å™¨æ•°é‡ (haproxy)
  
# wordprss &amp; mysql ç¤ºä¾‹
version: '3'
services:
  wordpress:
    image: wordpress
    ports:
      - 8080:80
    environment:
      WORDPRESS_DB_HOST: mysql
      WORDPRESS_DB_PASSWORD: root
    networks:
      - my-bridge
  mysql:
    image: mysql
    environment:
      MYSQL_ROOT_PASSWORD: root
      MYSQL_DATABASE: wordpress
    volumes:
      - mysql-data:/var/lib/mysql
    networks:
      - my-bridge
volumes:
  mysql-data:
networks:
  my-bridge:
    driver: bridge
</code></pre>
<h3 id="swarm-mode">Swarm Mode</h3>
<p>é›†æˆåœ¨dockerä¸­çš„å®¹å™¨ç¼–æ’å·¥å…·</p>
<h3 id="åŸºäºdockerçš„devops">åŸºäºDockerçš„devops</h3>
<figure data-type="image" tabindex="1"><img src="https://fanguyun214.github.io/post-images/1608115998615.png" alt="" loading="lazy"></figure>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Nrwl/NXå·¥ä½œåŒºä¸­libå·®å¼‚åŒ–é…ç½®]]></title>
        <id>https://fanguyun214.github.io/post/ji-yu-nrwlnx-de-gong-zuo-qu-zhong-lib-zhong-ru-he-yin-yong-environmentts-chai-yi-hua-pei-zhi/</id>
        <link href="https://fanguyun214.github.io/post/ji-yu-nrwlnx-de-gong-zuo-qu-zhong-lib-zhong-ru-he-yin-yong-environmentts-chai-yi-hua-pei-zhi/">
        </link>
        <updated>2020-12-04T06:14:24.000Z</updated>
        <summary type="html"><![CDATA[<p>åŸºäºenvironmentåœ¨ä¸šåŠ¡ä»£ç ä¸­å®ç°ä¸åŒç¯å¢ƒä¸‹çš„å·®å¼‚åŒ–é…ç½®</p>
]]></summary>
        <content type="html"><![CDATA[<p>åŸºäºenvironmentåœ¨ä¸šåŠ¡ä»£ç ä¸­å®ç°ä¸åŒç¯å¢ƒä¸‹çš„å·®å¼‚åŒ–é…ç½®</p>
<!-- more -->
<h3 id="æ–°å¢å¤šç¯å¢ƒenvironment">æ–°å¢å¤šç¯å¢ƒenvironment</h3>
<h4 id="1-æ–°å¢ç‰¹å®šç¯å¢ƒé…ç½®">1ã€æ–°å¢ç‰¹å®šç¯å¢ƒé…ç½®</h4>
<pre><code># å¦‚ environment.staging.ts
export const environment = {
  production: true,
  staging: true,
  apiUrl: 'http://my-prod-url'
};
</code></pre>
<h4 id="2-åœ¨angularjson-ä¸­æ·»åŠ -staging-ç¯å¢ƒé…ç½®">2ã€åœ¨angular.json ä¸­æ·»åŠ  staging ç¯å¢ƒé…ç½®</h4>
<pre><code>&quot;configurations&quot;: {
  &quot;production&quot;: { ... },
  &quot;staging&quot;: {
    &quot;fileReplacements&quot;: [
      {
        &quot;replace&quot;: &quot;src/environments/environment.ts&quot;,
        &quot;with&quot;: &quot;src/environments/environment.staging.ts&quot;
      }
    ]
  }
}
</code></pre>
<h4 id="3-åŸºäºstagingçš„æ„å»º">3. åŸºäºstagingçš„æ„å»º</h4>
<pre><code>ng build --configuration=staging
</code></pre>
<h3 id="åŸºäºinjectiontokençš„diä¾èµ–æ³¨å…¥">åŸºäºInjectionTokençš„DIï¼ˆä¾èµ–æ³¨å…¥ï¼‰</h3>
<h4 id="1-åœ¨libä¸­åˆ›å»ºç›®å½•app-configåŠindexts">1ã€åœ¨libä¸­åˆ›å»ºç›®å½•app-configåŠindex.ts</h4>
<pre><code>// index.ts å£°æ˜InjectionToken
import { InjectionToken } from '@angular/core';
export const APP_CONFIG = new InjectionToken('Application config');
</code></pre>
<h4 id="2-ä¿®æ”¹tsconfigjsonæ·»åŠ å¯¼å‡ºè·¯å¾„">2ã€ä¿®æ”¹tsconfig.jsonæ·»åŠ å¯¼å‡ºè·¯å¾„</h4>
<pre><code>&quot;paths&quot;: {
      &quot;@app-workspace/app-config&quot;: [&quot;libs/app-config/index.ts&quot;]
 }
</code></pre>
<h4 id="3-appmoduletsä¸­providersæ³¨å…¥">3ã€app.module.tsä¸­providersæ³¨å…¥</h4>
<pre><code>import { APP_CONFIG } from '@app-workspace/app-config';
import { environment } from '../environments/environment';

@NgModule({
  declarations: [AppComponent],
  imports: [
    BrowserModule,
    AppRoutingModule,
  ],
  providers: [
    { provide: APP_CONFIG, useValue: environment}
  ],
  bootstrap: [AppComponent]
})
export class AppModule {}
</code></pre>
<h4 id="4-libä¸­ä½¿ç”¨">4ã€libä¸­ä½¿ç”¨</h4>
<pre><code>import { APP_CONFIG } from '@app-workspace/app-config';
import { Inject, Injectable } from '@angular/core';

@Injectable()
export class AuthService {

  constructor(
    @Inject(APP_CONFIG) private appConfig: any
  ) {
        console.log(this.appConfig.apiUrl); 
    }
}
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[docz-è®°å½•ä½ çš„ä¸œè¥¿ä»æœªå¦‚æ­¤ç®€å•]]></title>
        <id>https://fanguyun214.github.io/post/docz-ji-lu-ni-de-dong-xi-cong-wei-ru-ci-jian-dan/</id>
        <link href="https://fanguyun214.github.io/post/docz-ji-lu-ni-de-dong-xi-cong-wei-ru-ci-jian-dan/">
        </link>
        <updated>2020-09-18T03:17:53.000Z</updated>
        <summary type="html"><![CDATA[<p>DoczåŸºäºMDXï¼ŒMDXæ˜¯Markdown + JSXï¼Œå®ƒä¸ºMarkdownå¸¦æ¥äº†ç»„ä»¶ä¸–ç•Œã€‚ MDXä½¿å¾—å¯ä»¥åœ¨Markdownæ ·å¼çš„æ–‡ä»¶ä¸­å¯¼å…¥å’Œä½¿ç”¨ç»„ä»¶ã€‚ Doczå……åˆ†åˆ©ç”¨äº†è¿™ä¸€ç‚¹ï¼Œå¹¶æä¾›äº†è®¸å¤šå†…ç½®ç»„ä»¶ï¼Œè¿™äº›ç»„ä»¶å¯ä»¥å¢å¼ºå’ŒåŠ å¿«æ–‡æ¡£å·¥ä½œæµç¨‹ã€‚Doczè¾“å‡ºé™æ€ç«™ç‚¹ï¼Œä½ å¯ä»¥ä½¿ç”¨ä»»ä½•é™æ€ç½‘ç«™æ‰˜ç®¡æä¾›å•†æ¥éƒ¨ç½²ç”Ÿæˆçš„doczç½‘ç«™ã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>DoczåŸºäºMDXï¼ŒMDXæ˜¯Markdown + JSXï¼Œå®ƒä¸ºMarkdownå¸¦æ¥äº†ç»„ä»¶ä¸–ç•Œã€‚ MDXä½¿å¾—å¯ä»¥åœ¨Markdownæ ·å¼çš„æ–‡ä»¶ä¸­å¯¼å…¥å’Œä½¿ç”¨ç»„ä»¶ã€‚ Doczå……åˆ†åˆ©ç”¨äº†è¿™ä¸€ç‚¹ï¼Œå¹¶æä¾›äº†è®¸å¤šå†…ç½®ç»„ä»¶ï¼Œè¿™äº›ç»„ä»¶å¯ä»¥å¢å¼ºå’ŒåŠ å¿«æ–‡æ¡£å·¥ä½œæµç¨‹ã€‚Doczè¾“å‡ºé™æ€ç«™ç‚¹ï¼Œä½ å¯ä»¥ä½¿ç”¨ä»»ä½•é™æ€ç½‘ç«™æ‰˜ç®¡æä¾›å•†æ¥éƒ¨ç½²ç”Ÿæˆçš„doczç½‘ç«™ã€‚</p>
<!-- more -->
<h4 id="ç‰¹æ€§">ç‰¹æ€§</h4>
<ul>
<li>åŸºäºGatsbyï¼Œå¿«é€Ÿçš„å¼€å‘/æ„å»ºä½“éªŒ</li>
<li>ç®€å•é…ç½®</li>
<li>è‡ªå®šä¹‰ä¸»é¢˜</li>
<li>åŸºäºMDX</li>
<li>æ’ä»¶åŒ–</li>
<li>TypeScriptæ”¯æŒ</li>
</ul>
<h4 id="åŸºæœ¬ä½¿ç”¨">åŸºæœ¬ä½¿ç”¨</h4>
<h5 id="å®‰è£…">å®‰è£…</h5>
<pre><code>yarn add docz react react-dom --dev
</code></pre>
<h5 id="åˆ›å»ºmdxæ–‡ä»¶">åˆ›å»º.mdxæ–‡ä»¶</h5>
<pre><code>---
name: Button
route: /
---

import { Playground, Props } from 'docz'
import { Button } from './'

# Button

&lt;Props of={Button} /&gt;

## Basic usage

&lt;Playground&gt;
  &lt;Button&gt;Click me&lt;/Button&gt;
  &lt;Button kind=&quot;secondary&quot;&gt;Click me&lt;/Button&gt;
&lt;/Playground&gt;
</code></pre>
<h5 id="dev">dev</h5>
<pre><code>yarn docz dev
</code></pre>
<h5 id="build">build</h5>
<p>yarn doczæ„å»ºå°†åœ¨.docz/dist/ä¸­ç”Ÿæˆä¸€ä¸ªé™æ€ç«™ç‚¹ã€‚<br>
é€šè¿‡åœ¨doczrc.jsä¸­æˆ–åœ¨å‘½ä»¤è¡Œä¸­æä¾›destå­—æ®µçš„è·¯å¾„æ¥ä½¿yarn docz buildåˆ°å¦ä¸€ä¸ªç›®å½•ï¼šyarn docz build --dest docs-site-directoryã€‚</p>
<pre><code>yarn docz build
</code></pre>
<h4 id="å…¶ä»–">å…¶ä»–</h4>
<h5 id="åˆ›å»ºæ–°åº”ç”¨">åˆ›å»ºæ–°åº”ç”¨</h5>
<pre><code>npx create-docz-app my-docz-app
# or
yarn create docz-app my-docz-app --example typescript
</code></pre>
<h5 id="æ·»åŠ åˆ°ç°æœ‰é¡¹ç›®">æ·»åŠ åˆ°ç°æœ‰é¡¹ç›®</h5>
<pre><code>yarn add docz # react react-dom
# or
npm install docz # react react-dom
</code></pre>
<h5 id="å†…ç½®ç»„ä»¶">å†…ç½®ç»„ä»¶</h5>
<p>ä½¿ç”¨<Playground>ç»„ä»¶ï¼Œå¯ä»¥åœ¨å¯å®æ—¶ç¼–è¾‘çš„æ¸¸ä¹åœºä¸­æ¸²æŸ“ç»„ä»¶ï¼Œå¹¶ç›´æ¥æŸ¥çœ‹æ‰€ä½¿ç”¨ä»£ç çš„è¾“å‡ºï¼š</p>
<pre><code># Playground Component
---
name: Button
route: /
---

import { Playground } from 'docz'
import { Button } from './Button'

# Button

## Basic usage

&lt;Playground&gt;
  &lt;Button&gt;Click me&lt;/Button&gt;
  &lt;Button kind=&quot;secondary&quot;&gt;Click me&lt;/Button&gt;
&lt;/Playground&gt;
</code></pre>
<h5 id="æ–‡æ¡£è®¾ç½®">æ–‡æ¡£è®¾ç½®</h5>
<pre><code>---
name: My Document
route: /custom-route
menu: Documents
---
</code></pre>
<ul>
<li>nameæ–‡æ¡£çš„åç§°ï¼Œç”¨ä½œé¡µé¢æ ‡é¢˜</li>
<li>route *ï¼ˆå¯é€‰ï¼‰*åˆ°æ–‡æ¡£ç”Ÿæˆé¡µé¢çš„è·¯å¾„æˆ–è·¯å¾„ã€‚ä¾‹å¦‚/docs/my-component</li>
<li>menu*ï¼ˆå¯é€‰ï¼‰*åŒ…å«æ–‡æ¡£çš„èœå•ã€‚æ–‡æ¡£åˆ†ç»„åˆ°ä¸€ä¸ªèœå•ä¸­</li>
</ul>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[å‰ç«¯æ€§èƒ½ä¼˜åŒ–æŒ‡å—]]></title>
        <id>https://fanguyun214.github.io/post/qian-duan-xing-neng-you-hua-zhi-nan/</id>
        <link href="https://fanguyun214.github.io/post/qian-duan-xing-neng-you-hua-zhi-nan/">
        </link>
        <updated>2020-07-24T09:01:29.000Z</updated>
        <summary type="html"><![CDATA[<p>æ€§èƒ½ä¼˜åŒ–ä¸€ç›´ä»¥æ¥éƒ½æ˜¯å‰ç«¯å·¥ç¨‹é¢†åŸŸä¸­çš„ä¸€ä¸ªé‡è¦éƒ¨åˆ†ã€‚ç½‘ç«™åº”ç”¨çš„æ€§èƒ½ï¼ˆåŠ è½½é€Ÿåº¦ã€äº¤äº’æµç•…åº¦ï¼‰ä¼˜åŒ–å¯¹äºæé«˜ç”¨æˆ·ç•™å­˜ã€è½¬åŒ–ç‡ç­‰éƒ½æœ‰ç§¯æå½±å“ã€‚å¯ä»¥ç†è§£ä¸ºï¼Œæå‡ä½ çš„ç½‘ç«™æ€§èƒ½ï¼Œå°±æ˜¯æå‡ä½ çš„ä¸šåŠ¡æ•°æ®ï¼ˆç”šè‡³æ˜¯ä¸šåŠ¡æ”¶å…¥ï¼‰ã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>æ€§èƒ½ä¼˜åŒ–ä¸€ç›´ä»¥æ¥éƒ½æ˜¯å‰ç«¯å·¥ç¨‹é¢†åŸŸä¸­çš„ä¸€ä¸ªé‡è¦éƒ¨åˆ†ã€‚ç½‘ç«™åº”ç”¨çš„æ€§èƒ½ï¼ˆåŠ è½½é€Ÿåº¦ã€äº¤äº’æµç•…åº¦ï¼‰ä¼˜åŒ–å¯¹äºæé«˜ç”¨æˆ·ç•™å­˜ã€è½¬åŒ–ç‡ç­‰éƒ½æœ‰ç§¯æå½±å“ã€‚å¯ä»¥ç†è§£ä¸ºï¼Œæå‡ä½ çš„ç½‘ç«™æ€§èƒ½ï¼Œå°±æ˜¯æå‡ä½ çš„ä¸šåŠ¡æ•°æ®ï¼ˆç”šè‡³æ˜¯ä¸šåŠ¡æ”¶å…¥ï¼‰ã€‚</p>
<!-- more -->
<p>æ€§èƒ½ä¼˜åŒ–å¹¿ä¹‰ä¸Šä¼šåŒ…å«å‰ç«¯ä¼˜åŒ–å’Œåç«¯ä¼˜åŒ–ã€‚åç«¯ä¼˜åŒ–çš„å…³æ³¨ç‚¹æ›´å¤šçš„æ—¶å€™æ˜¯åœ¨å¢åŠ èµ„æºåˆ©ç”¨ç‡ã€é™ä½èµ„æºæˆæœ¬ä»¥åŠæé«˜ç¨³å®šæ€§ä¸Šã€‚ç›¸è¾ƒäºåç«¯ï¼Œå‰ç«¯çš„æ€§èƒ½ä¼˜åŒ–ä¼šæ›´ç›´æ¥ä¸ç”¨æˆ·çš„ä½“éªŒæŒ‚é’©ã€‚ä»ç”¨æˆ·ä½“éªŒä¾§æ¥è¯´ï¼Œå‰ç«¯æœåŠ¡ 5s çš„åŠ è½½æ—¶é—´ä¼˜åŒ–ç¼©å‡ 80%(1s) ä¸åç«¯æœåŠ¡ 50ms çš„å“åº”ä¼˜åŒ–ç¼©å‡ 80%(10ms) ç›¸æ¯”ï¼Œç”¨æˆ·çš„ä½“éªŒæå‡ä¼šæ›´å¤§ã€‚å› æ­¤å¾ˆå¤šæ—¶å€™ï¼Œä¸ä½“éªŒç›¸å…³çš„æ€§èƒ½çš„ç“¶é¢ˆä¼šå‡ºç°åœ¨å‰ç«¯ã€‚</p>
<h3 id="ç›®çš„">ç›®çš„</h3>
<ul>
<li>
<p>è®©é¡µé¢åŠ è½½çš„æ›´å¿«</p>
</li>
<li>
<p>å¯¹ç”¨æˆ·æ“ä½œå“åº”æ›´åŠæ—¶ï¼Œä¸ºç”¨æˆ·å¸¦æ¥æ›´å¥½çš„ä½¿ç”¨ä½“éªŒ</p>
</li>
<li>
<p>å‡å°‘è¯·æ±‚ï¼Œé™ä½æœåŠ¡å™¨è´Ÿè·ï¼ŒèŠ‚çœèµ„æº</p>
</li>
</ul>
<h3 id="åŸåˆ™">åŸåˆ™</h3>
<ul>
<li>
<p>å»ºç«‹æ€§èƒ½ä¼˜åŒ–æ„è¯†</p>
</li>
<li>
<p>ç›®æ ‡ï¼šæ¯”ä½ æœ€å¿«çš„ç«äº‰å¯¹æ‰‹å¿«è‡³å°‘20%</p>
</li>
<li>
<p>é€‰æ‹©æ­£ç¡®çš„æŒ‡æ ‡</p>
</li>
<li>
<p>ä»å…·æœ‰ä»£è¡¨æ€§çš„ç”¨æˆ·ä½¿ç”¨çš„è®¾å¤‡æ”¶é›†æ•°æ®</p>
</li>
<li>
<p>æ·±å…¥ç†è§£ä¸šåŠ¡</p>
</li>
</ul>
<h3 id="å¦‚ä½•è¡¡é‡">å¦‚ä½•è¡¡é‡</h3>
<pre><code>ä»¥ç”¨æˆ·ä¸ºä¸­å¿ƒçš„æ€§èƒ½æŒ‡æ ‡ï¼š
</code></pre>
<p>â€‹		1ã€å“ªäº›æŒ‡æ ‡èƒ½å¤Ÿæœ€å‡†ç¡®çš„è¡¡é‡ç”¨æˆ·æ‰€æ„Ÿå—åˆ°çš„æ€§èƒ½ï¼Ÿ</p>
<p>â€‹		2ã€å¦‚ä½•é’ˆå¯¹å®é™…ç”¨æˆ·æ¥è¡¡é‡è¿™äº›æŒ‡æ ‡ï¼Ÿ</p>
<p>â€‹		3ã€å¦‚ä½•è§£è¯»è¡¡é‡ç»“æœä»¥ç¡®å®šåº”ç”¨æ˜¯å¦é€Ÿåº¦å¿«ï¼Ÿ</p>
<p>â€‹		4ã€äº†è§£åº”ç”¨çš„å®é™…ç”¨æˆ·æ€§èƒ½ä¹‹åï¼Œå¦‚ä½•é¿å…æ€§èƒ½ä¸‹é™å¹¶åœ¨æœªæ¥æé«˜æ€§èƒ½ï¼Ÿ</p>
<h3 id="åŸºæœ¬æ¦‚è¿°é›…è™å‰ç«¯ä¼˜åŒ–35æ¡">åŸºæœ¬æ¦‚è¿°ï¼ˆé›…è™å‰ç«¯ä¼˜åŒ–35æ¡ï¼‰</h3>
<h4 id="å†…å®¹">å†…å®¹</h4>
<p>1ã€å°½é‡å‡å°‘HTTPè¯·æ±‚æ•°</p>
<p>80%çš„ç»ˆç«¯ç”¨æˆ·å“åº”æ—¶é—´éƒ½èŠ±åœ¨äº†å‰ç«¯ä¸Šï¼Œå…¶ä¸­å¤§éƒ¨åˆ†æ—¶é—´éƒ½åœ¨ä¸‹è½½é¡µé¢ä¸Šçš„å„ç§ç»„ä»¶ï¼šå›¾ç‰‡ï¼Œæ ·å¼è¡¨ï¼Œè„šæœ¬ç­‰ç­‰ã€‚å‡å°‘ç»„ä»¶æ•°å¿…ç„¶èƒ½å¤Ÿå‡å°‘é¡µé¢æäº¤çš„HTTPè¯·æ±‚æ•°ï¼Œè¿™æ˜¯è®©é¡µé¢æ›´å¿«çš„å…³é”®ã€‚</p>
<p><strong>åˆå¹¶æ–‡ä»¶</strong>æ˜¯é€šè¿‡æŠŠæ‰€æœ‰è„šæœ¬æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­çš„æ–¹å¼æ¥å‡å°‘è¯·æ±‚æ•°çš„ï¼Œå½“ç„¶ï¼Œä¹Ÿå¯ä»¥åˆå¹¶æ‰€æœ‰çš„CSSã€‚</p>
<p>2ã€å‡å°‘DNSæŸ¥æ‰¾</p>
<p>3ã€é¿å…é‡å®šå‘</p>
<p>4ã€è®©Ajaxå¯ç¼“å­˜</p>
<p>5ã€å»¶è¿ŸåŠ è½½</p>
<p>6ã€é¢„åŠ è½½</p>
<p>7ã€å‡å°‘DOMå…ƒç´ æ•°é‡</p>
<p>8ã€åˆ’åˆ†åˆ°ä¸åŒåŸŸå</p>
<p>9ã€å°½é‡å‡å°‘Iframeçš„ä½¿ç”¨</p>
<p>10ã€é¿å…404é”™è¯¯</p>
<h4 id="æœåŠ¡å™¨">æœåŠ¡å™¨</h4>
<p>1ã€ä½¿ç”¨CDN</p>
<p>2ã€æ·»åŠ Expiresæˆ–Cache-Controlå“åº”å¤´ï¼Œä½¿ç”¨ç¼“å­˜</p>
<p>3ã€å¯ç”¨Gzip</p>
<p>4ã€é…ç½®Etag</p>
<p>5ã€å°½æ—©è¾“å‡ºç¼“å­˜</p>
<p>6ã€Ajaxè¯·æ±‚ä½¿ç”¨Get</p>
<p>7ã€é¿å…srcã€hrefä¸ºç©º</p>
<h4 id="cookie">Cookie</h4>
<p>1ã€å‡å°‘cookieä½¿ç”¨</p>
<p>2ã€é™æ€èµ„æºä½¿ç”¨æ— cookieåŸŸå</p>
<h4 id="css">CSS</h4>
<p>1ã€æŠŠæ ·å¼è¡¨æ”¾åœ¨headä¸­</p>
<p>2ã€ä¸è¦ä½¿ç”¨CSSè¡¨è¾¾å¼</p>
<p>3ã€ä½¿ç”¨<link>ä»£æ›¿@import</p>
<p>4ã€ä¸è¦ä½¿ç”¨filter(å·²åºŸå¼ƒï¼Œå¯ç”¨æ¥è§£å†³IEè€ç‰ˆæœ¬pngèƒŒæ™¯é€æ˜é—®é¢˜)</p>
<h4 id="javascript">Javascript</h4>
<p>1ã€è„šæœ¬æ”¾åœ¨é¡µé¢åº•éƒ¨</p>
<p>2ã€ä½¿ç”¨å¤–éƒ¨JSå’ŒCSS</p>
<p>3ã€å‹ç¼©JSå’ŒCSS</p>
<p>4ã€ç§»é™¤é‡å¤è„šæœ¬</p>
<p>5ã€å‡å°‘DOMæ“ä½œ</p>
<p>6ã€ä½¿ç”¨é«˜æ•ˆçš„äº‹ä»¶å¤„ç†</p>
<h4 id="å›¾ç‰‡">å›¾ç‰‡</h4>
<p>1ã€ä¼˜åŒ–å›¾ç‰‡</p>
<p>2ã€ä½¿ç”¨CSS Sprite</p>
<p>3ã€ä¸è¦åœ¨HTMLä¸­ç¼©æ”¾å›¾ç‰‡</p>
<p>4ã€ä½¿ç”¨ä½“ç§¯å°ã€å¯ç¼“å­˜çš„favicon.ico</p>
<h4 id="ç§»åŠ¨ç«¯">ç§»åŠ¨ç«¯</h4>
<p>1ã€ä¿è¯æ‰€æœ‰ç»„ä»¶å°äº25K</p>
<p>2ã€æ‰“åŒ…å†…å®¹ä¸ºåˆ†æ®µï¼ˆmultipartï¼‰æ–‡æ¡£</p>
<h3 id="æ€§èƒ½æ•°æ®é‡‡é›†ç›‘æ§">æ€§èƒ½æ•°æ®é‡‡é›†/ç›‘æ§</h3>
<h4 id="w3c-navigation-timing-apiçš„æ€§èƒ½æŒ‡æ ‡">W3C Navigation Timing APIçš„æ€§èƒ½æŒ‡æ ‡</h4>
<p>W3Cæ€§èƒ½å°ç»„å¼•å…¥äº† Navigation Timing API ï¼Œå®ç°äº†è‡ªåŠ¨ã€ç²¾å‡†çš„é¡µé¢æ€§èƒ½æ‰“ç‚¹ï¼›å¼€å‘è€…å¯ä»¥é€šè¿‡ <code>window.performance</code> å±æ€§è·å–ã€‚</p>
<ul>
<li><code>performance.timing</code> æ¥å£ï¼ˆå®šä¹‰äº†ä» <code>navigationStart</code> è‡³ <code>loadEventEnd</code> çš„ 21 ä¸ªåªè¯»å±æ€§ï¼‰</li>
<li><code>performance.navigation</code>ï¼ˆå®šä¹‰äº†å½“å‰æ–‡æ¡£çš„å¯¼èˆªä¿¡æ¯ï¼Œæ¯”å¦‚æ˜¯é‡è½½è¿˜æ˜¯å‘å‰å‘åç­‰ï¼‰</li>
</ul>
<p>W3C Navigation Timing V2å¤„ç†æ¨¡å‹å›¾:</p>
<figure data-type="image" tabindex="1"><img src="http://raw.githubusercontent.com/fanguyun214/picgo/master/img/timestamp-diagram.svg" alt="" loading="lazy"></figure>
<p>ä»å½“å‰æµè§ˆå™¨çª—å£å¸è½½æ—§é¡µé¢å¼€å§‹ï¼Œåˆ°æ–°é¡µé¢åŠ è½½å®Œæˆï¼Œæ•´ä¸ªè¿‡ç¨‹ä¸€å…±è¢«åˆ‡åˆ†ä¸º 9 ä¸ªå°å—ï¼šæç¤ºå¸è½½æ—§æ–‡æ¡£ã€é‡å®šå‘/å¸è½½ã€åº”ç”¨ç¼“å­˜ã€DNS è§£æã€TCP æ¡æ‰‹ã€HTTP è¯·æ±‚å¤„ç†ã€HTTP å“åº”å¤„ç†ã€DOM å¤„ç†ã€æ–‡æ¡£è£…è½½å®Œæˆã€‚æ¯ä¸ªå°å—çš„é¦–å°¾ã€ä¸­é—´åšäº‹ä»¶åˆ†ç•Œï¼Œå– Unix æ—¶é—´æˆ³ï¼Œä¸¤ä¸¤äº‹ä»¶ä¹‹é—´è®¡ç®—æ—¶é—´å·®ï¼Œä»è€Œè·å–ä¸­é—´è¿‡ç¨‹çš„è€—æ—¶ï¼ˆç²¾ç¡®åˆ°æ¯«ç§’çº§åˆ«ï¼‰ã€‚</p>
<h5 id="æŒ‡æ ‡è§£è¯»">æŒ‡æ ‡è§£è¯»:</h5>
<table>
<thead>
<tr>
<th>å­—æ®µ</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>navigationStart</td>
<td>å½“å‰æµè§ˆå™¨çª—å£çš„å‰ä¸€ä¸ªç½‘é¡µå…³é—­ï¼Œå‘ç”Ÿunloadäº‹ä»¶æ—¶çš„Unixæ¯«ç§’æ—¶é—´æˆ³ã€‚å¦‚æœæ²¡æœ‰å‰ä¸€ä¸ªç½‘é¡µï¼Œåˆ™ç­‰äºfetchStartå±æ€§</td>
</tr>
<tr>
<td>unloadEventStart</td>
<td>å¦‚æœå‰ä¸€ä¸ªç½‘é¡µä¸å½“å‰ç½‘é¡µå±äºåŒä¸€ä¸ªåŸŸåï¼Œåˆ™è¿”å›å‰ä¸€ä¸ªç½‘é¡µçš„unloadäº‹ä»¶å‘ç”Ÿæ—¶çš„Unixæ¯«ç§’æ—¶é—´æˆ³ã€‚å¦‚æœæ²¡æœ‰å‰ä¸€ä¸ªç½‘é¡µï¼Œæˆ–è€…ä¹‹å‰çš„ç½‘é¡µè·³è½¬ä¸æ˜¯åœ¨åŒä¸€ä¸ªåŸŸåå†…ï¼Œåˆ™è¿”å›å€¼ä¸º0</td>
</tr>
<tr>
<td>unloadEventEnd</td>
<td>å¦‚æœå‰ä¸€ä¸ªç½‘é¡µä¸å½“å‰ç½‘é¡µå±äºåŒä¸€ä¸ªåŸŸåï¼Œåˆ™è¿”å›å‰ä¸€ä¸ªç½‘é¡µunloadäº‹ä»¶çš„å›è°ƒå‡½æ•°ç»“æŸæ—¶çš„Unixæ¯«ç§’æ—¶é—´æˆ³ã€‚å¦‚æœæ²¡æœ‰å‰ä¸€ä¸ªç½‘é¡µï¼Œæˆ–è€…ä¹‹å‰çš„ç½‘é¡µè·³è½¬ä¸æ˜¯åœ¨åŒä¸€ä¸ªåŸŸåå†…ï¼Œåˆ™è¿”å›å€¼ä¸º0</td>
</tr>
<tr>
<td>redirectStart</td>
<td>è¿”å›ç¬¬ä¸€ä¸ªHTTPè·³è½¬å¼€å§‹æ—¶çš„Unixæ¯«ç§’æ—¶é—´æˆ³ã€‚å¦‚æœæ²¡æœ‰è·³è½¬ï¼Œæˆ–è€…ä¸æ˜¯åŒä¸€ä¸ªåŸŸåå†…éƒ¨çš„è·³è½¬ï¼Œåˆ™è¿”å›å€¼ä¸º0</td>
</tr>
<tr>
<td>redirectEnd</td>
<td>è¿”å›æœ€åä¸€ä¸ªHTTPè·³è½¬ç»“æŸæ—¶ï¼ˆå³è·³è½¬å›åº”çš„æœ€åä¸€ä¸ªå­—èŠ‚æ¥å—å®Œæˆæ—¶ï¼‰çš„Unixæ¯«ç§’æ—¶é—´æˆ³ã€‚å¦‚æœæ²¡æœ‰è·³è½¬ï¼Œæˆ–è€…ä¸æ˜¯åŒä¸€ä¸ªåŸŸåå†…éƒ¨çš„è·³è½¬ï¼Œåˆ™è¿”å›å€¼ä¸º0</td>
</tr>
<tr>
<td>fetchStart</td>
<td>è¿”å›æµè§ˆå™¨å‡†å¤‡ä½¿ç”¨HTTPè¯·æ±‚è¯»å–æ–‡æ¡£æ—¶çš„Unixæ¯«ç§’æ—¶é—´æˆ³ã€‚è¯¥äº‹ä»¶åœ¨ç½‘é¡µæŸ¥è¯¢æœ¬åœ°ç¼“å­˜ä¹‹å‰å‘ç”Ÿ</td>
</tr>
<tr>
<td>domainLookupStart</td>
<td>è¿”å›åŸŸåæŸ¥è¯¢å¼€å§‹æ—¶çš„Unixæ¯«ç§’æ—¶é—´æˆ³ã€‚å¦‚æœä½¿ç”¨æŒä¹…è¿æ¥ï¼Œæˆ–è€…ä¿¡æ¯æ˜¯ä»æœ¬åœ°ç¼“å­˜è·å–çš„ï¼Œåˆ™è¿”å›å€¼ç­‰åŒäºfetchStartå±æ€§çš„å€¼</td>
</tr>
<tr>
<td>domainLookupEnd</td>
<td>è¿”å›åŸŸåæŸ¥è¯¢ç»“æŸæ—¶çš„Unixæ¯«ç§’æ—¶é—´æˆ³ã€‚å¦‚æœä½¿ç”¨æŒä¹…è¿æ¥ï¼Œæˆ–è€…ä¿¡æ¯æ˜¯ä»æœ¬åœ°ç¼“å­˜è·å–çš„ï¼Œåˆ™è¿”å›å€¼ç­‰åŒäºfetchStartå±æ€§çš„å€¼</td>
</tr>
<tr>
<td>connectStart</td>
<td>è¿”å›HTTPè¯·æ±‚å¼€å§‹å‘æœåŠ¡å™¨å‘é€æ—¶çš„Unixæ¯«ç§’æ—¶é—´æˆ³ã€‚å¦‚æœä½¿ç”¨æŒä¹…è¿æ¥ï¼ˆpersistent connectionï¼‰ï¼Œåˆ™è¿”å›å€¼ç­‰åŒäºfetchStartå±æ€§çš„å€¼</td>
</tr>
<tr>
<td>connectEnd</td>
<td>è¿”å›æµè§ˆå™¨ä¸æœåŠ¡å™¨ä¹‹é—´çš„è¿æ¥å»ºç«‹æ—¶çš„Unixæ¯«ç§’æ—¶é—´æˆ³ã€‚å¦‚æœå»ºç«‹çš„æ˜¯æŒä¹…è¿æ¥ï¼Œåˆ™è¿”å›å€¼ç­‰åŒäºfetchStartå±æ€§çš„å€¼ã€‚è¿æ¥å»ºç«‹æŒ‡çš„æ˜¯æ‰€æœ‰æ¡æ‰‹å’Œè®¤è¯è¿‡ç¨‹å…¨éƒ¨ç»“æŸ</td>
</tr>
<tr>
<td>secureConnectionStart</td>
<td>è¿”å›æµè§ˆå™¨ä¸æœåŠ¡å™¨å¼€å§‹å®‰å…¨é“¾æ¥çš„æ¡æ‰‹æ—¶çš„Unixæ¯«ç§’æ—¶é—´æˆ³ã€‚å¦‚æœå½“å‰ç½‘é¡µä¸è¦æ±‚å®‰å…¨è¿æ¥ï¼Œåˆ™è¿”å›0</td>
</tr>
<tr>
<td>requestStart</td>
<td>è¿”å›æµè§ˆå™¨å‘æœåŠ¡å™¨å‘å‡ºHTTPè¯·æ±‚æ—¶ï¼ˆæˆ–å¼€å§‹è¯»å–æœ¬åœ°ç¼“å­˜æ—¶ï¼‰çš„Unixæ¯«ç§’æ—¶é—´æˆ³</td>
</tr>
<tr>
<td>responseStart</td>
<td>è¿”å›æµè§ˆå™¨ä»æœåŠ¡å™¨æ”¶åˆ°ï¼ˆæˆ–ä»æœ¬åœ°ç¼“å­˜è¯»å–ï¼‰ç¬¬ä¸€ä¸ªå­—èŠ‚æ—¶çš„Unixæ¯«ç§’æ—¶é—´æˆ³</td>
</tr>
<tr>
<td>responseEnd</td>
<td>è¿”å›æµè§ˆå™¨ä»æœåŠ¡å™¨æ”¶åˆ°ï¼ˆæˆ–ä»æœ¬åœ°ç¼“å­˜è¯»å–ï¼‰æœ€åä¸€ä¸ªå­—èŠ‚æ—¶ï¼ˆå¦‚æœåœ¨æ­¤ä¹‹å‰HTTPè¿æ¥å·²ç»å…³é—­ï¼Œåˆ™è¿”å›å…³é—­æ—¶ï¼‰çš„Unixæ¯«ç§’æ—¶é—´æˆ³</td>
</tr>
<tr>
<td>domLoading</td>
<td>è¿”å›å½“å‰ç½‘é¡µDOMç»“æ„å¼€å§‹è§£ææ—¶ï¼ˆå³Document.readyStateå±æ€§å˜ä¸ºâ€œloadingâ€ã€ç›¸åº”çš„readystatechangeäº‹ä»¶è§¦å‘æ—¶ï¼‰çš„Unixæ¯«ç§’æ—¶é—´æˆ³</td>
</tr>
<tr>
<td>domInteractive</td>
<td>è¿”å›å½“å‰ç½‘é¡µDOMç»“æ„ç»“æŸè§£æã€å¼€å§‹åŠ è½½å†…åµŒèµ„æºæ—¶ï¼ˆå³Document.readyStateå±æ€§å˜ä¸ºâ€œinteractiveâ€ã€ç›¸åº”çš„readystatechangeäº‹ä»¶è§¦å‘æ—¶ï¼‰çš„Unixæ¯«ç§’æ—¶é—´æˆ³</td>
</tr>
<tr>
<td>domContentLoadedEventStart</td>
<td>è¿”å›å½“å‰ç½‘é¡µDOMContentLoadedäº‹ä»¶å‘ç”Ÿæ—¶ï¼ˆå³DOMç»“æ„è§£æå®Œæ¯•ã€æ‰€æœ‰è„šæœ¬å¼€å§‹è¿è¡Œæ—¶ï¼‰çš„Unixæ¯«ç§’æ—¶é—´æˆ³</td>
</tr>
<tr>
<td>domContentLoadedEventEnd</td>
<td>è¿”å›å½“å‰ç½‘é¡µæ‰€æœ‰éœ€è¦æ‰§è¡Œçš„è„šæœ¬æ‰§è¡Œå®Œæˆæ—¶çš„Unixæ¯«ç§’æ—¶é—´æˆ³</td>
</tr>
<tr>
<td>domComplete</td>
<td>è¿”å›å½“å‰ç½‘é¡µDOMç»“æ„ç”Ÿæˆæ—¶ï¼ˆå³Document.readyStateå±æ€§å˜ä¸ºâ€œcompleteâ€ï¼Œä»¥åŠç›¸åº”çš„readystatechangeäº‹ä»¶å‘ç”Ÿæ—¶ï¼‰çš„Unixæ¯«ç§’æ—¶é—´æˆ³</td>
</tr>
<tr>
<td>loadEventStart</td>
<td>è¿”å›å½“å‰ç½‘é¡µloadäº‹ä»¶çš„å›è°ƒå‡½æ•°å¼€å§‹æ—¶çš„Unixæ¯«ç§’æ—¶é—´æˆ³ã€‚å¦‚æœè¯¥äº‹ä»¶è¿˜æ²¡æœ‰å‘ç”Ÿï¼Œè¿”å›0</td>
</tr>
<tr>
<td>loadEventEnd</td>
<td>è¿”å›å½“å‰ç½‘é¡µloadäº‹ä»¶çš„å›è°ƒå‡½æ•°è¿è¡Œç»“æŸæ—¶çš„Unixæ¯«ç§’æ—¶é—´æˆ³ã€‚å¦‚æœè¯¥äº‹ä»¶è¿˜æ²¡æœ‰å‘ç”Ÿï¼Œè¿”å›0</td>
</tr>
</tbody>
</table>
<h5 id="å…³é”®æ€§èƒ½æŒ‡æ ‡">å…³é”®æ€§èƒ½æŒ‡æ ‡</h5>
<table>
<thead>
<tr>
<th>å­—æ®µ</th>
<th>æè¿°</th>
<th>è®¡ç®—å…¬å¼</th>
<th>å¤‡æ³¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>First Meaningful Paint (FMP)</td>
<td>é¦–å±æ—¶é—´</td>
<td>æ— </td>
<td>æ— </td>
</tr>
<tr>
<td>fpt</td>
<td>First Paint Timeï¼Œé¦–æ¬¡æ¸²æŸ“æ—¶é—´ï¼ˆç™½å±æ—¶é—´ï¼‰</td>
<td>responseEnd - fetchStart</td>
<td>ä»è¯·æ±‚å¼€å§‹åˆ°æµè§ˆå™¨å¼€å§‹è§£æç¬¬ä¸€æ‰¹HTMLæ–‡æ¡£å­—èŠ‚çš„æ—¶é—´å·®</td>
</tr>
<tr>
<td>tti</td>
<td>Time to Interactï¼Œé¦–æ¬¡å¯äº¤äº’æ—¶é—´</td>
<td>domInteractive - fetchStart</td>
<td>æµè§ˆå™¨å®Œæˆæ‰€æœ‰HTMLè§£æå¹¶ä¸”å®ŒæˆDOMæ„å»ºï¼Œæ­¤æ—¶æµè§ˆå™¨å¼€å§‹åŠ è½½èµ„æº</td>
</tr>
<tr>
<td>ready</td>
<td>HTMLåŠ è½½å®Œæˆæ—¶é—´ï¼Œ å³DOM Readyæ—¶é—´</td>
<td>domContentLoadEventEnd - fetchStart</td>
<td>å¦‚æœé¡µé¢æœ‰åŒæ­¥æ‰§è¡Œçš„JSï¼Œåˆ™åŒæ­¥JSæ‰§è¡Œæ—¶é—´ = ready - tti</td>
</tr>
<tr>
<td>load</td>
<td>é¡µé¢å®Œå…¨åŠ è½½æ—¶é—´</td>
<td>loadEventStart - fetchStart</td>
<td>load = é¦–æ¬¡æ¸²æŸ“æ—¶é—´ + DOMè§£æè€—æ—¶ + åŒæ­¥JSæ‰§è¡Œ + èµ„æºåŠ è½½è€—æ—¶</td>
</tr>
<tr>
<td>firstbyte</td>
<td>é¦–åŒ…æ—¶é—´</td>
<td>responseStart - domainLookupStart</td>
<td>æ— </td>
</tr>
</tbody>
</table>
<h5 id="åŒºé—´æ®µè€—æ—¶">åŒºé—´æ®µè€—æ—¶</h5>
<table>
<thead>
<tr>
<th>å­—æ®µ</th>
<th>æè¿°</th>
<th>è®¡ç®—å…¬å¼</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>dns</td>
<td>DNSæŸ¥è¯¢è€—æ—¶</td>
<td>domainLookupEnd - domainLookupStart</td>
<td>æ— </td>
</tr>
<tr>
<td>tcp</td>
<td>TCPè¿æ¥è€—æ—¶</td>
<td>connectEnd - connectStart</td>
<td>æ— </td>
</tr>
<tr>
<td>ttfb</td>
<td>Time to First Byteï¼ˆTTFBï¼‰ï¼Œè¯·æ±‚å“åº”è€—æ—¶ã€‚</td>
<td>responseStart - requestStart</td>
<td>TTFBæœ‰å¤šç§è®¡ç®—æ–¹å¼</td>
</tr>
<tr>
<td>trans</td>
<td>å†…å®¹ä¼ è¾“è€—æ—¶</td>
<td>responseEnd - responseStart</td>
<td>æ— </td>
</tr>
<tr>
<td>dom</td>
<td>DOMè§£æè€—æ—¶</td>
<td>domInteractive - responseEnd</td>
<td>æ— </td>
</tr>
<tr>
<td>res</td>
<td>èµ„æºåŠ è½½è€—æ—¶</td>
<td>loadEventStart - domContentLoadedEventEnd</td>
<td>è¡¨ç¤ºé¡µé¢ä¸­çš„åŒæ­¥åŠ è½½èµ„æº</td>
</tr>
<tr>
<td>ssl</td>
<td>SSLå®‰å…¨è¿æ¥è€—æ—¶</td>
<td>connectEnd - secureConnectionStart</td>
<td>åªåœ¨HTTPSä¸‹æœ‰æ•ˆ</td>
</tr>
</tbody>
</table>
<h5 id="æ³¨æ„ç‚¹">æ³¨æ„ç‚¹</h5>
<ul>
<li>
<p>é€šè¿‡window.performance.timingæ‰€è·çš„çš„é¡µé¢æ¸²æŸ“æ‰€ç›¸å…³çš„æ•°æ®ï¼Œåœ¨å•é¡µåº”ç”¨ä¸­æ”¹å˜äº†urlä½†ä¸åˆ·æ–°é¡µé¢çš„æƒ…å†µä¸‹æ˜¯ä¸ä¼šæ›´æ–°çš„ã€‚å› æ­¤å¦‚æœä»…ä»…é€šè¿‡è¯¥apiæ˜¯æ— æ³•è·å¾—æ¯ä¸€ä¸ªå­è·¯ç”±æ‰€å¯¹åº”çš„é¡µé¢æ¸²æŸ“çš„æ—¶é—´ã€‚å¦‚æœéœ€è¦ä¸ŠæŠ¥åˆ‡æ¢è·¯ç”±æƒ…å†µä¸‹æ¯ä¸€ä¸ªå­é¡µé¢é‡æ–°renderçš„æ—¶é—´ï¼Œéœ€è¦è‡ªå®šä¹‰ä¸ŠæŠ¥ã€‚</p>
</li>
<li>
<p>é€šè¿‡window.performance.getEntries()æ‰€è·å–çš„èµ„æºåŠ è½½å’Œå¼‚æ­¥è¯·æ±‚æ‰€ç›¸å…³çš„æ•°æ®ï¼Œåœ¨é¡µé¢åˆ‡æ¢è·¯ç”±çš„æ—¶å€™ä¼šé‡æ–°çš„è®¡ç®—ï¼Œå¯ä»¥å®ç°è‡ªåŠ¨çš„ä¸ŠæŠ¥ã€‚</p>
</li>
</ul>
<h4 id="spaæ¨¡å¼">SPAæ¨¡å¼</h4>
<p>Navigation Timing APIå¯ä»¥ç›‘æ§å¤§éƒ¨åˆ†å‰ç«¯é¡µé¢çš„æ€§èƒ½ã€‚ä½†éšç€SPAæ¨¡å¼çš„ç››è¡Œï¼Œç±»ä¼¼Angular/Reac/Vuetç­‰æ¡†æ¶çš„æ™®åŠï¼Œé¡µé¢å†…å®¹æ¸²æŸ“çš„æ—¶æœºè¢«æ”¹å˜äº†ï¼ŒW3Cæ ‡å‡†æ— æ³•å®Œå…¨æ»¡è¶³åŸæ¥çš„ç›‘æ§æ„ä¹‰ã€‚ä»¥Chromeä¸ºé¦–çš„æµè§ˆå™¨ä¸€ç›´åœ¨æ¨åŠ¨ä»¥ç”¨æˆ·ä¸ºä¸­å¿ƒçš„æ€§èƒ½æŒ‡æ ‡ï¼Œå¹¶ä¸”é€æ­¥å¼€æ”¾APIã€‚å¦‚lighthouseï¼ŒWeb Vitalsç­‰æä¾›æµè§ˆå™¨æ’ä»¶/å‘½ä»¤è¡Œå·¥å…·/NPMåŒ…ã€‚</p>
<h5 id="å…³æ³¨ç‚¹">å…³æ³¨ç‚¹</h5>
<table>
<thead>
<tr>
<th>ä½“éªŒ</th>
<th>æŒ‡æ ‡</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ˜¯å¦å‘ç”Ÿ</td>
<td>é¦–æ¬¡ç»˜åˆ¶(FP)é¦–æ¬¡å†…å®¹ç»˜åˆ¶(FCP)</td>
</tr>
<tr>
<td>æ˜¯å¦æœ‰ç”¨</td>
<td>é¦–æ¬¡æœ‰æ•ˆç»˜åˆ¶(FMP)/ä¸»è§’å…ƒç´ è®¡æ—¶</td>
</tr>
<tr>
<td>æ˜¯å¦å¯ç”¨</td>
<td>å¯äº¤äº’äº‹ä»¶(TTI)</td>
</tr>
<tr>
<td>æ˜¯å¦ä»¤äººæ„‰å¿«</td>
<td>è€—æ—¶è¾ƒé•¿çš„ä»»åŠ¡(åœ¨æŠ€æœ¯ä¸Šä¸å­˜åœ¨è€—æ—¶è¾ƒé•¿çš„ä»»åŠ¡)</td>
</tr>
</tbody>
</table>
<h5 id="å…³é”®æŒ‡æ ‡">å…³é”®æŒ‡æ ‡</h5>
<table>
<thead>
<tr>
<th>æŒ‡æ ‡</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>FP(First Paint)</td>
<td>é¡µé¢åœ¨å¯¼èˆªåé¦–æ¬¡å‘ˆç°å‡ºä¸åŒäºå¯¼èˆªå‰å†…å®¹çš„æ—¶é—´ç‚¹</td>
</tr>
<tr>
<td>FCP(First Contentful Paint)</td>
<td>é¦–æ¬¡ç»˜åˆ¶ä»»ä½•æ–‡æœ¬ï¼Œå›¾åƒï¼Œéç©ºç™½canvasæˆ–SVGçš„æ—¶é—´ç‚¹</td>
</tr>
<tr>
<td>TTI(Time to Interactive)</td>
<td>ä»é¡µé¢å¼€å§‹åŠ è½½åˆ°é¡µé¢ä¸»è¦èµ„æºåŠ è½½ä¹‹é—´çš„æ—¶é—´</td>
</tr>
<tr>
<td>LCP(Largest Contentful Paint)</td>
<td>å¯è§†åŒºåŸŸâ€œå†…å®¹â€æœ€å¤§çš„å¯è§å…ƒç´ å¼€å§‹å‡ºç°åœ¨é¡µé¢ä¸Šçš„æ—¶é—´ç‚¹</td>
</tr>
<tr>
<td>CLS(Cumulative Layout Shift)</td>
<td>è¡¨ç¤ºç”¨æˆ·ç»å†çš„æ„å¤– layout åç§»çš„é¢‘ç‡</td>
</tr>
<tr>
<td>TBT(Total Blocking Time)</td>
<td>è¡¨ç¤ºä» FCP åˆ° TTI ä¹‹é—´ï¼Œæ‰€æœ‰ <a href="https://web.dev/custom-metrics/#long-tasks-api">long task</a> çš„é˜»å¡æ—¶é—´ä¹‹å’Œ</td>
</tr>
</tbody>
</table>
<p>FPå’ŒFCPå¯èƒ½æ˜¯ç›¸åŒçš„æ—¶é—´ï¼Œä¹Ÿå¯èƒ½FPå…ˆäºFCPã€‚ä¸‹å›¾å±•ç¤ºäº† FP å’Œ FCP çš„åŒºåˆ«:</p>
<figure data-type="image" tabindex="2"><img src="https://raw.githubusercontent.com/fanguyun214/picgo/master/img/image-20200724163348918.png" alt="image-20200724163348918" loading="lazy"></figure>
<p>é€šè¿‡ window.performance.getEntriesByType('paint') è·å–ä¸¤ä¸ªæ—¶é—´ç‚¹çš„å€¼ã€‚</p>
<pre><code>performance.getEntriesByType('paint');
</code></pre>
<figure data-type="image" tabindex="3"><img src="https://raw.githubusercontent.com/fanguyun214/picgo/master/img/image-20200724163707377.png" alt="image-20200724163707377" loading="lazy"></figure>
<p>LCPå¯ä»¥é€šè¿‡ Chrome çš„ PerformanceObserver API è®¡ç®—å®ƒ:</p>
<figure data-type="image" tabindex="4"><img src="https://raw.githubusercontent.com/fanguyun214/picgo/master/img/image-20200724163928098.png" alt="image-20200724163928098" loading="lazy"></figure>
<pre><code>// Create a variable to hold the latest LCP value (since it can change).
let lcp;

// Create the PerformanceObserver instance.
const po = new PerformanceObserver((entryList) =&gt; {
  const entries = entryList.getEntries();
  const lastEntry = entries[entries.length - 1];

  // Update `lcp` to the latest value, using `renderTime` if it's available,
  // otherwise using `loadTime`. (Note: `renderTime` may not be available if
  // the element is an image and it's loaded cross-origin without the
  // `Timing-Allow-Origin` header.)
  lcp = lastEntry.renderTime || lastEntry.loadTime;
});

// Observe entries of type `largest-contentful-paint`, including buffered
// entries, i.e. entries that occurred before calling `observe()`.
po.observe({type: 'largest-contentful-paint', buffered: true});

// Send the latest LCP value to your analytics server once the user
// leaves the tab.
addEventListener('visibilitychange', function fn() {
  if (lcp &amp;&amp; document.visibilityState === 'hidden') {
    console.log('LCP:', lcp);
    removeEventListener('visibilitychange', fn, true);
  }
}, true);

</code></pre>
<h5 id="ä¼˜åŒ–-fpfcp">ä¼˜åŒ– FP/FCP</h5>
<p>ä»æ–‡æ¡£çš„ <code>&lt;head&gt;</code> ä¸­ç§»é™¤ä»»ä½•é˜»å¡æ¸²æŸ“çš„è„šæœ¬æˆ–æ ·å¼è¡¨ï¼Œå¯ä»¥å‡å°‘é¦–æ¬¡ç»˜åˆ¶å’Œé¦–æ¬¡å†…å®¹ç»˜åˆ¶å‰çš„ç­‰å¾…æ—¶é—´ã€‚</p>
<p>èŠ±æ—¶é—´ç¡®å®šå‘ç”¨æˆ·æŒ‡å‡ºâ€œæ­£åœ¨å‘ç”Ÿâ€æ‰€éœ€çš„æœ€å°æ ·å¼é›†ï¼Œå¹¶å°†å…¶å†…è”åˆ° <code>&lt;head&gt;</code> ä¸­ï¼ˆæˆ–è€…ä½¿ç”¨ <a href="https://developers.google.com/web/fundamentals/performance/http2#server_push">HTTP/2 æœåŠ¡å™¨æ¨é€</a>)ï¼‰ï¼Œå³å¯å®ç°æçŸ­çš„é¦–æ¬¡ç»˜åˆ¶æ—¶é—´ã€‚</p>
<p><a href="https://developers.google.com/web/updates/2015/11/app-shell">åº”ç”¨ shell æ¨¡å¼</a>å¯ä»¥å¾ˆå¥½åœ°è¯´æ˜å¦‚ä½•é’ˆå¯¹<a href="https://developers.google.com/web/progressive-web-apps">æ¸è¿›å¼ç½‘é¡µåº”ç”¨</a>å®ç°è¿™ä¸€ç‚¹ã€‚</p>
<h5 id="ä¼˜åŒ–-fmptti">ä¼˜åŒ– FMP/TTI</h5>
<p>ç¡®å®šé¡µé¢ä¸Šæœ€å…³é”®çš„ç•Œé¢å…ƒç´ ï¼ˆä¸»è§’å…ƒç´ ï¼‰ä¹‹åï¼Œæ‚¨åº”ç¡®ä¿åˆå§‹è„šæœ¬åŠ è½½ä»…åŒ…å«æ¸²æŸ“è¿™äº›å…ƒç´ å¹¶ä½¿å…¶å¯äº¤äº’æ‰€éœ€çš„ä»£ç ã€‚</p>
<p>åˆå§‹ JavaScript è½¯ä»¶åŒ…ä¸­æ‰€åŒ…å«çš„ä»»ä½•ä¸ä¸»è§’å…ƒç´ æ— å…³çš„ä»£ç éƒ½ä¼šå»¶é•¿å¯äº¤äº’æ—¶é—´ã€‚ æ²¡æœ‰ç†ç”±å¼ºè¿«ç”¨æˆ·è®¾å¤‡ä¸‹è½½å¹¶è§£æå½“å‰ä¸éœ€è¦çš„ JavaScript ä»£ç ã€‚</p>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œæ‚¨åº”è¯¥å°½å¯èƒ½ç¼©çŸ­ FMP ä¸ TTI ä¹‹é—´çš„æ—¶é—´ã€‚ å¦‚æœæ— æ³•æœ€å¤§é™åº¦ç¼©çŸ­æ­¤æ—¶é—´ï¼Œç•Œé¢ç»å¯¹æœ‰å¿…è¦æ˜ç¡®æŒ‡å‡ºé¡µé¢å°šä¸å¯äº¤äº’ã€‚</p>
<p>å¯¹äºç”¨æˆ·æ¥è¯´ï¼Œå…¶ä¸­ä¸€ç§æœ€ä»¤äººå¤±æœ›çš„ä½“éªŒå°±æ˜¯ç‚¹æŒ‰å…ƒç´ åæ¯«æ— ååº”ã€‚</p>
<h5 id="é¿å…å‡ºç°è€—æ—¶è¾ƒé•¿çš„ä»»åŠ¡">é¿å…å‡ºç°è€—æ—¶è¾ƒé•¿çš„ä»»åŠ¡</h5>
<p>æ‹†åˆ†ä»£ç å¹¶æŒ‰ç…§ä¼˜å…ˆé¡ºåºæ’åˆ—è¦åŠ è½½çš„ä»£ç ï¼Œä¸ä»…å¯ä»¥ç¼©çŸ­é¡µé¢å¯äº¤äº’æ—¶é—´ï¼Œè¿˜å¯ä»¥å‡å°‘è€—æ—¶è¾ƒé•¿çš„ä»»åŠ¡ï¼Œç„¶åå³æœ‰å¸Œæœ›å‡å°‘è¾“å…¥å»¶è¿ŸåŠæ…¢é€Ÿå¸§ã€‚</p>
<p>é™¤äº†å°†ä»£ç æ‹†åˆ†ä¸ºå¤šä¸ªå•ç‹¬çš„æ–‡ä»¶ä¹‹å¤–ï¼Œæ‚¨è¿˜å¯å°†å¤§å‹åŒæ­¥ä»£ç å—æ‹†åˆ†ä¸ºè¾ƒå°çš„å—ï¼Œä»¥ä¾¿ä»¥å¼‚æ­¥æ–¹å¼æ‰§è¡Œï¼Œæˆ–è€…<a href="https://developers.google.com/web/updates/2015/08/using-requestidlecallback">æ¨è¿Ÿåˆ°ä¸‹ä¸€ç©ºé—²ç‚¹</a>ã€‚ ä»¥å¼‚æ­¥æ–¹å¼åœ¨è¾ƒå°çš„å—ä¸­æ‰§è¡Œæ­¤é€»è¾‘ï¼Œå¯åœ¨ä¸»çº¿ç¨‹ä¸­ç•™å‡ºç©ºé—´ï¼Œä¾›æµè§ˆå™¨å“åº”ç”¨æˆ·è¾“å…¥ã€‚</p>
<p>æœ€åï¼Œæ‚¨åº”ç¡®ä¿æµ‹è¯•ç¬¬ä¸‰æ–¹ä»£ç ï¼Œå¹¶å¯¹ä»»ä½•ä½é€Ÿè¿è¡Œçš„ä»£ç è¿½è´£ã€‚ äº§ç”Ÿå¤§é‡è€—æ—¶è¾ƒé•¿ä»»åŠ¡çš„ç¬¬ä¸‰æ–¹å¹¿å‘Šæˆ–è·Ÿè¸ªè„šæœ¬å¯¹æ‚¨ä¸šåŠ¡çš„ä¼¤å®³å¤§äºå¸®åŠ©ã€‚</p>
<h3 id="æ•°æ®ä¸ŠæŠ¥">æ•°æ®ä¸ŠæŠ¥</h3>
<h4 id="ä½¿ç”¨çš„imgæ ‡ç­¾getè¯·æ±‚">ä½¿ç”¨çš„imgæ ‡ç­¾getè¯·æ±‚</h4>
<ul>
<li>ä¸å­˜åœ¨AJAXè·¨åŸŸé—®é¢˜ï¼Œå¯åšè·¨æºçš„è¯·æ±‚</li>
<li>å¾ˆå¤è€çš„æ ‡ç­¾ï¼Œæ²¡æœ‰æµè§ˆå™¨å…¼å®¹æ€§é—®é¢˜</li>
</ul>
<pre><code>var i = new Image();
i.onload = i.onerror = i.onabort = function () {
  i = i.onload = i.onerror = i.onabort = null;
}
i.src = url;
</code></pre>
<h4 id="navigatorsendbeacon">navigator.sendBeacon</h4>
<p>å¤§éƒ¨åˆ†ç°ä»£æµè§ˆå™¨éƒ½æ”¯æŒ navigator.sendBeaconæ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•å¯ä»¥ç”¨æ¥å‘é€ä¸€äº›ç»Ÿè®¡å’Œè¯Šæ–­çš„å°é‡æ•°æ®ï¼Œç‰¹åˆ«é€‚åˆä¸ŠæŠ¥ç»Ÿè®¡çš„åœºæ™¯ã€‚</p>
<ul>
<li>æ•°æ®å¯é ï¼Œæµè§ˆå™¨å…³é—­è¯·æ±‚ä¹Ÿç…§æ ·èƒ½å‘</li>
<li>å¼‚æ­¥æ‰§è¡Œï¼Œä¸ä¼šå½±å“ä¸‹ä¸€é¡µé¢çš„åŠ è½½</li>
<li>APIä½¿ç”¨ç®€å•</li>
</ul>
<pre><code>window.addEventListener('unload', logData, false);

function logData() {
    navigator.sendBeacon(&quot;/log&quot;, analyticsData);
}
</code></pre>
<p>å½“æµè§ˆå™¨æ”¯æŒsendBeaconæ–¹æ³•ï¼Œä¼˜å…ˆä½¿ç”¨è¯¥æ–¹æ³•ï¼Œä½¿ç”¨imgæ–¹å¼é™çº§ä¸ŠæŠ¥ã€‚</p>
<h3 id="å‚è€ƒ">å‚è€ƒ</h3>
<ul>
<li>
<p><a href="https://developers.google.com/web/fundamentals/performance/user-centric-performance-metrics#%E4%BB%A5%E7%94%A8%E6%88%B7%E4%B8%BA%E4%B8%AD%E5%BF%83%E7%9A%84%E6%80%A7%E8%83%BD%E6%8C%87%E6%A0%87_2">ä»¥ç”¨æˆ·ä¸ºä¸­å¿ƒçš„æ€§èƒ½æŒ‡æ ‡</a></p>
</li>
<li>
<p><a href="https://juejin.im/post/5ecc5521e51d45788e17dcc6">è§£è¯»æ–°ä¸€ä»£ Web æ€§èƒ½ä½“éªŒå’Œè´¨é‡æŒ‡æ ‡</a></p>
</li>
</ul>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[NgRxä½¿ç”¨]]></title>
        <id>https://fanguyun214.github.io/post/ngrx-shi-yong/</id>
        <link href="https://fanguyun214.github.io/post/ngrx-shi-yong/">
        </link>
        <updated>2020-07-21T09:22:51.000Z</updated>
        <summary type="html"><![CDATA[<p>NgRxæ˜¯ç”¨äºåœ¨Angularä¸­æ„å»ºååº”å¼åº”ç”¨ç¨‹åºçš„æ¡†æ¶ã€‚NgRxæä¾›çŠ¶æ€ç®¡ç†ï¼Œå‰¯ä½œç”¨éš”ç¦»ï¼Œå®ä½“é›†åˆç®¡ç†ï¼Œè·¯ç”±å™¨ç»‘å®šï¼Œä»£ç ç”Ÿæˆä»¥åŠå¼€å‘äººå‘˜å·¥å…·ï¼Œè¿™äº›å·¥å…·å¯å¢å¼ºå¼€å‘äººå‘˜åœ¨æ„å»ºè®¸å¤šä¸åŒç±»å‹çš„åº”ç”¨ç¨‹åºæ—¶çš„ä½“éªŒã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>NgRxæ˜¯ç”¨äºåœ¨Angularä¸­æ„å»ºååº”å¼åº”ç”¨ç¨‹åºçš„æ¡†æ¶ã€‚NgRxæä¾›çŠ¶æ€ç®¡ç†ï¼Œå‰¯ä½œç”¨éš”ç¦»ï¼Œå®ä½“é›†åˆç®¡ç†ï¼Œè·¯ç”±å™¨ç»‘å®šï¼Œä»£ç ç”Ÿæˆä»¥åŠå¼€å‘äººå‘˜å·¥å…·ï¼Œè¿™äº›å·¥å…·å¯å¢å¼ºå¼€å‘äººå‘˜åœ¨æ„å»ºè®¸å¤šä¸åŒç±»å‹çš„åº”ç”¨ç¨‹åºæ—¶çš„ä½“éªŒã€‚</p>
<!-- more -->
<h3 id="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ngrxè¿›è¡ŒçŠ¶æ€ç®¡ç†">ä¸ºä»€ä¹ˆè¦ä½¿ç”¨NgRxè¿›è¡ŒçŠ¶æ€ç®¡ç†ï¼Ÿ</h3>
<p>NgRxé€šè¿‡å­˜å‚¨å•ä¸ªçŠ¶æ€å’Œä½¿ç”¨æ“ä½œæ¥è¡¨è¾¾çŠ¶æ€æ›´æ”¹ï¼Œä»è€Œæä¾›äº†ç”¨äºåˆ›å»ºå¯ç»´æŠ¤çš„æ˜¾å¼åº”ç”¨ç¨‹åºçš„çŠ¶æ€ç®¡ç†ã€‚</p>
<ul>
<li>
<p><strong>å¯åºåˆ—åŒ–</strong><br>
é€šè¿‡è§„èŒƒåŒ–çŠ¶æ€å˜åŒ–å¹¶å°†å…¶ä¼ é€’ç»™å¯è§‚å¯Ÿå¯¹è±¡ï¼ŒNgRxæä¾›äº†å¯åºåˆ—åŒ–æ€§ï¼Œå¹¶ç¡®ä¿çŠ¶æ€å¯é¢„æµ‹åœ°å­˜å‚¨ã€‚è¿™æ ·å¯ä»¥å°†çŠ¶æ€ä¿å­˜åˆ°å¤–éƒ¨å­˜å‚¨ï¼Œä¾‹å¦‚localStorageã€‚<br>
æ­¤å¤–ï¼Œå®ƒè¿˜å…è®¸ä»Store Devtoolsæ£€æŸ¥ï¼Œä¸‹è½½ï¼Œä¸Šä¼ å’Œè°ƒåº¦æ“ä½œã€‚</p>
</li>
<li>
<p><strong>ç±»å‹å®‰å…¨</strong><br>
ä¾é TypeScriptç¼–è¯‘å™¨æ¥ä¿è¯ç¨‹åºæ­£ç¡®æ€§ï¼Œä»è€Œåœ¨æ•´ä¸ªä½“ç³»ç»“æ„ä¸­æé«˜äº†ç±»å‹å®‰å…¨æ€§ã€‚</p>
</li>
<li>
<p><strong>å°è£…</strong><br>
ä½¿ç”¨NgRx Effectså’ŒStoreï¼Œå¯ä»¥å°†ä¸å¤–éƒ¨èµ„æºå‰¯ä½œç”¨ï¼ˆä¾‹å¦‚ç½‘ç»œè¯·æ±‚ï¼ŒWebå¥—æ¥å­—å’Œä»»ä½•ä¸šåŠ¡é€»è¾‘ï¼‰çš„ä»»ä½•äº¤äº’éƒ½ä¸UIéš”ç¦»ã€‚è¿™ç§éš”ç¦»å…è®¸ä½¿ç”¨æ›´å¤šçº¯å‡€å’Œç®€å•çš„ç»„ä»¶ï¼Œå¹¶ä¿æŒå•ä¸€èŒè´£åŸåˆ™ã€‚</p>
</li>
<li>
<p><strong>å¯æµ‹è¯•çš„</strong><br>
ç”±äºStoreä½¿ç”¨çº¯å‡½æ•°æ¥æ›´æ”¹çŠ¶æ€å’Œä»çŠ¶æ€ä¸­é€‰æ‹©æ•°æ®ï¼Œå¹¶ä¸”èƒ½å¤Ÿå°†å‰¯ä½œç”¨ä¸UIéš”ç¦»ï¼Œå› æ­¤æµ‹è¯•å˜å¾—éå¸¸ç®€å•ã€‚NgRxè¿˜æä¾›è¯¸å¦‚provideMockStoreå’ŒprovideMockActionsç”¨äºéš”ç¦»æµ‹è¯•çš„æµ‹è¯•è®¾ç½®ï¼Œå¹¶æä¾›æ›´å¥½çš„æµ‹è¯•ä½“éªŒã€‚</p>
</li>
<li>
<p><strong>æ€§èƒ½</strong><br>
å­˜å‚¨å»ºç«‹åœ¨å•ä¸ªä¸å˜çš„æ•°æ®çŠ¶æ€ä¸Šï¼Œä½¿ç”¨OnPushç­–ç•¥ä½¿æ›´æ”¹æ£€æµ‹å˜æˆä¸€é¡¹éå¸¸å®¹æ˜“çš„ä»»åŠ¡ã€‚NgRxè¿˜ç”±å¯è®°å¿†çš„é€‰æ‹©å™¨åŠŸèƒ½æä¾›æ”¯æŒï¼Œè¿™äº›é€‰æ‹©å™¨åŠŸèƒ½å¯ä¼˜åŒ–çŠ¶æ€æŸ¥è¯¢è®¡ç®—ã€‚</p>
</li>
</ul>
<h3 id="ä½•æ—¶åº”ä½¿ç”¨ngrxè¿›è¡ŒçŠ¶æ€ç®¡ç†">ä½•æ—¶åº”ä½¿ç”¨NgRxè¿›è¡ŒçŠ¶æ€ç®¡ç†</h3>
<p>å½“ç®¡ç†æœåŠ¡ä¸­çš„çŠ¶æ€ä¸å†è¶³å¤Ÿæ—¶ï¼Œåœ¨æ„å»ºå…·æœ‰å¤§é‡ç”¨æˆ·äº¤äº’å’Œå¤šä¸ªæ•°æ®æºçš„åº”ç”¨ç¨‹åºæ—¶ï¼Œå¯èƒ½ä¼šä½¿ç”¨NgRxã€‚<br>
SHARIåŸåˆ™å¯ä»¥å›ç­”â€œæˆ‘ä½•æ—¶éœ€è¦NgRxâ€è¿™ä¸ªé—®é¢˜ï¼š</p>
<ul>
<li>Sharedï¼šç”±è®¸å¤šç»„ä»¶å’ŒæœåŠ¡çš„è®¿é—®çš„çŠ¶æ€ã€‚</li>
<li>Hydratedï¼šä»å¤–éƒ¨å­˜å‚¨æŒä¹…åŒ–ã€‚</li>
<li>Availableï¼šçŠ¶æ€ï¼Œéœ€è¦æ—¶å¯ç”¨é‡æ–°è¿›å…¥è·¯çº¿ã€‚</li>
<li>Retrievedï¼šå¿…é¡»é™„å¸¦å‰¯ä½œç”¨çš„çŠ¶æ€ã€‚</li>
<li>Impactedï¼šå—å…¶ä»–æ¥æºçš„è¡ŒåŠ¨å½±å“çš„çŠ¶æ€ã€‚</li>
</ul>
<h3 id="ngrxstore">@ngrx/store</h3>
<p>Storeæ˜¯å—Reduxå¯å‘çš„RxJSæ”¯æŒçš„Angularåº”ç”¨ç¨‹åºçŠ¶æ€ç®¡ç†ã€‚ Storeæ˜¯ä¸€ä¸ªå—æ§çŠ¶æ€å®¹å™¨ï¼Œæ—¨åœ¨å¸®åŠ©åœ¨Angularä¸Šç¼–å†™é«˜æ€§èƒ½ï¼Œä¸€è‡´çš„åº”ç”¨ç¨‹åºã€‚</p>
<h3 id="å…³é”®æ¦‚å¿µ">å…³é”®æ¦‚å¿µ</h3>
<ul>
<li>Actions: åŠ¨ä½œæè¿°ä»ç»„ä»¶å’ŒæœåŠ¡è°ƒåº¦çš„å”¯ä¸€äº‹ä»¶</li>
<li>State: çŠ¶æ€æ›´æ”¹ç”±ç§°ä¸ºç®€åŒ–å™¨çš„çº¯å‡½æ•°å¤„ç†ï¼Œè¿™äº›å‡½æ•°é‡‡ç”¨å½“å‰çŠ¶æ€å’Œæœ€æ–°æ“ä½œæ¥è®¡ç®—æ–°çŠ¶æ€ã€‚</li>
<li>Selectors: é€‰æ‹©å™¨æ˜¯ç”¨äºé€‰æ‹©ï¼Œå¯¼å‡ºå’Œç»„æˆçŠ¶æ€å—çš„çº¯å‡½æ•°ã€‚</li>
<li>Stateæ˜¯é€šè¿‡Storeè®¿é—®çš„ï¼ŒçŠ¶æ€æ˜¯å¯è§‚å¯Ÿçš„ï¼Œè¡Œä¸ºæ˜¯è§‚å¯Ÿè€…ã€‚</li>
</ul>
<h3 id="çŠ¶æ€æµ">çŠ¶æ€æµ</h3>
<p>ä¸‹å›¾è¡¨ç¤ºNgRxä¸­åº”ç”¨ç¨‹åºçŠ¶æ€çš„æ€»ä½“ä¸€èˆ¬æµç¨‹ï¼š<br>
<img src="https://fanguyun214.github.io/post-images/1595323865715.png" alt="" loading="lazy"></p>
<h3 id="å®‰è£…">å®‰è£…</h3>
<pre><code>// use npm 
npm install @ngrx/store --save
// use yarn 
yarn add @ngrx/store
// use ng add
ng add @ngrx/store
</code></pre>
<h3 id="ç¤ºä¾‹">ç¤ºä¾‹</h3>
<p>ä»¥ä¸‹æ•™ç¨‹å‘æ‚¨å±•ç¤ºå¦‚ä½•ç®¡ç†è®¡æ•°å™¨çš„çŠ¶æ€ï¼Œä»¥åŠå¦‚ä½•åœ¨Angularç»„ä»¶ä¸­é€‰æ‹©å’Œæ˜¾ç¤ºå®ƒ:<br>
1ã€åˆ›å»ºä¸€ä¸ªåä¸ºcounter.actions.tsçš„æ–°æ–‡ä»¶ï¼Œä»¥æè¿°é€’å¢ï¼Œé€’å‡å’Œé‡ç½®å…¶å€¼çš„è®¡æ•°å™¨åŠ¨ä½œã€‚</p>
<pre><code>// src/app/counter.actions.ts
import { createAction } from '@ngrx/store';

export const increment = createAction('[Counter Component] Increment');
export const decrement = createAction('[Counter Component] Decrement');
export const reset = createAction('[Counter Component] Reset');
</code></pre>
<p>2ã€æ ¹æ®æä¾›çš„æ“ä½œå¯¹reducerå‡½æ•°è¿›è¡Œç»†åŒ–ä»¥å¤„ç†è®¡æ•°å™¨å€¼çš„æ›´æ”¹</p>
<pre><code>// src/app/counter.reducer.ts
import { createReducer, on } from '@ngrx/store';
import { increment, decrement, reset } from './counter.actions';

export const initialState = 0;

const _counterReducer = createReducer(initialState,
  on(increment, state =&gt; state + 1),
  on(decrement, state =&gt; state - 1),
  on(reset, state =&gt; 0),
);

export function counterReducer(state, action) {
  return _counterReducer(state, action);
}
</code></pre>
<p>3ã€ä»@ ngrx / storeå’Œcounter.reduceræ–‡ä»¶å¯¼å…¥StoreModuleã€‚</p>
<pre><code>// src/app/app.module.ts (imports)

import { StoreModule } from '@ngrx/store';
import { counterReducer } from './counter.reducer';
</code></pre>
<p>4ã€åœ¨AppModuleçš„importsæ•°ç»„ä¸­æ·»åŠ StoreModule.forRootå‡½æ•°ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªå¯¹è±¡ï¼Œè¯¥å¯¹è±¡åŒ…å«è®¡æ•°å’Œç®¡ç†è®¡æ•°å™¨çŠ¶æ€çš„counterReducerã€‚ StoreModule.forRootï¼ˆï¼‰æ–¹æ³•æ³¨å†Œåœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­è®¿é—®å•†åº—æ‰€éœ€çš„å…¨å±€æä¾›ç¨‹åºã€‚</p>
<pre><code>// src/app/app.module.ts (StoreModule)
import { BrowserModule } from '@angular/platform-browser';
import { NgModule } from '@angular/core';

import { AppComponent } from './app.component';

import { StoreModule } from '@ngrx/store';
import { counterReducer } from './counter.reducer';

@NgModule({
  declarations: [AppComponent],
  imports: [
    BrowserModule,
    StoreModule.forRoot({ count: counterReducer })
  ],
  providers: [],
  bootstrap: [AppComponent],
})
export class AppModule {}
</code></pre>
<p>5ã€åœ¨appæ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªåä¸ºmy-counterçš„æ–°ç»„ä»¶ã€‚å°†å­˜å‚¨æœåŠ¡æ³¨å…¥åˆ°ç»„ä»¶ä¸­ä»¥åˆ†æ´¾è®¡æ•°å™¨åŠ¨ä½œï¼Œå¹¶ä½¿ç”¨selectè¿ç®—ç¬¦ä»çŠ¶æ€ä¸­é€‰æ‹©æ•°æ®ã€‚<br>
ä½¿ç”¨æŒ‰é’®æ›´æ–°MyCounterComponentæ¨¡æ¿ï¼Œä»¥è°ƒç”¨é€’å¢ï¼Œé€’å‡å’Œé‡ç½®æ–¹æ³•ã€‚ä½¿ç”¨å¼‚æ­¥ç®¡é“è®¢é˜…å¯è§‚å¯Ÿçš„countã€‚</p>
<pre><code>// src/app/my-counter/my-counter.component.html
&lt;button id=&quot;increment&quot; (click)=&quot;increment()&quot;&gt;Increment&lt;/button&gt;

&lt;div&gt;Current Count: {{ count$ | async }}&lt;/div&gt;

&lt;button id=&quot;decrement&quot; (click)=&quot;decrement()&quot;&gt;Decrement&lt;/button&gt;

&lt;button id=&quot;reset&quot; (click)=&quot;reset()&quot;&gt;Reset Counter&lt;/button&gt;
</code></pre>
<p>ä½¿ç”¨ç”¨äºè®¡æ•°çš„é€‰æ‹©å™¨å’Œç”¨äºè°ƒåº¦Incrementï¼ŒDecrementå’ŒResetæ“ä½œçš„æ–¹æ³•æ›´æ–°MyCounterComponentç±»</p>
<pre><code>// src/app/my-counter/my-counter.component.ts
import { Component } from '@angular/core';
import { Store, select } from '@ngrx/store';
import { Observable } from 'rxjs';
import { increment, decrement, reset } from '../counter.actions';

@Component({
  selector: 'app-my-counter',
  templateUrl: './my-counter.component.html',
  styleUrls: ['./my-counter.component.css'],
})
export class MyCounterComponent {
  count$: Observable&lt;number&gt;;

  constructor(private store: Store&lt;{ count: number }&gt;) {
    this.count$ = store.pipe(select('count'));
  }

  increment() {
    this.store.dispatch(increment());
  }

  decrement() {
    this.store.dispatch(decrement());
  }

  reset() {
    this.store.dispatch(reset());
  }
}
</code></pre>
<p>6ã€å°†MyCounterç»„ä»¶æ·»åŠ åˆ°æ‚¨çš„AppComponentæ¨¡æ¿ä¸­ã€‚</p>
<pre><code>// src/app/app.component.html
&lt;app-my-counter&gt;&lt;/app-my-counter&gt;
</code></pre>
<p>å•å‡»é€’å¢ï¼Œé€’å‡å’Œé‡ç½®æŒ‰é’®ä»¥æ›´æ”¹è®¡æ•°å™¨çš„çŠ¶æ€ã€‚</p>
<p>è®©æˆ‘ä»¬ä»‹ç»ä¸€ä¸‹æ‚¨æ‰€åšçš„äº‹æƒ…ï¼š</p>
<ul>
<li>å®šä¹‰çš„äº‹ä»¶è¡¨è¾¾åŠ¨ä½œã€‚</li>
<li>å®šä¹‰äº†ä¸€ä¸ªreduceråŠŸèƒ½æ¥ç®¡ç†è®¡æ•°å™¨çš„çŠ¶æ€ã€‚</li>
<li>æ³¨å†Œäº†æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­å¯ç”¨çš„å…¨å±€çŠ¶æ€å®¹å™¨ã€‚</li>
<li>æ³¨å…¥äº†å­˜å‚¨æœåŠ¡ä»¥è°ƒåº¦åŠ¨ä½œå¹¶é€‰æ‹©è®¡æ•°å™¨çš„å½“å‰çŠ¶æ€ã€‚</li>
<li></li>
</ul>
<h3 id="é€šè¿‡actions-reducerså’Œselectorsäº†è§£ngrxåº”ç”¨ç¨‹åºçš„ä½“ç³»ç»“æ„">é€šè¿‡actionsã€reducerså’Œselectorsäº†è§£NgRxåº”ç”¨ç¨‹åºçš„ä½“ç³»ç»“æ„</h3>
<h4 id="actios">Actios</h4>
<p>Actionsæ˜¯NgRxä¸­çš„ä¸»è¦æ„å»ºå—ä¹‹ä¸€ã€‚ Actionsè¡¨ç¤ºåœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­å‘ç”Ÿçš„ç‹¬ç‰¹äº‹ä»¶ã€‚ ä»ç”¨æˆ·ä¸é¡µé¢çš„äº¤äº’ï¼Œé€šè¿‡ç½‘ç»œè¯·æ±‚çš„å¤–éƒ¨äº¤äº’ä»¥åŠä¸è®¾å¤‡APIçš„ç›´æ¥äº¤äº’ï¼Œè¿™äº›ä»¥åŠæ›´å¤šäº‹ä»¶å‡é€šè¿‡actionsè¿›è¡Œäº†æè¿°ã€‚<br>
NgRxä¸­çš„Actionç”±ä¸€ä¸ªç®€å•çš„æ¥å£ç»„æˆï¼š</p>
<pre><code>// Action Interface
interface Action {
  type: string;
}
</code></pre>
<p>æ¥å£å…·æœ‰å•ä¸ªå±æ€§ï¼Œå³ç±»å‹ï¼Œè¡¨ç¤ºä¸ºå­—ç¬¦ä¸²ã€‚ typeå±æ€§ç”¨äºæè¿°å°†åœ¨æ‚¨çš„åº”ç”¨ç¨‹åºä¸­åˆ†æ´¾çš„æ“ä½œã€‚ è¯¥ç±»å‹çš„å€¼ä»¥[Source] Eventçš„å½¢å¼å‡ºç°ï¼Œç”¨äºæä¾›æœ‰å…³å®ƒæ˜¯ä»€ä¹ˆactionsç±»åˆ«ä»¥åŠä»å“ªé‡Œè°ƒåº¦åŠ¨ä½œçš„ä¸Šä¸‹æ–‡ã€‚ æ‚¨å‘actionsæ·»åŠ å±æ€§ä»¥ä¸ºæ“ä½œæä¾›å…¶ä»–ä¸Šä¸‹æ–‡æˆ–å…ƒæ•°æ®ã€‚<br>
è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å¯åŠ¨ç™»å½•è¯·æ±‚çš„ç¤ºä¾‹Action:</p>
<pre><code>// login-page.actions.ts
import { createAction, props } from '@ngrx/store';

export const login = createAction(
  '[Login Page] Login',
  props&lt;{ username: string; password: string }&gt;()
);
</code></pre>
<p>createActionå‡½æ•°è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°åœ¨è¢«è°ƒç”¨æ—¶å°†ä»¥Actionæ¥å£çš„å½¢å¼è¿”å›ä¸€ä¸ªå¯¹è±¡ã€‚ propsæ–¹æ³•ç”¨äºå®šä¹‰å¤„ç†åŠ¨ä½œæ‰€éœ€çš„ä»»ä½•å…¶ä»–å…ƒæ•°æ®ã€‚<br>
Actionåˆ›å»ºè€…æä¾›äº†ä¸€ç§ä¸€è‡´çš„ï¼Œç±»å‹å®‰å…¨çš„æ–¹å¼æ¥æ„é€ è¦åˆ†æ´¾çš„Actionã€‚<br>
ä½¿ç”¨Actionåˆ›å»ºè€…åœ¨åˆ†æ´¾æ—¶è¿”å›Actionã€‚</p>
<pre><code>// login-page.component.ts
onSubmit(username: string, password: string) {
  store.dispatch(login({ username: username, password: password }));
}
</code></pre>
<p>login Actionåˆ›å»ºè€…å°†æ”¶åˆ°ä¸€ä¸ªç”¨æˆ·åå’Œå¯†ç çš„å¯¹è±¡ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ™®é€šçš„JavaScriptå¯¹è±¡ï¼Œå…¶ç±»å‹å±æ€§ä¸º[Login Page] Loginï¼Œå¹¶å°†ç”¨æˆ·åå’Œå¯†ç ä½œä¸ºé™„åŠ å±æ€§ã€‚<br>
è¿”å›çš„Actionå…·æœ‰éå¸¸å…·ä½“çš„ä¸Šä¸‹æ–‡ï¼Œå…³äºæ“ä½œæ¥è‡ªä½•å¤„ä»¥åŠå‘ç”Ÿäº†ä»€ä¹ˆäº‹ä»¶:</p>
<ul>
<li>æ“ä½œçš„ç±»åˆ«æ•è·åœ¨æ–¹æ‹¬å·[]ä¸­,è¯¥ç±»åˆ«ç”¨äºå¯¹ç‰¹å®šåŒºåŸŸçš„æ“ä½œè¿›è¡Œåˆ†ç»„ï¼Œæ— è®ºæ˜¯ç»„ä»¶é¡µé¢ï¼Œåç«¯APIè¿˜æ˜¯æµè§ˆå™¨APIã€‚</li>
<li>ç±»åˆ«åçš„ç™»å½•æ–‡æœ¬æ˜¯æœ‰å…³æ­¤æ“ä½œå‘ç”Ÿäº†ä»€ä¹ˆäº‹ä»¶çš„æè¿°ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç”¨æˆ·å•å‡»ç™»å½•é¡µé¢ä¸Šçš„ç™»å½•æŒ‰é’®ä»¥å°è¯•ä½¿ç”¨ç”¨æˆ·åå’Œå¯†ç è¿›è¡Œèº«ä»½éªŒè¯ã€‚</li>
</ul>
<h4 id="reducers">Reducers</h4>
<p>NgRxä¸­çš„reducerè´Ÿè´£å¤„ç†åº”ç”¨ç¨‹åºä¸­ä»ä¸€ä¸ªçŠ¶æ€åˆ°ä¸‹ä¸€ä¸ªçŠ¶æ€çš„è½¬æ¢ã€‚ Reducerçº¯å‡½æ•°é€šè¿‡æ ¹æ®æ“ä½œçš„ç±»å‹ç¡®å®šè¦å¤„ç†çš„æ“ä½œæ¥å¤„ç†è¿™äº›è½¬æ¢ã€‚<br>
ç”±Reducerç®¡ç†çš„æ¯ä¸ªçŠ¶æ€éƒ½æœ‰ä¸€äº›ä¸€è‡´çš„éƒ¨åˆ†ï¼š</p>
<p>å®šä¹‰stateå½¢çŠ¶çš„æ¥å£æˆ–ç±»å‹<br>
å‚æ•°åŒ…æ‹¬åˆå§‹çŠ¶æ€æˆ–å½“å‰çŠ¶æ€ä»¥åŠå½“å‰æ“ä½œ<br>
å¤„ç†stateæ›´æ”¹çš„åŠŸèƒ½åŠå…¶ç›¸å…³</p>
<p>ä»¥ä¸‹æ˜¯ä¸€ç»„å¤„ç†è®°åˆ†æ¿stateçš„æ“ä½œç¤ºä¾‹ä»¥åŠç›¸å…³çš„reduceråŠŸèƒ½:<br>
é¦–å…ˆï¼Œå®šä¹‰ä¸€äº›ä¸stateäº¤äº’çš„actionã€‚</p>
<pre><code>// scoreboard-page.actions.ts
import { createAction, props } from '@ngrx/store';

export const homeScore = createAction('[Scoreboard Page] Home Score');
export const awayScore = createAction('[Scoreboard Page] Away Score');
export const resetScore = createAction('[Scoreboard Page] Score Reset');
export const setScores = createAction('[Scoreboard Page] Set Scores', props&lt;{game: Game}&gt;());
</code></pre>
<p>æ¥ä¸‹æ¥ï¼Œåˆ›å»ºä¸€ä¸ªreduceræ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å¯¼å…¥actionå¹¶ä¸ºstateå—å®šä¹‰å½¢çŠ¶ã€‚</p>
<h5 id="1-å®šä¹‰stateå½¢çŠ¶">1ã€å®šä¹‰stateå½¢çŠ¶</h5>
<p>æ¯ä¸ªreducerå‡½æ•°éƒ½æ˜¯ä¸€ä¸ªactionç›‘å¬å™¨ã€‚ä¸Šé¢å®šä¹‰çš„è®°åˆ†æ¿actionæè¿°äº†reducerå¯èƒ½å¤„ç†çš„è¿‡æ¸¡ã€‚å¯¼å…¥å¤šç»„æ“ä½œä»¥å¤„ç†reducerä¸­çš„å…¶ä»–çŠ¶æ€è½¬æ¢ã€‚</p>
<pre><code>// scoreboard.reducer.ts
import { Action, createReducer, on } from '@ngrx/store';
import * as ScoreboardPageActions from '../actions/scoreboard-page.actions';

export interface State {
  home: number;
  away: number;
}
</code></pre>
<h5 id="2è®¾ç½®åˆå§‹stateå€¼">2.è®¾ç½®åˆå§‹stateå€¼</h5>
<p>åˆå§‹çŠ¶æ€ä¸ºçŠ¶æ€æä¾›ä¸€ä¸ªåˆå§‹å€¼ï¼Œå¦‚æœå½“å‰çŠ¶æ€æœªå®šä¹‰ï¼Œåˆ™æä¾›ä¸€ä¸ªå€¼ã€‚ æ‚¨å°†é»˜è®¤çŠ¶æ€è®¾ç½®ä¸ºæ‰€éœ€çŠ¶æ€å±æ€§çš„åˆå§‹çŠ¶æ€ã€‚</p>
<p>åˆ›å»ºå¹¶å¯¼å‡ºå˜é‡ä»¥æ•è·å…·æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªé»˜è®¤å€¼çš„åˆå§‹çŠ¶æ€ã€‚</p>
<pre><code>// scoreboard.reducer.ts
export const initialState: State = {
  home: 0,
  away: 0,
};
</code></pre>
<h5 id="3åˆ›å»ºrecucerå‡½æ•°">3.åˆ›å»ºrecucerå‡½æ•°</h5>
<p>reduceråŠŸèƒ½çš„èŒè´£æ˜¯ä»¥ä¸å˜çš„æ–¹å¼å¤„ç†çŠ¶æ€è½¬æ¢ã€‚åˆ›å»ºä¸€ä¸ªreducerå‡½æ•°ï¼Œè¯¥å‡½æ•°å¤„ç†ä½¿ç”¨createReducerå‡½æ•°ç®¡ç†è®¡åˆ†æ¿stateçš„actionã€‚</p>
<pre><code>const scoreboardReducer = createReducer(
  initialState,
  on(ScoreboardPageActions.homeScore, state =&gt; ({ ...state, home: state.home + 1 })),
  on(ScoreboardPageActions.awayScore, state =&gt; ({ ...state, away: state.away + 1 })),
  on(ScoreboardPageActions.resetScore, state =&gt; ({ home: 0, away: 0 })),
  on(ScoreboardPageActions.setScores, (state, { game }) =&gt; ({ home: game.home, away: game.away }))
);

export function reducer(state: State | undefined, action: Action) {
  return scoreboardReducer(state, action);
}
</code></pre>
<p>å¯¼å‡ºçš„reducerå‡½æ•°æ˜¯å¿…éœ€çš„ï¼Œå› ä¸ºAOTç¼–è¯‘å™¨ä¸æ”¯æŒå‡½æ•°è°ƒç”¨ã€‚</p>
<h5 id="4-æ³¨å†Œroot-state">4ã€æ³¨å†Œroot state</h5>
<p>åº”ç”¨ç¨‹åºçš„stateè¢«å®šä¹‰ä¸ºä¸€ä¸ªå¤§å¯¹è±¡ã€‚æ³¨å†Œreducerå‡½æ•°ä»¥ç®¡ç†éƒ¨åˆ†stateæ—¶ï¼Œåªä¼šåœ¨å¯¹è±¡ä¸­å®šä¹‰å…·æœ‰å…³è”å€¼çš„é”®ã€‚è¦åœ¨æ‚¨çš„åº”ç”¨ç¨‹åºä¸­æ³¨å†Œå…¨å±€storeï¼Œè¯·ä½¿ç”¨StoreModule.forRootï¼ˆï¼‰æ–¹æ³•ä»¥åŠå®šä¹‰æ‚¨çš„stateçš„é”®/å€¼å¯¹çš„æ˜ å°„ã€‚ StoreModule.forRootï¼ˆï¼‰æ³¨å†Œåº”ç”¨ç¨‹åºçš„å…¨å±€æä¾›ç¨‹åºï¼ŒåŒ…æ‹¬æ‚¨æ³¨å…¥åˆ°ç»„ä»¶å’ŒæœåŠ¡ä¸­çš„StoreæœåŠ¡ï¼Œä»¥åˆ†æ´¾æ“ä½œå¹¶é€‰æ‹©çŠ¶æ€</p>
<pre><code>// app.module.ts

import { NgModule } from '@angular/core';
import { StoreModule } from '@ngrx/store';
import * as fromScoreboard from './reducers/scoreboard.reducer';

@NgModule({
  imports: [
    StoreModule.forRoot({ game: fromScoreboard.reducer })
  ],
})
export class AppModule {}
</code></pre>
<p>ä½¿ç”¨StoreModule.forRootï¼ˆï¼‰æ³¨å†Œstateå¯ç¡®ä¿åœ¨åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶å®šä¹‰stateã€‚é€šå¸¸ï¼Œæ‚¨æ³¨å†Œçš„root stateå§‹ç»ˆéœ€è¦ç«‹å³å¯¹åº”ç”¨ç¨‹åºçš„æ‰€æœ‰åŒºåŸŸå¯ç”¨ã€‚</p>
<h5 id="6æ³¨å†ŒåŠŸèƒ½state">6.æ³¨å†ŒåŠŸèƒ½state</h5>
<p>åŠŸèƒ½stateçš„è¡Œä¸ºä¸root stateç›¸åŒï¼Œä½†æ˜¯å…è®¸æ‚¨åœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ç‰¹å®šåŠŸèƒ½åŒºåŸŸå®šä¹‰å®ƒä»¬ã€‚ æ‚¨çš„root stateæ˜¯ä¸€ä¸ªå¤§å¯¹è±¡ï¼Œè€ŒåŠŸèƒ½stateä¼šåœ¨è¯¥å¯¹è±¡ä¸­æ³¨å†Œå…¶ä»–é”®å’Œå€¼ã€‚</p>
<p>è®©æˆ‘ä»¬ä»ä¸€ä¸ªç©ºçš„stateå¯¹è±¡å¼€å§‹ã€‚</p>
<pre><code>import { NgModule } from '@angular/core';
import { StoreModule } from '@ngrx/store';

@NgModule({
  imports: [
    StoreModule.forRoot({})
  ],
})
export class AppModule {}
</code></pre>
<p>è¿™ä¼šå°†æ‚¨çš„åº”ç”¨ç¨‹åºæ³¨å†Œä¸ºroot stateä¸ºç©ºçš„å¯¹è±¡ã€‚</p>
<pre><code>{}
</code></pre>
<p>ç°åœ¨ï¼Œå°†è®°åˆ†æ¿reducerä¸åä¸ºScoreboardModuleçš„NgModuleåŠŸèƒ½ä¸€èµ·ä½¿ç”¨ï¼Œä»¥æ³¨å†Œå…¶ä»–state</p>
<pre><code>// scoreboard.reducer.ts
export const scoreboardFeatureKey = 'game';


// scoreboard.module.ts
import { NgModule } from '@angular/core';
import { StoreModule } from '@ngrx/store';
import * as fromScoreboard from './reducers/scoreboard.reducer';

@NgModule({
  imports: [
    StoreModule.forFeature(fromScoreboard.scoreboardFeatureKey, fromScoreboard.reducer)
  ],
})
export class ScoreboardModule {}
</code></pre>
<p>å°†ScoreboardModuleæ·»åŠ åˆ°AppModuleä»¥åŠ è½½stateã€‚</p>
<pre><code>// app.module.ts
import { NgModule } from '@angular/core';
import { StoreModule } from '@ngrx/store';
import { ScoreboardModule } from './scoreboard/scoreboard.module';

@NgModule({
  imports: [
    StoreModule.forRoot({}),
    ScoreboardModule
  ],
})
export class AppModule {}
</code></pre>
<p>ä¸€æ—¦è®°åˆ†æ¿æ¨¡å—è¢«åŠ è½½ï¼Œgameé”®å°±æˆä¸ºroot stateå¯¹è±¡ä¸­çš„ä¸€ä¸ªå±æ€§ï¼Œå¹¶ä¸”ç°åœ¨å¤„äºstateä¸­è¿›è¡Œç®¡ç†</p>
<pre><code>{
  game: { home: 0, away: 0 }
}
</code></pre>
<p>ç«‹å³åŠ è½½stateè¿˜æ˜¯å»¶è¿ŸåŠ è½½stateå–å†³äºåº”ç”¨ç¨‹åºçš„éœ€æ±‚ã€‚æ‚¨å¯ä»¥ä½¿ç”¨åŠŸèƒ½stateéšç€æ—¶é—´æ¨ç§»å¹¶é€šè¿‡ä¸åŒçš„åŠŸèƒ½æ¨¡å—æ¥æ„å»ºstateå¯¹è±¡ã€‚</p>
<h4 id="selectors">Selectors</h4>
<p>Selectorsæ˜¯ç”¨äºè·å–å­˜å‚¨stateåˆ‡ç‰‡çš„çº¯å‡½æ•°ã€‚ @ ngrx / storeæä¾›äº†ä¸€äº›å¸®åŠ©ç¨‹åºåŠŸèƒ½æ¥ä¼˜åŒ–æ­¤é€‰æ‹©ã€‚é€‰æ‹©stateåˆ‡ç‰‡æ—¶ï¼Œé€‰æ‹©å™¨æä¾›è®¸å¤šåŠŸèƒ½:<br>
å¯ç§»æ¤æ€§ è®°å¿†åŒ– ç»„æˆ å¯æµ‹æ€§ ç±»å‹å®‰å…¨ã€‚<br>
ä½¿ç”¨createSelectorå’ŒcreateFeatureSelectorå‡½æ•°æ—¶ï¼Œ@ ngrx / storeä¼šè·Ÿè¸ªè°ƒç”¨é€‰æ‹©å™¨å‡½æ•°çš„æœ€æ–°å‚æ•°ã€‚ å› ä¸ºé€‰æ‹©å™¨æ˜¯çº¯å‡½æ•°ï¼Œæ‰€ä»¥å½“å‚æ•°åŒ¹é…æ—¶å¯ä»¥è¿”å›æœ€åçš„ç»“æœï¼Œè€Œæ— éœ€é‡æ–°è°ƒç”¨é€‰æ‹©å™¨å‡½æ•°ã€‚ è¿™å¯ä»¥æä¾›æ€§èƒ½ä¼˜åŠ¿ï¼Œå°¤å…¶æ˜¯å¯¹äºæ‰§è¡Œæ˜‚è´µè®¡ç®—çš„é€‰æ‹©å™¨è€Œè¨€ã€‚ è¿™ç§åšæ³•ç§°ä¸ºè®°å¿†ã€‚<br>
å¯¹ä¸€ä¸ªstateä½¿ç”¨é€‰æ‹©å™¨ï¼š</p>
<pre><code>import { createSelector } from '@ngrx/store';

export interface FeatureState {
  counter: number;
}

export interface AppState {
  feature: FeatureState;
}

export const selectFeature = (state: AppState) =&gt; state.feature;

export const selectFeatureCount = createSelector(
  selectFeature,
  (state: FeatureState) =&gt; state.counter
);
</code></pre>
<p>å¯¹å¤šä¸ªçŠ¶æ€ä½¿ç”¨é€‰æ‹©å™¨:<br>
createSelectorå¯ç”¨äºåŸºäºåŒä¸€çŠ¶æ€çš„å¤šä¸ªåˆ‡ç‰‡ä»çŠ¶æ€ä¸­é€‰æ‹©ä¸€äº›æ•°æ®ã€‚<br>
createSelectorå‡½æ•°æœ€å¤šå¯ä»¥ä½¿ç”¨8ä¸ªé€‰æ‹©å™¨å‡½æ•°ï¼Œä»¥è¿›è¡Œæ›´å®Œæ•´çš„çŠ¶æ€é€‰æ‹©ã€‚<br>
ä¾‹å¦‚ï¼Œå‡è®¾æ‚¨åœ¨çŠ¶æ€ä¸­æœ‰ä¸€ä¸ªselectedUserå¯¹è±¡ã€‚ æ‚¨è¿˜å…·æœ‰bookå¯¹è±¡çš„allBooksæ•°ç»„ã€‚<br>
æ‚¨æƒ³æ˜¾ç¤ºå½“å‰ç”¨æˆ·çš„æ‰€æœ‰ä¹¦ç±ã€‚<br>
æ‚¨å¯ä»¥ä½¿ç”¨createSelectoræ¥å®ç°ã€‚ å³ä½¿æ‚¨åœ¨allBooksä¸­å¯¹å…¶è¿›è¡Œäº†æ›´æ–°ï¼Œæ‚¨çš„å¯è§å›¾ä¹¦ä¹Ÿå°†å§‹ç»ˆæ˜¯æœ€æ–°çš„ã€‚ å¦‚æœé€‰æ‹©äº†ä¸€æœ¬ï¼Œå®ƒä»¬å°†å§‹ç»ˆæ˜¾ç¤ºå±äºæ‚¨ç”¨æˆ·çš„å›¾ä¹¦ï¼Œè€Œå½“æœªé€‰æ‹©ä»»ä½•ç”¨æˆ·æ—¶ï¼Œå®ƒä»¬å°†æ˜¾ç¤ºæ‰€æœ‰å›¾ä¹¦ã€‚<br>
ç»“æœå°†åªæ˜¯çŠ¶æ€çš„å¦ä¸€éƒ¨åˆ†è¿‡æ»¤æ‰æ‚¨çš„æŸäº›çŠ¶æ€ã€‚ è€Œä¸”å®ƒå°†æ°¸è¿œæ˜¯æœ€æ–°çš„ã€‚</p>
<pre><code>import { createSelector } from '@ngrx/store';

export interface User {
  id: number;
  name: string;
}

export interface Book {
  id: number;
  userId: number;
  name: string;
}

export interface AppState {
  selectedUser: User;
  allBooks: Book[];
}

export const selectUser = (state: AppState) =&gt; state.selectedUser;
export const selectAllBooks = (state: AppState) =&gt; state.allBooks;

export const selectVisibleBooks = createSelector(
  selectUser,
  selectAllBooks,
  (selectedUser: User, allBooks: Book[]) =&gt; {
    if (selectedUser &amp;&amp; allBooks) {
      return allBooks.filter((book: Book) =&gt; book.userId === selectedUser.id);
    } else {
      return allBooks;
    }
  }
);
</code></pre>
<p>å°†é€‰æ‹©å™¨ä¸propsä¸€èµ·ä½¿ç”¨:<br>
è¦æ ¹æ®storeä¸­ä¸å¯ç”¨çš„æ•°æ®é€‰æ‹©stateï¼Œå¯ä»¥å°†propsä¼ é€’ç»™é€‰æ‹©å™¨åŠŸèƒ½ã€‚ è¿™äº›propsé€šè¿‡æ¯ä¸ªé€‰æ‹©å™¨å’ŒæŠ•å½±ä»ªåŠŸèƒ½ä¼ é€’ã€‚ ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¿…é¡»åœ¨ç»„ä»¶å†…éƒ¨ä½¿ç”¨é€‰æ‹©å™¨æ—¶æŒ‡å®šè¿™äº›propsã€‚<br>
ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ªè®¡æ•°å™¨ï¼Œå¹¶ä¸”æƒ³å°†å…¶å€¼ç›¸ä¹˜ï¼Œåˆ™å¯ä»¥å°†ç›¸ä¹˜å› å­æ·»åŠ ä¸ºpropï¼š<br>
é€‰æ‹©å™¨æˆ–æŠ•å½±ä»ªçš„æœ€åä¸€ä¸ªå‚æ•°æ˜¯propså‚æ•°ï¼Œåœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œå®ƒçœ‹èµ·æ¥å¦‚ä¸‹:</p>
<pre><code>export const getCount = createSelector(
  getCounterValue,
  (counter, props) =&gt; counter * props.multiply
);
</code></pre>
<p>åœ¨ç»„ä»¶å†…éƒ¨ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰propsï¼š</p>
<pre><code>ngOnInit() {
  this.counter = this.store.pipe(select(fromRoot.getCount, { multiply: 2 }))
}
</code></pre>
<p>ä»¥ä¸‹æ˜¯ä½¿ç”¨ä»¥IDåŒºåˆ†çš„å¤šä¸ªè®¡æ•°å™¨çš„ç¤ºä¾‹ã€‚</p>
<pre><code>export const getCount = () =&gt;
  createSelector(
    (state, props) =&gt; state.counter[props.id],
    (counter, props) =&gt; counter * props.multiply
  );
</code></pre>
<p>ç»„ä»¶çš„é€‰æ‹©å™¨ç°åœ¨æ­£åœ¨è°ƒç”¨å·¥å‚å‡½æ•°æ¥åˆ›å»ºä¸åŒçš„é€‰æ‹©å™¨å®ä¾‹ï¼š</p>
<pre><code>ngOnInit() {
  this.counter2 = this.store.pipe(select(fromRoot.getCount(), { id: 'counter2', multiply: 2 }));
  this.counter4 = this.store.pipe(select(fromRoot.getCount(), { id: 'counter4', multiply: 4 }));
  this.counter6 = this.store.pipe(select(fromRoot.getCount(), { id: 'counter6', multiply: 6 }));
}
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Charleså®‰è£…åŠä»£ç†é…ç½®]]></title>
        <id>https://fanguyun214.github.io/post/charles-an-zhuang-ji-dai-li-pei-zhi/</id>
        <link href="https://fanguyun214.github.io/post/charles-an-zhuang-ji-dai-li-pei-zhi/">
        </link>
        <updated>2020-05-21T02:34:31.000Z</updated>
        <summary type="html"><![CDATA[<p>Charlesæ˜¯ä¸€æ¬¾ç”¨äºHTTPä¿¡æ¯æŠ“åŒ…å·¥å…·ï¼Œå¯ä»¥å¿«é€Ÿæœ‰æ•ˆçš„è·å¾—HTTPä¿¡æ¯ï¼Œéå¸¸åˆ©äºå¼€å‘è€…çš„ç½‘é¡µå¼€å‘å’Œè°ƒè¯•ä¿®æ”¹ç­‰ã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>Charlesæ˜¯ä¸€æ¬¾ç”¨äºHTTPä¿¡æ¯æŠ“åŒ…å·¥å…·ï¼Œå¯ä»¥å¿«é€Ÿæœ‰æ•ˆçš„è·å¾—HTTPä¿¡æ¯ï¼Œéå¸¸åˆ©äºå¼€å‘è€…çš„ç½‘é¡µå¼€å‘å’Œè°ƒè¯•ä¿®æ”¹ç­‰ã€‚</p>
<!-- more -->
<h3 id="1-å®‰è£…">1ã€å®‰è£…</h3>
<ul>
<li><a href="https://link.zhihu.com/?target=https%3A//www.charlesproxy.com/download/">å®˜ç½‘ä¸‹è½½</a></li>
</ul>
<p>èœå•æ ã€Charles â†’ help â†’ Registered toã€‘,è¾“å…¥è´¦å·å’Œkeyæ¿€æ´»ä½¿ç”¨æˆæƒç ç”Ÿæˆè®¿é—® https://www.charles.ren/</p>
<figure data-type="image" tabindex="1"><img src="https://i.loli.net/2020/05/21/cYQSWsqdr1gCPZb.png" alt="image2020-5-20 16_35_35" loading="lazy"></figure>
<h3 id="2-charleså®¢æˆ·ç«¯é…ç½®">2. Charleså®¢æˆ·ç«¯é…ç½®</h3>
<p>å®‰è£…å¥½Charlesåï¼Œåœ¨èœå•æ å‹¾é€‰ã€Proxy -&gt; macOS Proxyã€‘ï¼ŒmacOSç³»ç»ŸHTTP/HTTPSä»£ç†å°†ä¼šè¢«è‡ªåŠ¨è®¾ç½®ä¸ºæœ¬åœ°ä»£ç†ï¼Œé»˜è®¤ç«¯å£8888ã€‚</p>
<figure data-type="image" tabindex="2"><img src="https://i.loli.net/2020/05/21/53Ntlp9ofFE8Cbd.png" alt="image2020-5-20 15_40_39" loading="lazy"></figure>
<h3 id="3-æŠ“å–https">3ã€æŠ“å–HTTPS</h3>
<p>åœ¨èœå•æ é€‰æ‹© ã€Help -&gt; SSL Proxying -&gt; Install Charles Root Certificateã€‘ï¼Œä¼šè‡ªåŠ¨å¯¼å…¥ Charles Proxy CA è¯ä¹¦å¹¶æ‰“å¼€ Keychain Access</p>
<figure data-type="image" tabindex="3"><img src="https://i.loli.net/2020/05/21/hDaItHmoKVnQvAF.png" alt="image2020-5-20 15_43_5" loading="lazy"></figure>
<p>åŒå‡»æ–°å¯¼å…¥çš„è¯ä¹¦å¼¹å‡ºè¯ä¹¦ä¿¡æ¯é¡µé¢ï¼Œå°† Secure Sockets Layer(SSL) è®¾ç½®ä¸ºAlways Trustï¼ˆå§‹ç»ˆä¿¡ä»»ï¼‰ï¼Œå…³é—­é¡µé¢åå¼¹å‡ºå¯†ç æç¤ºï¼Œè¾“å…¥å¯†ç æ›´æ–°ç³»ç»Ÿä¿¡ä»»è®¾ç½®</p>
<figure data-type="image" tabindex="4"><img src="https://i.loli.net/2020/05/21/Ze2ECWrqxHlTBuv.png" alt="image2020-5-20 15_45_5" loading="lazy"></figure>
<p>åœ¨èœå•æ é€‰æ‹© ã€Proxy -&gt; SSL Proxy Settingsã€‘ï¼Œåœ¨SSL Proxyingé€‰é¡¹å¡ä¸­å¯ä»¥æ·»åŠ éœ€è¦æŠ“åŒ…çš„åŸŸåç«¯å£</p>
<figure data-type="image" tabindex="5"><img src="https://i.loli.net/2020/05/21/NCnZWAML4zmdrPc.png" alt="image2020-5-20 15_46_46" loading="lazy"></figure>
<h3 id="4-ç§»åŠ¨ç«¯ä»£ç†é…ç½®">4ã€ç§»åŠ¨ç«¯ä»£ç†é…ç½®</h3>
<p>MACå¼€å¯Charlesï¼Œç¡®ä¿ç§»åŠ¨ç«¯å’ŒPCç«¯å¤„äºåŒä¸€å±€åŸŸç½‘</p>
<p>Macå±€åŸŸç½‘åœ°å€å¯ä»¥åœ¨Charlesä¸­ä»èœå•æ ã€Help -&gt; Local IP Addressã€‘è·å–</p>
<figure data-type="image" tabindex="6"><img src="https://i.loli.net/2020/05/21/toAP1QLURwTl8S4.png" alt="image2020-5-20 15_53_8" loading="lazy"></figure>
<p>è®¾ç½®iOS HTTPä»£ç†ï¼Œæ‰“å¼€iOSè®¾å¤‡å¯¹åº”WIFIè®¾ç½®ï¼Œæ·»åŠ ä»£ç†IPåœ°å€ï¼ˆMacçš„å±€åŸŸç½‘åœ°å€ï¼‰å’Œç«¯å£å·ï¼ˆ8888ï¼‰</p>
<figure data-type="image" tabindex="7"><img src="https://i.loli.net/2020/05/21/v1LX6FaNASwzfnk.png" alt="image2020-5-20 15_55_59" loading="lazy"></figure>
<figure data-type="image" tabindex="8"><img src="https://i.loli.net/2020/05/21/eKm6nEFt1jdiVaC.png" alt="image2020-5-20 15_56_31" loading="lazy"></figure>
<p>åœ¨iç§»åŠ¨è®¾å¤‡ä¸Šè®¿é—®æ•°æ®é“¾æ¥ï¼ŒCharles å¼¹å‡º Access Control ç¡®è®¤å¯¹è¯æ¡†ï¼Œé€‰æ‹©Allowï¼Œå¯ä»¥å¼€å§‹æŠ“å–HTTPåŒ…ã€‚</p>
<figure data-type="image" tabindex="9"><img src="https://i.loli.net/2020/05/21/XcAFquGh2Zv9tpO.png" alt="image2020-5-20 16_37_30" loading="lazy"></figure>
<h3 id="4-ç§»åŠ¨ç«¯httpsä»£ç†">4ã€ç§»åŠ¨ç«¯HTTPSä»£ç†</h3>
<p>åœ¨èœå•æ é€‰æ‹© ã€Help -&gt; SSL Proxying -&gt; Install Charles Root Certificate on a Mobile Device or a Remote Browserã€‘ï¼Œå¼¹å‡ºæç¤ºæ¡†ã€‚</p>
<figure data-type="image" tabindex="10"><img src="https://i.loli.net/2020/05/21/VD5ItkNs6PqmB84.png" alt="image2020-5-20 16_0_23" loading="lazy"></figure>
<p>æ ¹æ®ä¸Šè¿°æç¤ºï¼Œåœ¨ç§»åŠ¨ç«¯è®¿é—®<a href="https://link.zhihu.com/?target=http%3A//chls.pro/ssl">//chls.pro/ssl </a>ï¼Œä¸‹è½½è¯ä¹¦å¹¶æç¤ºå®‰è£…ï¼Œæ ¹æ®æç¤ºä¸€æ­¥ä¸€æ­¥å®‰è£…å¥½</p>
<h4 id="41-iosè®¾å¤‡">4.1ã€IOSè®¾å¤‡</h4>
<p>è¯ä¹¦ä¼šè¢«æ·»åŠ åˆ°ã€è®¾ç½® -&gt; é€šç”¨ -&gt; æè¿°æ–‡ä»¶ã€‘ä¸­ã€‚</p>
<figure data-type="image" tabindex="11"><img src="https://i.loli.net/2020/05/21/OxbCkKfRJUzd4G5.png" alt="image2020-5-20 16_38_3" loading="lazy"></figure>
<p>è¿›å…¥ã€è®¾ç½® -&gt; é€šç”¨ -&gt; å…³äºæœ¬æœº -&gt; è¯ä¹¦ä¿¡ä»»è®¾ç½®ã€‘ï¼Œå¯¹ä¸Šä¸€æ­¥å®‰è£…çš„Charlesè¯ä¹¦å¯ç”¨å®Œå…¨ä¿¡ä»»</p>
<figure data-type="image" tabindex="12"><img src="https://i.loli.net/2020/05/21/w9OBpJFb4XZDhsm.png" alt="image2020-5-20 16_38_35" loading="lazy"></figure>
<p>åœ¨iOSè®¾å¤‡ä¸Šè®¿é—®HTTPSæ•°æ®é“¾æ¥ï¼Œå¯ä»¥å¼€å§‹æŠ“å–HTTPSåŒ…</p>
<h4 id="42-å®‰å“è®¾å¤‡">4.2ã€å®‰å“è®¾å¤‡</h4>
<p>åŒä¸Šï¼Œæµè§ˆå™¨æ‰“å¼€ä¸‹è½½è¯ä¹¦åœ°å€</p>
<figure data-type="image" tabindex="13"><img src="https://i.loli.net/2020/05/21/JWLwx8Nd2RfOzov.png" alt="image2020-5-20 16_39_6" loading="lazy"></figure>
<p>è¯ä¹¦ä¸‹è½½æˆåŠŸåï¼ŒæŸ¥çœ‹å·²ä¸‹è½½çš„è¯ä¹¦ï¼Œé€‰æ‹©è¯ä¹¦å®‰è£…ï¼Œè¾“å…¥è¯ä¹¦åç§°ï¼Œè¯ä¹¦å‘½åå¯éšæ„å¡«å†™ï¼Œç¡®å®šåå®‰è£…æˆåŠŸã€‚</p>
<p>å®‰å“ä¸åŒè®¾å¤‡å®‰è£…ä¼šæœ‰æ‰€å·®å¼‚ã€‚</p>
<h3 id="6-å…¶ä»–å·¥å…·">6ã€å…¶ä»–å·¥å…·</h3>
<ul>
<li><a href="https://blog.csdn.net/qq_37711581/article/details/81779825">Fiddler è¯·æ±‚è½¬å‘</a></li>
<li><a href="https://juejin.im/post/5c1b39f6e51d4502a232ca8c">Fiddler Httpsè¯ä¹¦å®‰è£…</a></li>
<li>whistleï¼š<a href="http://wproxy.org/">web é¡¹ç›®è°ƒè¯•</a></li>
</ul>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[å‰ç«¯è·¨å¹³å°è°ƒè¯•]]></title>
        <id>https://fanguyun214.github.io/post/qian-duan-kua-ping-tai-diao-shi/</id>
        <link href="https://fanguyun214.github.io/post/qian-duan-kua-ping-tai-diao-shi/">
        </link>
        <updated>2020-04-27T06:18:10.000Z</updated>
        <summary type="html"><![CDATA[<p>å¦‚ä½•è°ƒè¯•ç§»åŠ¨ç«¯é¡µé¢ä¸€ç›´æ˜¯æ¯”è¾ƒå¤´ç–¼çš„äº‹ã€‚ä¸æ¡Œé¢æµè§ˆå™¨ä¸åŒï¼Œå½“H5é¡µé¢åµŒå…¥åˆ°appåï¼Œæ— æ³•å¾ˆæ–¹ä¾¿åœ°æŒ‰å‡ºF12æ¥æŸ¥çœ‹å…ƒç´ ï¼Œæˆ–è€…æ–­ç‚¹è°ƒè¯•jsã€‚å¦å¤–ï¼Œç§»åŠ¨ç«¯è®¾å¤‡å·®å¼‚åŒ–éå¸¸ä¸¥é‡ï¼Œiphone 6 åˆ° iphone 11ï¼Œandroid æ›´æ˜¯ä¸ç”¨å¤šè¯´ã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>å¦‚ä½•è°ƒè¯•ç§»åŠ¨ç«¯é¡µé¢ä¸€ç›´æ˜¯æ¯”è¾ƒå¤´ç–¼çš„äº‹ã€‚ä¸æ¡Œé¢æµè§ˆå™¨ä¸åŒï¼Œå½“H5é¡µé¢åµŒå…¥åˆ°appåï¼Œæ— æ³•å¾ˆæ–¹ä¾¿åœ°æŒ‰å‡ºF12æ¥æŸ¥çœ‹å…ƒç´ ï¼Œæˆ–è€…æ–­ç‚¹è°ƒè¯•jsã€‚å¦å¤–ï¼Œç§»åŠ¨ç«¯è®¾å¤‡å·®å¼‚åŒ–éå¸¸ä¸¥é‡ï¼Œiphone 6 åˆ° iphone 11ï¼Œandroid æ›´æ˜¯ä¸ç”¨å¤šè¯´ã€‚</p>
<!-- more -->
<h3 id="ç§»åŠ¨ç«¯è°ƒè¯•ç—›ç‚¹">ç§»åŠ¨ç«¯è°ƒè¯•ç—›ç‚¹</h3>
<p>è®¾å¤‡å·®å¼‚ã€ç¯å¢ƒå·®å¼‚ã€ç³»ç»Ÿå·®å¼‚ã€‚PCç«¯æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ŒVS Debugã€‚ç§»åŠ¨ç«¯ï¼Œæˆ‘çš„æ‰‹æœºæ˜¯å¥½çš„ï¼Œæµ‹è¯•å°å§å§è¯´å¥¹çš„æ‰‹æœºæœ‰bugã€‚å¾®ä¿¡å¾®åšç­‰ç¬¬ä¸‰æ–¹ç¯å¢ƒï¼Œæ€ä¹ˆè°ƒè¯•ï¼Ÿ</p>
<h3 id="å¸¸ç”¨è°ƒè¯•æ–¹æ³•">å¸¸ç”¨è°ƒè¯•æ–¹æ³•</h3>
<h4 id="charlesfiddler">Charles/Fiddler</h4>
<p>æŠ“åŒ…å·¥å…·ï¼Œå¯ä»¥æˆªå–åŒ…æ‹¬ <code>https</code> åœ¨å†…çš„å„ç§ç½‘ç»œè¯·æ±‚å¹¶æ–¹ä¾¿çš„æŸ¥çœ‹å…·ä½“ä¿¡æ¯ã€‚é€šè¿‡é…ç½® <code>WIFI</code> ä»£ç†ï¼Œä¹Ÿå¯ä»¥æ‹¦æˆªæ‰‹æœºå‘å‡ºçš„è¯·æ±‚ï¼Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šå¸®åŠ© <code>debug</code>ã€‚è½¯ä»¶ä»˜è´¹ï¼Œè€Œä¸”å®ƒå®šä½ä¸äº† <code>js</code> çš„æŠ¥é”™ï¼Œæ‰€ä»¥åªèƒ½ä½œä¸ºä¸€ä¸ªè¾…åŠ©å·¥å…·ã€‚</p>
<h4 id="android-chromeæµè§ˆå™¨">Android + Chromeæµè§ˆå™¨</h4>
<p>ç¬¬ä¸€æ­¥ï¼šæ‰“å¼€ <code>Android</code> æ‰‹æœº <code>è®¾ç½®</code> &gt; <code>å¼€å‘è€…é€‰é¡¹</code> &gt; <code>USBè°ƒè¯•</code>ã€‚</p>
<p>ç¬¬äºŒæ­¥ï¼šé€šè¿‡æ•°æ®çº¿è¿æ¥ä½ çš„ç”µè„‘å’Œ <code>Android</code> æ‰‹æœºï¼Œå…è®¸USBè°ƒè¯•ã€‚</p>
<p>ç¬¬ä¸‰æ­¥ï¼šAndroid<code>æ‰‹æœºä¸‹è½½ä¸€ä¸ªæ‰‹æœºç‰ˆçš„</code>Chromeæµè§ˆå™¨ï¼Œå¹¶åœ¨æ‰‹æœºä¸Šçš„ <code>Chromeæµè§ˆå™¨</code> ä¸­æ‰“å¼€ä½ éœ€è¦è°ƒè¯•çš„é¡µé¢ã€‚</p>
<p>ç¬¬å››æ­¥ï¼šæ‰“å¼€ç”µè„‘ä¸Šçš„ <code>Chromeæµè§ˆå™¨</code>ï¼Œè¾“å…¥<a href="chrome://inspect/#devices">chrome://inspect/#devices</a></p>
<h4 id="maciossafari">Mac+IOS+Safari</h4>
<p>ç¬¬ä¸€æ­¥ï¼šæ‰“å¼€è‹¹æœæ‰‹æœº <code>è®¾ç½®</code> &gt; <code>Safariæµè§ˆå™¨</code> &gt; <code>é«˜çº§</code> &gt; <code>Webæ£€æŸ¥å™¨</code></p>
<p>ç¬¬äºŒæ­¥ï¼š æ‰“å¼€ <code>Mac</code> ä¸Šçš„ <code>Safariæµè§ˆå™¨</code> &gt; <code>åå¥½è®¾ç½®</code> &gt; <code>é«˜çº§</code> &gt; <code>åœ¨èœå•æ ä¸­æ˜¾ç¤ºâ€œå¼€å‘â€èœå•</code></p>
<p>ç¬¬ä¸‰æ­¥ï¼š ç”¨æ•°æ®çº¿è¿æ¥ä½ çš„ <code>Mac</code> ç”µè„‘å’Œè‹¹æœæ‰‹æœºï¼Œå¹¶é€‰æ‹©ä¿¡ä»»è®¾å¤‡ã€‚ç„¶ååœ¨æ‰‹æœºçš„ <code>Safariæµè§ˆå™¨</code> ä¸­æ‰“å¼€ä½ éœ€è¦è°ƒè¯•çš„é¡µé¢ï¼Œç„¶ååœ¨ç”µè„‘Safariä¸­æ‰“å¼€è°ƒè¯•é¡µé¢ï¼Œèœå• &gt; å¼€å‘ &gt;  è®¾å¤‡åã€‚é€‰æ‹©æ‰“å¼€çš„é¡µé¢ã€‚</p>
<h4 id="vconsole"><a href="https://github.com/Tencent/vConsole">vConsole</a></h4>
<p>è…¾è®¯å‡ºå“çš„ Web è°ƒè¯•é¢æ¿ã€‚<code>vConsole</code> ä¼šåœ¨ä½ ç½‘é¡µä¸­åŠ ä¸€ä¸ªæ‚¬æµ®çš„å°æŒ‰é’®ï¼Œå¯ä»¥ç‚¹å‡»å®ƒæ¥æ‰“å¼€å…³é—­è°ƒè¯•é¢æ¿ï¼Œå¹¶æŸ¥çœ‹ <code>DOM</code>ã€<code>Console</code>ã€<code>Network</code>å’Œ <code>æœ¬åœ°å­˜å‚¨</code> ç­‰ä¿¡æ¯ã€‚åŸºæœ¬å¯ä»¥æ»¡è¶³æ™®é€šå‰ç«¯å¼€å‘çš„éœ€æ±‚ã€‚ä½¿ç”¨æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼Œé€šè¿‡<code>npm</code>å®‰è£…æˆ–è€…ç›´æ¥åœ¨éœ€è¦çš„é¡µé¢å¼•å…¥ <code>jsæ–‡ä»¶</code> ï¼Œç„¶å <code>new VConsole()</code> å°±å¯ä»¥äº†ã€‚</p>
<h4 id="eruda"><a href="https://github.com/liriliri/eruda">Eruda</a></h4>
<p>Eruda æ˜¯ä¸€ä¸ªä¸“ä¸ºæ‰‹æœºç½‘é¡µå‰ç«¯è®¾è®¡çš„è°ƒè¯•é¢æ¿ï¼Œç±»ä¼¼ DevTools çš„è¿·ä½ ç‰ˆï¼Œå…¶ä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼šæ•è· console æ—¥å¿—ã€æ£€æŸ¥å…ƒç´ çŠ¶æ€ã€æ•è·XHRè¯·æ±‚ã€æ˜¾ç¤ºæœ¬åœ°å­˜å‚¨å’Œ Cookie ä¿¡æ¯ç­‰ç­‰ã€‚</p>
<h4 id="weiner"><a href="https://github.com/tvganesh/weiner">weiner</a></h4>
<p>weinreæ˜¯ä¸€æ¬¾å¾ˆä¸é”™çš„ç½‘é¡µæ£€æŸ¥å·¥å…·ï¼Œå¯ä»¥é€šè¿‡åœ¨æœ¬åœ°å¯åŠ¨ä¸€ä¸ª <code>weinre</code> æœåŠ¡ï¼Œå¹¶å‘æ‰‹æœºç½‘é¡µåµŒå…¥ä¸€æ®µ <code>js</code> è„šæœ¬æ¥å®ç°å’Œç”µè„‘çš„é€šä¿¡ï¼Œå·²è¾¾åˆ°ç±»ä¼¼æµè§ˆå™¨å¼€å‘å·¥å…·é‚£æ ·çš„çš„è°ƒè¯•æ•ˆæœï¼Œå®ƒçš„æ“ä½œç•Œé¢å’Œ <code>vConsole</code> å·®ä¸å¤šï¼Œä¸»è¦åŒ…æ‹¬æŸ¥çœ‹ <code>DOM</code>ã€<code>Console</code>ã€<code>Network</code> ç­‰ï¼Œåªä¸è¿‡è¿™ä¸€åˆ‡æ˜¯åœ¨ç”µè„‘ä¸Šæ“ä½œï¼Œè€Œä¸æ˜¯åœ¨æ‰‹æœºä¸Šã€‚</p>
<h3 id="å¸¸è§è°ƒè¯•åœºæ™¯">å¸¸è§è°ƒè¯•åœºæ™¯</h3>
<ol>
<li>
<p>æœ¬åœ°å¼€å‘hostæ˜ å°„ï¼Œå¦‚å¾®ä¿¡ï¼Œå¾®åšæˆæƒï¼Œæ”¯ä»˜åŸŸåå›ºå®š</p>
</li>
<li>
<p>ç‹¬ç«‹H5é¡µé¢çœŸæœºè°ƒè¯•</p>
</li>
<li>
<p>åµŒå…¥ç¬¬ä¸‰æ–¹è°ƒè¯•</p>
</li>
<li>
<p>ç‰¹å®šç¬¬ä¸‰æ–¹ç¯å¢ƒè°ƒè¯•</p>
</li>
<li>
<p>çº¿ä¸Šç¯å¢ƒè°ƒè¯•</p>
</li>
</ol>
<h3 id="è°ƒè¯•å·¥å…·æ¨è">è°ƒè¯•å·¥å…·æ¨è</h3>
<p>whistleæ˜¯åŸºäºNodeå®ç°çš„è·¨å¹³å°webè°ƒè¯•ä»£ç†å·¥å…·ï¼Œä¸»è¦ç”¨äºæŸ¥çœ‹ã€ä¿®æ”¹HTTPã€HTTPSã€Websocketçš„è¯·æ±‚/å“åº”ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºHTTPä»£ç†æœåŠ¡å™¨ä½¿ç”¨ï¼Œwhistleé‡‡ç”¨çš„æ˜¯ç±»ä¼¼é…ç½®ç³»ç»Ÿhostsçš„æ–¹å¼ï¼Œä¸€åˆ‡æ“ä½œéƒ½å¯ä»¥é€šè¿‡é…ç½®å®ç°ï¼Œæ”¯æŒåŸŸåã€è·¯å¾„ã€æ­£åˆ™è¡¨è¾¾å¼ã€é€šé…ç¬¦ã€é€šé…è·¯å¾„ç­‰å¤šç§åŒ¹é…æ–¹å¼ï¼Œä¸”å¯ä»¥é€šè¿‡Nodeæ¨¡å—æ‰©å±•åŠŸèƒ½ã€‚</p>
<p>å®˜æ–¹æ–‡æ¡£ï¼š<a href="http://wproxy.org/whistle/">wproxy.org/whistle/</a></p>
<figure data-type="image" tabindex="1"><img src="https://i.loli.net/2020/04/27/bYWUTVt5Zdv9ceS.png" alt="åŸºæœ¬åŠŸèƒ½" loading="lazy"></figure>
<h4 id="å®‰è£…ä½¿ç”¨">å®‰è£…ä½¿ç”¨</h4>
<ul>
<li>
<p>å®‰è£…</p>
<pre><code class="language-sh">npm install -g whistle
</code></pre>
</li>
<li>
<p>å‘½ä»¤</p>
<pre><code>w2 help

  Usage: whistle &lt;command&gt; [options]

  Commands:

  status              Show the running status of whistle
  use/add [filepath]  Set rules from a specified js file (.whistle.js by default)
  run                 Start a front service
  start               Start a background service
  stop                Stop current background service
  restart             Restart current background service
  help                Display help information
</code></pre>
</li>
<li>
<p>ä½¿ç”¨</p>
<pre><code>// å¯åŠ¨
w2 start
// é‡å¯
w2 stop
// åœæ­¢ 
w2 stop
</code></pre>
</li>
<li>
<p>è®¾ç½®ä»£ç†</p>
<p>1ã€å…¨å±€ä»£ç†</p>
<figure data-type="image" tabindex="2"><img src="https://i.loli.net/2020/04/27/aDqFRKvEsuLzfxn.jpg" alt="img" loading="lazy"></figure>
<p>2ã€æµè§ˆå™¨ä»£ç†</p>
<p>å®‰è£…æµè§ˆå™¨æ’ä»¶ï¼Œå¦‚Chromeï¼š <a href="https://chrome.google.com/webstore/detail/padekgcemlokbadohgkifijomclgjgif">SwitchyOmega</a></p>
<figure data-type="image" tabindex="3"><img src="https://i.loli.net/2020/04/27/2SLrqlR49Dd3AnO.jpg" alt="img" loading="lazy"></figure>
<p>3ã€ç§»åŠ¨ç«¯è®¾ç½®ä»£ç†</p>
<figure data-type="image" tabindex="4"><img src="https://i.loli.net/2020/04/27/S2YI1ZBipPG3hLe.jpg" alt="img" loading="lazy"></figure>
</li>
<li>
<p>è®¿é—®é…ç½®é¡µé¢</p>
<ul>
<li>
<p>æ–¹å¼1ï¼šåŸŸåè®¿é—® http://local.whistlejs.com/</p>
</li>
<li>
<p>æ–¹å¼2ï¼šé€šè¿‡ip+ç«¯å£æ¥è®¿é—®ï¼Œå½¢å¼å¦‚ <code>http://whistleServerIP:whistlePort/</code> e.g. <a href="http://127.0.0.1:8899/">http://127.0.0.1:8899</a></p>
</li>
<li>
<p>æ–¹å¼2ï¼šé€šè¿‡å‘½ä»¤è¡Œå‚æ•° <code>-P xxxx</code> è‡ªå®šä¹‰webuiçš„ç«¯å£(<code>xxxx</code>è¡¨ç¤ºè¦è®¾ç½®çš„ç«¯å£å·)ï¼Œè‡ªå®šä¹‰ç«¯å£æ”¯æŒä¸Šè¿°ä¸¤ç§æ–¹</p>
<p>å¼è®¿é—®ï¼Œä¹Ÿæ”¯æŒ <a href="http://127.0.0.1:xxxx/">http://127.0.0.1:xxxx</a></p>
<figure data-type="image" tabindex="5"><img src="https://i.loli.net/2020/04/27/lNmHR2aipqYOx4e.png" alt="image-20200427121814079" loading="lazy"></figure>
<figure data-type="image" tabindex="6"><img src="https://i.loli.net/2020/04/27/WAZ7qxDLtdHKaVy.png" alt="image-20200427121855918" loading="lazy"></figure>
</li>
</ul>
</li>
<li>
<p>æ³¨å…¥æ–‡ä»¶é…ç½®</p>
<pre><code>w2 add [filepath]
</code></pre>
</li>
</ul>
<h5 id="å¸¸ç”¨åŠŸèƒ½">å¸¸ç”¨åŠŸèƒ½</h5>
<ul>
<li>
<p>Hostæ˜ å°„</p>
<pre><code># hostæ˜ å°„
192.168.0.107 http://checkout.m.xiaodianpu.com
192.168.0.107 http://oauth2.m.xiaodianpu.com
192.168.0.107 http://shop12345678.m.xiaodianpu.com
127.0.0.1 http://shop.m.xiaodianpu.com    # ç›´æ¥çš„hosté…ç½®
192.168.0.107:8081 one.test.com two.test.com         # å¯¹å…¨éƒ¨åŸŸåè·¯å¾„æ›¿æ¢host
192.168.0.107 three.com/ads                # å¯¹ç‰¹å®šçš„è·¯å¾„æ›¿æ¢host
</code></pre>
</li>
<li>
<p>è¯·æ±‚è½¬å‘</p>
<pre><code># è¯·æ±‚è½¬å‘
shop02604127.m.xiaodianpu.com https://shop02604127.m.xiaodianpu.com
oauth2.m.xiaodianpu.com https://oauth2.m.xiaodianpu.com
checkout.m.xiaodianpu.com https://checkout.m.xiaodianpu.com
**.m.xiaodianpu.com https://shop02604127.m.xiaodianpu.com  # æ‰€æœ‰å­åŸŸåè½¬å‘ç”Ÿæ•ˆ
</code></pre>
</li>
<li>
<p>è°ƒè¯•è¿œç¨‹é¡µé¢</p>
<pre><code>https://shop02604127.m.xiaodianpu.com weinre://test
</code></pre>
</li>
<li>
<p>å¼€å¯Erudaï¼Œæ’ä»¶å½¢å¼æ³¨å…¥</p>
<pre><code># å¼€å¯eruda
shop12345678.m.xiaodianpu.com whistle.inspect://e
checkout.m.xiaodianpu.com whistle.inspect://e
</code></pre>
</li>
<li>
<p>å¼€å¯Vconsole, æ’ä»¶å½¢å¼æ³¨å…¥</p>
<pre><code># å¼€å¯eruda
shop12345678.m.xiaodianpu.com whistle.inspect://e
checkout.m.xiaodianpu.com whistle.inspect://e
</code></pre>
</li>
<li>
<p>æ•°æ®Mock</p>
<p>åŸºäº<a href="https://github.com/nuysoft/Mock">Mock.js</a></p>
<pre><code>	
http://mock.local/data.json vase://mock_json_demo
</code></pre>
</li>
<li>
<p>å¼€å¯è·¨åŸŸ</p>
<pre><code># å¼€å¯è·¨åŸŸ
test.com file://{createData.json}
</code></pre>
</li>
<li>
<p>è„šæœ¬æ³¨å…¥</p>
<pre><code># è„šæœ¬æ³¨å…¥
test.com html://Users/fan/xdp-webapp/whistle/debug.html
shop02604127.m.xiaodianpu.com js://Users/fan/xdp-webapp/whistle/debug.js
test.com css://Users/fan/xdp-webapp/whistle/debug.css

</code></pre>
</li>
<li>
<p>é‡å®šå‘</p>
<pre><code># é‡å®šå‘
https://www.baidu.com/ redirect://https://m.xiaodianpu.com

</code></pre>
</li>
<li>
<p>æ›¿æ¢çº¿ä¸Šæ–‡ä»¶</p>
<pre><code>static.seecsee.com/ufs/webapp/3de34c68/main-es2015.ce5beedbe4b13d68c4ab.js file:///Users/fan/xdp-webapp/dist/apps/webapp/browser/main.js
</code></pre>
</li>
<li>
<p>ä¿®æ”¹è¯·æ±‚</p>
<pre><code># ä¿®æ”¹urlå‚æ•°
www.qq.com urlParams://E:\test\params.json        
 
# è¯·æ±‚æ–¹æ³•
www.qq.com method://post
 
# æ·»åŠ è¯·æ±‚å¤´
www.qq.com reqHeaders://(x-a=1&amp;x-b=a%20b)
 
# ä¿®æ”¹referer(ä¿®æ”¹refererå¿«æ·æ–¹æ³•)
www.qq.com referer://http://ke.qq.com/
 
# ä¿®æ”¹cookie(ä¿®æ”¹è¯·æ±‚cookieå¿«æ·æ–¹æ³•)
www.qq.com reqCookie://{reqCookie.json}
 
# ä¿®æ”¹è¯·æ±‚è¡¨å•
www.qq.com params://{form.json}

# ä¿®æ”¹æ¥å£è¿”å›çŠ¶æ€
https://test.com/test statusCode://500
</code></pre>
</li>
<li>
<p>ä¿®æ”¹å“åº”</p>
<pre><code># ä¿®æ”¹å“åº”çŠ¶æ€ç 
www.qq.com statusCode://500 # è¯·æ±‚ä¸ä¼šå‘é€åˆ°åå°æœåŠ¡å™¨ï¼Œå¯ä»¥ç”¨æ¥æ¨¡æ‹Ÿ4xxã€5xxè¯·æ±‚
www.qq.com replaceStatus://404 # è¯·æ±‚è¿”å›åå†ä¿®æ”¹statusCode
 
# æ·»åŠ å“åº”å¤´
www.qq.com resHeaders://(x-res-a=1&amp;x-res-b=a%20b)
 
# ä¿®æ”¹å“åº”ç±»å‹(ä¿®æ”¹å“åº”ç±»å‹çš„å¿«æ·æ–¹æ³•)
www.qq.com resType://text/plain # æˆ–è€…ï¼š www.qq.com resType://text
 
# è¯·æ±‚æ›¿æ¢
www.qq.com https://www.baidu.com
 
# æœ¬åœ°æ›¿æ¢(windowsä¸­ç›®å½•åˆ†å‰²ç¬¦å¯ä»¥ç”¨`\`ï¼Œä¹Ÿå¯ä»¥ç”¨`/`)
www.qq.com file://E:\xxx # ç­‰ä»·äºï¼š file://E:/xxx www.qq.com
# Macæˆ–Linux
www.qq.com file:///User/xxx/test
# å¦‚æœè¦è®©æœ¬åœ°æ²¡æœ‰å¯¹åº”æ–‡ä»¶çš„è¯·æ±‚ç»§ç»­è¯·æ±‚çº¿ä¸Šï¼Œå¯ä»¥é‡‡ç”¨
www.qq.com xfile://E:\xxx
 
# æœ¬åœ°æ›¿æ¢jsonp
www.qq.com tpl://E:\xxx.json # xxx.json: {callback}({&quot;ec&quot;: 0})
www.qq.com xtpl://E:\xxx.json # xxx.json: {callback}({&quot;ec&quot;: 0})
	
# è¯´æ˜ï¼šä¼šæŠŠå†…å®¹ append åˆ°è¯·æ±‚åé¢
http://mydomain.com/style.css resAppend://{myAppend.css}
# è¯´æ˜ï¼šå®Œå…¨æ›¿æ¢è¯·æ±‚å†…å®¹
http://mydomain.com/style.css resBody://{myResBody.css}
 

</code></pre>
</li>
<li>
<p>å¯ç”¨æˆ–ç¦ç”¨ä¸€äº›é…ç½®</p>
<pre><code># æ‹¦æˆªurlé‡Œé¢æœ‰baiduçš„httpsè¯·æ±‚
/baidu/ enable://intercept

# æ‹¦æˆªåŸŸåwww.google.comä¸‹çš„æ‰€æœ‰httpsè¯·æ±‚ï¼Œä¸”ä¸åœ¨Networkä¸Šæ˜¾ç¤º
www.google.com enable://intercept|hide

# ç¦ç”¨è¯·æ±‚çš„ç¼“å­˜ï¼Œåªè¦ç»è¿‡ä»£ç†ä¸”åŒ¹é…åˆ°çš„è¯·æ±‚éƒ½ä¸ä¼šä½¿ç”¨ç¼“å­˜
# è·Ÿ cache åè®®çš„åŒºåˆ«æ˜¯ï¼Œcache åªæ˜¯ç”¨æ¥è®¾ç½®å“åº”çš„ç¼“å­˜å¤´
wwww.test.com disable://cache

# ç¦ç”¨è¯·æ±‚å’Œå“åº”çš„cookie
wwww.test.com disable://cookie # ä¹Ÿå¯ä»¥å†™æˆå¤æ•°å½¢å¼cookies

# åªç¦ç”¨è¯·æ±‚çš„cookie
wwww.test.com disable://reqCookie # ä¹Ÿå¯ä»¥å†™æˆå¤æ•°å½¢å¼reqCookies

# åªç¦ç”¨å“åº”çš„cookie
wwww.test.com disable://resCookie # ä¹Ÿå¯ä»¥å†™æˆå¤æ•°å½¢å¼reqCookies
</code></pre>
</li>
</ul>
<h3 id="æ›´å¤š">æ›´å¤š</h3>
<p>whistleæ›´å¤šä½¿ç”¨åŠæ’ä»¶å¼€å‘è¯·å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š<a href="http://wproxy.org/whistle/">wproxy.org/whistle/</a></p>
<p>é¡¹ç›®ä¸­å…·ä½“çš„é—®é¢˜ï¼Œæ ¹æ®åœºæ™¯ï¼Œé€‰æ‹©åˆé€‚çš„å·¥å…·æ–¹æ³•ï¼Œæ­é…ä½¿ç”¨ï¼</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[æ”¯ä»˜å®æ”¯ä»˜æ¥å…¥]]></title>
        <id>https://fanguyun214.github.io/post/zhi-fu-bao-zhi-fu-jie-ru/</id>
        <link href="https://fanguyun214.github.io/post/zhi-fu-bao-zhi-fu-jie-ru/">
        </link>
        <updated>2020-03-02T10:30:39.000Z</updated>
        <summary type="html"><![CDATA[<p>æ”¯ä»˜å®å¼€æ”¾å¹³å°ï¼Œè‡´åŠ›äºä¸ºå¼€å‘è€…æä¾›æ”¯ä»˜ã€ç†è´¢ã€ä¿¡ç”¨ã€å£ç¢‘å¼€åº—ã€å®‰å…¨ã€è¥é”€ã€ç¤¾äº¤ç­‰å„ç±»èƒ½åŠ›åŠè¡Œä¸šè§£å†³æ–¹æ¡ˆã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>æ”¯ä»˜å®å¼€æ”¾å¹³å°ï¼Œè‡´åŠ›äºä¸ºå¼€å‘è€…æä¾›æ”¯ä»˜ã€ç†è´¢ã€ä¿¡ç”¨ã€å£ç¢‘å¼€åº—ã€å®‰å…¨ã€è¥é”€ã€ç¤¾äº¤ç­‰å„ç±»èƒ½åŠ›åŠè¡Œä¸šè§£å†³æ–¹æ¡ˆã€‚</p>
<!-- more -->
<h4 id="1-æ”¯ä»˜å®åº”ç”¨æ¥å…¥æµç¨‹">1ã€æ”¯ä»˜å®åº”ç”¨æ¥å…¥æµç¨‹</h4>
<table>
<thead>
<tr>
<th>æµç¨‹</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>1ã€åˆ›å»ºåº”ç”¨</td>
<td><a href="https://docs.open.alipay.com/200/105894/">åº”ç”¨ä»‹ç»</a> <a href="https://docs.open.alipay.com/200/105310/">åˆ›å»ºåº”ç”¨</a> åº”ç”¨å®‰å…¨å¼€å‘æŒ‡å— è®¾è®¡è§„èŒƒ</td>
</tr>
<tr>
<td>2ã€å¼€å§‹å¼€å‘</td>
<td>äº†è§£äº§å“ å¿«é€Ÿæ¥å…¥ æ›´å¤šå¸®åŠ©ä¸æ”¯æŒ</td>
</tr>
<tr>
<td>3ã€ä¸Šçº¿ä½¿ç”¨</td>
<td><a href="https://docs.open.alipay.com/200/golive/">ä¸Šçº¿åº”ç”¨</a> ä½¿ç”¨åº”ç”¨ <a href="https://docs.open.alipay.com/200/105314/">ç­¾çº¦åŠŸèƒ½</a> å‘å¸ƒåˆ°æœåŠ¡å¸‚åœº</td>
</tr>
</tbody>
</table>
<h4 id="2-åº”ç”¨ç®€ä»‹">2ã€åº”ç”¨ç®€ä»‹</h4>
<p>é€šè¿‡åˆ›å»ºåº”ç”¨çš„æ–¹å¼æ¥å…¥èš‚èšå„é¡¹äº§å“ï¼ˆå¦‚å½“é¢ä»˜ã€å¼€åº—ã€å‘åˆ¸ã€æœåŠ¡çª—ã€ä½™åˆ©å®ç­‰ï¼‰æ¥å£å¹¶è¿›è¡Œå¼€å‘ã€‚<br>
ç›®å‰å¼€æ”¾å¹³å°çš„åº”ç”¨æŒ‰ä½¿ç”¨å¯¹è±¡åˆ†ä¸ºä¸¤ç±»ï¼šè‡ªç ”å‹åº”ç”¨ å’Œ ç¬¬ä¸‰æ–¹åº”ç”¨ï¼ˆå•†æˆ·æœåŠ¡å‹åº”ç”¨ï¼‰:</p>
<table>
<thead>
<tr>
<th>åº”ç”¨ç±»å‹</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>è‡ªç ”å‹åº”ç”¨</td>
<td>ä½¿ç”¨å¼€æ”¾çš„åŠŸèƒ½ï¼Œä¸ºè‡ªå·±æˆ–è‡ªå·±å…¬å¸å¼€å‘åº”ç”¨ã€‚è‡ªç ”å‹åº”ç”¨åˆ†ä¸ºç½‘é¡µ/ç§»åŠ¨ï¼Œå°ç¨‹åºï¼Œç”Ÿæ´»å·ã€‚</td>
</tr>
<tr>
<td>ç¬¬ä¸‰æ–¹åº”ç”¨</td>
<td>é€‚ç”¨äºæœåŠ¡å•†ï¼Œä¸ºå•†æˆ·å¼€å‘åº”ç”¨ï¼Œæ‹“å±•å•†æˆ·ä½¿ç”¨</td>
</tr>
</tbody>
</table>
<p>å¦‚æœæ‚¨çš„åº”ç”¨ä¸ºç¬¬ä¸‰æ–¹åº”ç”¨ï¼ˆå³ä¾›å•†å®¶ä½¿ç”¨ï¼‰ï¼Œåˆ™éœ€è¦å•†å®¶å¯¹è¯¥åº”ç”¨è¿›è¡Œæˆæƒï¼Œè¯¦ç»†æ­¥éª¤å¯ä»¥å‚è€ƒ <a href="https://docs.alipay.com/isv/10467/xldcyq">ç¬¬ä¸‰æ–¹åº”ç”¨æˆæƒ</a>ã€‚</p>
<pre><code>åˆ›å»ºåº”ç”¨ -&gt; åº”ç”¨é…ç½® -&gt; ä¸Šçº¿åº”ç”¨ -&gt; ç­¾çº¦åŠŸèƒ½ï¼ˆå¦‚æ‰‹æœºç½‘ç«™æ”¯ä»˜ï¼ŒAPPæ”¯ä»˜ç­‰ï¼‰-&gt; å¼€å‘æ¥å…¥å·²ç­¾çº¦åŠŸèƒ½
</code></pre>
<h5 id="-å¼€å‘è€…ä½¿ç”¨æ”¯ä»˜å®è´¦å·ç™»å½•å¼€æ”¾å¹³å°éœ€å®åè®¤è¯çš„æ”¯ä»˜å®è´¦å·æ ¹æ®å®é™…éœ€æ±‚åˆ›å»ºåº”ç”¨å¦‚æ”¯ä»˜åº”ç”¨">- å¼€å‘è€…ä½¿ç”¨æ”¯ä»˜å®è´¦å·<a href="https://auth.alipay.com/login/index.htm?goto=https%3A%2F%2Fopenhome.alipay.com%2Fplatform%2FmanageApp.htm">ç™»å½•å¼€æ”¾å¹³å°</a>ï¼ˆéœ€å®åè®¤è¯çš„æ”¯ä»˜å®è´¦å·ï¼‰ï¼Œæ ¹æ®å®é™…éœ€æ±‚åˆ›å»ºåº”ç”¨ï¼ˆå¦‚â€œæ”¯ä»˜åº”ç”¨â€ï¼‰ã€‚</h5>
<p>è¾“å…¥åç§°ï¼Œä¸Šä¼ åº”ç”¨å›¾æ ‡ï¼Œé€‰æ‹©åº”ç”¨åŠŸèƒ½ï¼ˆå¦‚æ‰‹æœºç½‘ç«™æ”¯ä»˜ï¼ŒAPPæ”¯ä»˜ç­‰ï¼‰ï¼Œ<a href="https://docs.open.alipay.com/291/105971">ä¸‹è½½ç­¾åå·¥å…·</a>ç”Ÿæˆç”Ÿæˆå•†æˆ·åº”ç”¨ç§é’¥å’Œå•†æˆ·åº”ç”¨å…¬é’¥ï¼Œå›åˆ°å¼€æ”¾å¹³å°çš„åº”ç”¨å®Œå–„é¡µé¢ï¼Œç‚¹å‡»è®¾ç½®åº”ç”¨å…¬é’¥ï¼Œæ¥æ”¶éªŒè¯ç ï¼Œè¾“å…¥ä¸Šä¸€æ­¥ç”Ÿæˆçš„å•†æˆ·åº”ç”¨å…¬é’¥ï¼Œç‚¹å‡»ç¡®å®šã€‚ç„¶åä¼šç”Ÿæˆå¯¹åº”çš„æ”¯ä»˜å®å…¬é’¥ï¼Œå•†æˆ·åº”ç”¨å…¬é’¥å’Œæ”¯ä»˜å®å…¬é’¥è¦æ˜ç¡®åŒºåˆ†å¼€ã€‚<br>
<strong>å¼€å‘ä»£ç ä¸­è¦ä½¿ç”¨åˆ° æ”¯ä»˜å®å…¬é’¥  å’Œ å•†æˆ·åº”ç”¨ç§é’¥</strong><br>
æäº¤å®¡æ ¸ï¼Œä¸€å¤©ä¹‹åï¼Œå®¡æ ¸å®Œæˆï¼Œæ˜¾ç¤ºåº”ç”¨ä¸Šçº¿ã€‚ç­¾çº¦é€‰æ‹©çš„åº”ç”¨åŠŸèƒ½ï¼Œå¼€å§‹ä»£ç å¼€å‘ã€‚</p>
<h4 id="3-æ‰‹æœºç½‘ç«™æ”¯ä»˜æ¥å…¥h5ç½‘ç«™">3ã€<a href="https://docs.open.alipay.com/203/105288/">æ‰‹æœºç½‘ç«™æ”¯ä»˜æ¥å…¥(H5ç½‘ç«™)</a></h4>
<h5 id="-31-ä¸šåŠ¡åœºæ™¯">- 3.1ã€ä¸šåŠ¡åœºæ™¯</h5>
<p><strong>ç§»åŠ¨ç½‘é¡µåº”ç”¨æ— éœ€é›†æˆSDKä¹Ÿå¯ä»¥å”¤èµ·æ”¯ä»˜å®å®¢æˆ·ç«¯æ”¯ä»˜ã€‚</strong><br>
åœ¨ç½‘é¡µåº”ç”¨ä¸­è°ƒç”¨æ”¯ä»˜å®æä¾›çš„ç½‘é¡µæ”¯ä»˜æ¥å£ï¼Œæ¥å£ä¼šè°ƒèµ·æ”¯ä»˜å®å®¢æˆ·ç«¯å†…çš„æ”¯ä»˜æ¨¡å—ï¼Œæ­¤æ—¶ä¼šä»å•†å®¶ç½‘é¡µåº”ç”¨è·³è½¬åˆ°æ”¯ä»˜å®å®¢æˆ·ç«¯ä¸­å¹¶å¼€å§‹æ”¯ä»˜ï¼›æ”¯ä»˜å®Œæˆåä¼šè·³è½¬å›å•†å®¶ç½‘é¡µåº”ç”¨å†…ï¼Œæœ€åå•†å®¶å±•ç¤ºæ”¯ä»˜ç»“æœã€‚</p>
<h5 id="-32-æ¥å…¥æ¡ä»¶">- 3.2ã€æ¥å…¥æ¡ä»¶</h5>
<ul>
<li>ç”³è¯·å‰å¿…é¡»æ‹¥æœ‰ç»è¿‡å®åè®¤è¯çš„æ”¯ä»˜å®è´¦æˆ·ï¼›</li>
<li>ä¼ä¸šæˆ–ä¸ªä½“å·¥å•†æˆ·å¯ç”³è¯·ï¼›</li>
<li>éœ€æä¾›çœŸå®æœ‰æ•ˆçš„è¥ä¸šæ‰§ç…§ï¼Œä¸”æ”¯ä»˜å®è´¦æˆ·åç§°éœ€ä¸è¥ä¸šæ‰§ç…§ä¸»ä½“ä¸€è‡´ï¼›</li>
<li>ç½‘ç«™èƒ½æ­£å¸¸è®¿é—®ä¸”é¡µé¢æ˜¾ç¤ºå®Œæ•´ï¼Œç½‘ç«™éœ€è¦æ˜ç¡®ç»è¥å†…å®¹ä¸”æœ‰å®Œæ•´çš„å•†å“ä¿¡æ¯ï¼›</li>
<li>ç½‘ç«™å¿…é¡»é€šè¿‡ICPå¤‡æ¡ˆã€‚å¦‚ä¸ºä¸ªä½“å·¥å•†æˆ·ï¼Œç½‘ç«™å¤‡æ¡ˆä¸»ä½“éœ€è¦ä¸æ”¯ä»˜å®è´¦æˆ·ä¸»ä½“åç§°ä¸€è‡´ï¼›</li>
<li>å¦‚ä¸ºä¸ªä½“å·¥å•†æˆ·ï¼Œåˆ™å›¢è´­ä¸å¼€æ”¾ï¼Œä¸”å¤ç©ã€ç å®ç­‰å¥¢ä¾ˆå“ã€æŠ•èµ„ç±»è¡Œä¸šæ— æ³•ç”³è¯·æœ¬äº§å“ã€‚</li>
<li>è´¹ç‡æŒ‰å•ç¬”è®¡ç®—ï¼›ä¸€èˆ¬è¡Œä¸šè´¹ç‡ï¼š0.6%ï¼›</li>
<li>ç‰¹æ®Šè¡Œä¸šè´¹ç‡ï¼š1.2%ï¼Œç‰¹æ®Šè¡Œä¸šèŒƒå›´åŒ…æ‹¬ï¼šæ‰‹æœºã€é€šè®¯è®¾å¤‡é”€å”®ï¼›å®¶ç”¨ç”µå™¨ï¼›æ•°ç äº§å“åŠé…ä»¶ï¼›ä¼‘é—²æ¸¸æˆï¼›ç½‘ç»œæ¸¸æˆç‚¹å¡ã€æ¸ é“ä»£ç†ï¼›æ¸¸æˆç³»ç»Ÿå•†ï¼›ç½‘æ¸¸å‘¨è¾¹æœåŠ¡ã€äº¤æ˜“å¹³å°ï¼›ç½‘æ¸¸è¿è¥å•†ï¼ˆå«ç½‘é¡µæ¸¸æˆï¼‰</li>
</ul>
<h5 id="-33-å¼€å‘å‰å‡†å¤‡å¿«é€Ÿæ¥å…¥">- 3.3 <a href="https://docs.open.alipay.com/203/107084/">å¼€å‘å‰å‡†å¤‡</a>&amp;<a href="https://docs.open.alipay.com/203/105285/">å¿«é€Ÿæ¥å…¥</a></h5>
<p>1ã€åˆ›å»ºåº”ç”¨å¹¶è·å–APPID</p>
<p>ç™»å½•èš‚èšé‡‘æœå¼€æ”¾å¹³å°ï¼ˆ<a href="open.alipay.com">open.alipay.com</a>ï¼‰ï¼Œç™»è®°ä¸ªäººåº”ç”¨åï¼Œå®¡æ ¸é€šè¿‡å°†ä¼šå¾—åˆ°åº”ç”¨çš„å”¯ä¸€æ ‡è¯†ï¼ˆAPPIDï¼‰ã€‚</p>
<p>2ã€é…ç½®å¯†é’¥</p>
<p>å¼€å‘è€…è°ƒç”¨æ¥å£å‰éœ€è¦å…ˆç”ŸæˆRSAå¯†é’¥ï¼ŒRSAå¯†é’¥åŒ…å«åº”ç”¨ç§é’¥(APP_PRIVATE_KEY)ã€åº”ç”¨å…¬é’¥(APP_PUBLIC_KEYï¼‰ã€‚</p>
<p>è¯¦æƒ…è§ï¼š<a href="https://docs.open.alipay.com/291/105971/">https://docs.open.alipay.com/291/105971/</a></p>
<p>3ã€ä¸‹è½½æœåŠ¡ç«¯SDK</p>
<p>ä¸‹è½½åœ°å€ï¼š<a href="https://docs.open.alipay.com/203/105910/">https://docs.open.alipay.com/203/105910/</a></p>
<p>4ã€æ¥å£è°ƒç”¨é…ç½®</p>
<p>5ã€è°ƒç”¨æ¥å£</p>
<p>æ‰‹æœºç½‘ç«™æ”¯ä»˜äº§å“åŒ…å«ä¸¤ç±»APIï¼š</p>
<p>é¡µé¢è·³è½¬ç±»ï¼šéœ€è¦ä»å‰ç«¯é¡µé¢ä»¥Formè¡¨å•çš„å½¢å¼å‘èµ·è¯·æ±‚ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨è·³è½¬è‡³æ”¯ä»˜å®çš„ç›¸å…³é¡µé¢ï¼ˆä¸€èˆ¬æ˜¯æ”¶é“¶å°æˆ–ç­¾çº¦é¡µé¢ï¼‰ï¼Œç”¨æˆ·åœ¨è¯¥é¡µé¢å®Œæˆç›¸å…³ä¸šåŠ¡æ“ä½œåå†å›è·³åˆ°å•†æˆ·æŒ‡å®šé¡µé¢ã€‚ä¾‹å¦‚æœ¬äº§å“ä¸­çš„æ‰‹æœºç½‘ç«™æ”¯ä»˜æ¥å£alipay.trade.wap.payã€‚</p>
<p>ç³»ç»Ÿè°ƒç”¨ç±»ï¼šç›´æ¥ä»æœåŠ¡ç«¯å‘èµ·HTTPè¯·æ±‚ï¼Œæ”¯ä»˜å®ä¼šåŒæ­¥è¿”å›è¯·æ±‚ç»“æœã€‚ä¾‹å¦‚æœ¬äº§å“ä¸­çš„äº¤æ˜“æŸ¥è¯¢ç­‰é…å¥—APIã€‚<br>
<strong>æ¥å£è°ƒç”¨æµç¨‹</strong><br>
<img src="https://fanguyun214.github.io/post-images/1583145118760.png" alt="" loading="lazy"></p>
<p>ğŸ‘‹ğŸ‘‹ğŸ‘‹ğŸ‘‹</p>
<h5 id="-34-æ‰‹æœºç½‘ç«™æ”¯ä»˜äº§å“åŒ…å«çš„æ¥å£å’Œæè¿°å¦‚ä¸‹">- 3.4ã€æ‰‹æœºç½‘ç«™æ”¯ä»˜äº§å“åŒ…å«çš„æ¥å£å’Œæè¿°å¦‚ä¸‹ï¼š</h5>
<table>
<thead>
<tr>
<th>æ¥å£åç§°</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>alipay.trade.wap.pay æ‰‹æœºç½‘é¡µæ”¯ä»˜æ¥å£</td>
<td>é€šè¿‡æ­¤æ¥å£ä¼ å…¥è®¢å•å‚æ•°ï¼ŒåŒæ—¶å”¤èµ·æ”¯ä»˜å®æ‰‹æœºç½‘é¡µæ”¯ä»˜é¡µé¢</td>
</tr>
<tr>
<td>alipay.trade.close äº¤æ˜“å…³é—­æ¥å£</td>
<td>é€šè¿‡æ­¤æ¥å£å…³é—­æ­¤å‰å·²åˆ›å»ºçš„äº¤æ˜“ï¼Œå…³é—­åï¼Œç”¨æˆ·å°†æ— æ³•ç»§ç»­ä»˜æ¬¾ã€‚ä»…èƒ½å…³é—­åˆ›å»ºåæœªæ”¯ä»˜çš„äº¤æ˜“ã€‚</td>
</tr>
<tr>
<td>alipay.trade.query äº¤æ˜“çŠ¶æ€æŸ¥è¯¢æ¥å£</td>
<td>é€šè¿‡æ­¤æ¥å£æŸ¥è¯¢æŸç¬”äº¤æ˜“çš„çŠ¶æ€ï¼Œäº¤æ˜“çŠ¶æ€ï¼šäº¤æ˜“åˆ›å»ºï¼Œç­‰å¾…ä¹°å®¶ä»˜æ¬¾ï¼›æœªä»˜æ¬¾äº¤æ˜“è¶…æ—¶å…³é—­ï¼Œæˆ–æ”¯ä»˜å®Œæˆåå…¨é¢é€€æ¬¾ï¼›äº¤æ˜“æ”¯ä»˜æˆåŠŸï¼›äº¤æ˜“ç»“æŸï¼Œä¸å¯é€€æ¬¾ã€‚</td>
</tr>
<tr>
<td>alipay.trade.refund äº¤æ˜“é€€æ¬¾æ¥å£</td>
<td>é€šè¿‡æ­¤æ¥å£å¯¹å•ç¬”äº¤æ˜“å®Œæˆé€€æ¬¾æ“ä½œ</td>
</tr>
<tr>
<td>alipay.trade.fastpay.refund.query é€€æ¬¾æŸ¥è¯¢</td>
<td>æŸ¥è¯¢é€€æ¬¾è®¢å•çš„çŠ¶æ€</td>
</tr>
<tr>
<td>alipay.data.dataservice.bill.downloadurl.query è´¦å•æŸ¥è¯¢æ¥å£</td>
<td>è°ƒç”¨æ­¤æ¥å£è·å–è´¦å•çš„ä¸‹è½½é“¾æ¥</td>
</tr>
</tbody>
</table>
<p><a href="https://docs.open.alipay.com/api_1/alipay.trade.wap.pay/">æ‰‹æœºç½‘é¡µæ”¯ä»˜æ¥å£è¯¦ç»†API</a></p>
<h4 id="4-å¦‚ä½•ä½¿ç”¨æ²™ç®±ç¯å¢ƒåšå¼€å‘è°ƒè¯•">4ã€å¦‚ä½•ä½¿ç”¨æ²™ç®±ç¯å¢ƒåšå¼€å‘è°ƒè¯•</h4>
<p>æ²™ç®±ç¯å¢ƒæ˜¯å¼€æ”¾å¹³å°æä¾›ç»™å¼€å‘è€…è°ƒè¯•æ¥å£çš„ç¯å¢ƒï¼Œå…·ä½“æ“ä½œæ­¥éª¤è§<a href="https://docs.open.alipay.com/200/105311">æ²™ç®±æ¥å…¥æŒ‡å—</a>ã€‚<br>
ç›®å‰æ”¯ä»˜å®æ²™ç®±ç¯å¢ƒæ”¯æŒæ‰‹æœºç½‘ç«™æ”¯ä»˜ï¼Œå¹¶ä¸”åœ¨å®‰è£…äº†æ²™ç®±æ”¯ä»˜å®é’±åŒ…åï¼Œå¯ä»¥å”¤èµ·æ²™ç®±æ”¯ä»˜å®é’±åŒ…è¿›è¡Œæ”¯ä»˜ã€‚<br>
åœ¨æ²¡æœ‰åº”ç”¨æˆ–è€…åº”ç”¨è¿˜æœªä¸Šçº¿åŠæœªç­¾çº¦æ”¯ä»˜åŠŸèƒ½æ—¶ï¼Œå¯ä½¿ç”¨æ²™ç®±ç¯å¢ƒåšå¼€å‘è”è°ƒï¼Œè”è°ƒå®Œæˆåï¼Œåˆ‡æ¢å›å•†å®¶åº”ç”¨APPidï¼Œå•†å®¶ç§é’¥ï¼Œå•†å®¶å…¬é’¥ï¼Œæ”¯ä»˜å®å…¬é’¥ï¼Œåšçº¿ä¸ŠçœŸå®é€»è¾‘æµ‹è¯•ã€‚</p>
<pre><code>ä¸‹è½½æ”¯ä»˜å®å¼€æ”¾å¹³å°åŠ©æ‰‹ -&gt; ç”ŸæˆRSAå•†å®¶åº”ç”¨ç§é’¥ã€å…¬é’¥ -&gt; æ²™ç®±ç¯å¢ƒé…ç½®ç”Ÿæˆçš„åº”ç”¨å…¬é’¥è·å–åˆ°æ”¯ä»˜å®å…¬é’¥ -&gt; AliPAySdké…ç½®ç§˜é’¥ -&gt; å®‰è£…æ²™ç®±ç¯å¢ƒæ”¯ä»˜å®APP -&gt; å®¢æˆ·ç«¯ç½‘é¡µè°ƒç”¨æ”¯ä»˜æ¥å£ -&gt; æ‹‰èµ·æ²™ç®±ç¯å¢ƒæ”¯ä»˜å®APP -&gt; å®Œæˆæ”¯ä»˜
</code></pre>
<h4 id="5-å…¶ä»–">5ã€å…¶ä»–</h4>
<ul>
<li><a href="https://developers.alipay.com/developmentAccess/developmentAccess.htm">æ”¯ä»˜å®å¼€å‘è€…ä¸­å¿ƒ</a></li>
<li><a href="https://docs.open.alipay.com/203/105288/">æ‰‹æœºç½‘ç«™æ”¯ä»˜æ–‡æ¡£</a></li>
<li><a href="https://openhome.alipay.com/platform/appDaily.htm?tab=info">æ²™ç®±åº”ç”¨</a></li>
<li><a href="https://docs.open.alipay.com/54/103419">æœåŠ¡ç«¯ SDK</a></li>
<li><a href="https://docs.open.alipay.com/291/105971">RSA ç§˜é’¥</a></li>
<li><a href="https://docs.open.alipay.com/api_1/alipay.trade.wap.pay">æ”¯ä»˜æ¥å£ API</a></li>
<li><a href="https://docs.open.alipay.com/200/ug05sr/">è´¦æˆ·æˆå‘˜ç®¡ç†</a></li>
<li><a href="https://docs.open.alipay.com/291/105971">æ”¯ä»˜å®å¼€æ”¾å¹³å°å¼€å‘åŠ©æ‰‹</a></li>
</ul>
<h4 id="åŸºäºalipaysdkçš„æ²™ç®±ç¯å¢ƒæ”¯ä»˜demo">åŸºäºAliPaySDKçš„æ²™ç®±ç¯å¢ƒæ”¯ä»˜DEMO:</h4>
<p>Demo Repo: <a href="https://github.com/fanguyun214/alipay-node-demo">https://github.com/fanguyun214/alipay-node-demo</a><br>
æ‰«ç ä½“éªŒï¼ˆå¾®ä¿¡ç¯å¢ƒä¸èƒ½æ‹‰èµ·æ”¯ä»˜å®ï¼‰ï¼š<br>
<img src="https://fanguyun214.github.io/post-images/1583893453400.png" alt="" loading="lazy"></p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[HTTPå®¢æˆ·ç«¯ç¼“å­˜]]></title>
        <id>https://fanguyun214.github.io/post/http-ke-hu-duan-huan-cun/</id>
        <link href="https://fanguyun214.github.io/post/http-ke-hu-duan-huan-cun/">
        </link>
        <updated>2020-01-13T02:17:07.000Z</updated>
        <content type="html"><![CDATA[<!-- more -->
<h3 id="httpç¼“å­˜ä½“ç³»">HTTPç¼“å­˜ä½“ç³»</h3>
<table>
<thead>
<tr>
<th>ç­–ç•¥</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>ç¼“å­˜å­˜å‚¨ç­–ç•¥</td>
<td>è¿™ä¸ªç­–ç•¥çš„ä½œç”¨åªæœ‰ä¸€ä¸ªï¼Œç”¨äºå†³å®š Http å“åº”å†…å®¹æ˜¯å¦å¯ç¼“å­˜åˆ°å®¢æˆ·ç«¯</td>
</tr>
<tr>
<td>ç¼“å­˜è¿‡æœŸç­–ç•¥</td>
<td>è¿™ä¸ªç­–ç•¥çš„ä½œç”¨ä¹Ÿåªæœ‰ä¸€ä¸ªï¼Œé‚£å°±æ˜¯å†³å®šå®¢æˆ·ç«¯æ˜¯å¦å¯ç›´æ¥ä»æœ¬åœ°ç¼“å­˜æ•°æ®ä¸­åŠ è½½æ•°æ®å¹¶å±•ç¤ºï¼ˆå¦åˆ™å°±å‘è¯·æ±‚åˆ°æœåŠ¡ç«¯è·å–ï¼‰</td>
</tr>
<tr>
<td>ç¼“å­˜å¯¹æ¯”ç­–ç•¥</td>
<td>å°†ç¼“å­˜åœ¨å®¢æˆ·ç«¯çš„æ•°æ®æ ‡è¯†å‘å¾€æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯é€šè¿‡æ ‡è¯†æ¥åˆ¤æ–­å®¢æˆ·ç«¯ ç¼“å­˜æ•°æ®æ˜¯å¦ä»æœ‰æ•ˆï¼Œè¿›è€Œå†³å®šæ˜¯å¦è¦é‡å‘æ•°æ®ã€‚æµè§ˆå™¨ç¼“å­˜æ§åˆ¶æœºåˆ¶æœ‰ä¸¤ç§ï¼šHTML Metaæ ‡ç­¾ vs. HTTPå¤´ä¿¡æ¯</td>
</tr>
</tbody>
</table>
<h3 id="httpç¼“å­˜æ§åˆ¶">HTTPç¼“å­˜æ§åˆ¶</h3>
<h4 id="html-metaæ ‡ç­¾æ§åˆ¶ç¼“å­˜">HTML Metaæ ‡ç­¾æ§åˆ¶ç¼“å­˜</h4>
<p>æµè§ˆå™¨ç¼“å­˜æœºåˆ¶ï¼Œå…¶å®ä¸»è¦å°±æ˜¯HTTPåè®®å®šä¹‰çš„ç¼“å­˜æœºåˆ¶ï¼ˆå¦‚ï¼š Expiresï¼› Cache-controlç­‰ï¼‰ã€‚ä½†æ˜¯ä¹Ÿæœ‰éHTTPåè®®å®šä¹‰çš„ç¼“å­˜æœºåˆ¶ï¼Œå¦‚ä½¿ç”¨HTML Meta æ ‡ç­¾ï¼Œå¯ä»¥åœ¨HTMLé¡µé¢çš„<head>èŠ‚ç‚¹ä¸­åŠ å…¥<meta>æ ‡ç­¾ï¼Œä»£ç å¦‚ä¸‹ï¼š<br>
ç”¨äºè®¾å®šç½‘é¡µçš„åˆ°æœŸæ—¶é—´ï¼Œä¸€æ—¦è¿‡æœŸåˆ™å¿…é¡»åˆ°æœåŠ¡å™¨ä¸Šé‡æ–°è°ƒç”¨ã€‚éœ€è¦æ³¨æ„çš„æ˜¯å¿…é¡»ä½¿ç”¨GMTæ—¶é—´æ ¼å¼ï¼› <meta http-equiv="Expires" contect="Mon,12 May 2001 00:20:00 GMT"> ç”¨äºè®¾å®šç¦æ­¢æµè§ˆå™¨ä»æœ¬åœ°æœºçš„ç¼“å­˜ä¸­è°ƒé˜…é¡µé¢å†…å®¹ï¼Œè®¾å®šåä¸€æ—¦ç¦»å¼€ç½‘é¡µå°±æ— æ³•ä»Cacheä¸­å†è°ƒå‡ºï¼› <meta http-equiv="Pragma" contect="no-cache"><br>
åªæœ‰éƒ¨åˆ†æµè§ˆå™¨å¯ä»¥æ”¯æŒï¼Œè€Œä¸”æ‰€æœ‰ç¼“å­˜ä»£ç†æœåŠ¡å™¨éƒ½ä¸æ”¯æŒï¼Œå› ä¸ºä»£ç†ä¸è§£æHTMLå†…å®¹æœ¬èº«ã€‚è€Œå¹¿æ³›åº”ç”¨çš„è¿˜æ˜¯ HTTPå¤´ä¿¡æ¯ æ¥æ§åˆ¶ç¼“å­˜ã€‚</p>
<h4 id="httpå¤´ä¿¡æ¯æ§åˆ¶ç¼“å­˜">HTTPå¤´ä¿¡æ¯æ§åˆ¶ç¼“å­˜</h4>
<ul>
<li>æµè§ˆå™¨ç¬¬ä¸€æ¬¡è¯·æ±‚æµç¨‹å›¾ï¼š<br>
<img src="https://fanguyun214.github.io/post-images/1578887871153.png" alt="" loading="lazy"></li>
<li>æµè§ˆå™¨å†æ¬¡è¯·æ±‚</li>
<li><img src="https://fanguyun214.github.io/post-images/1578889619473.png" alt="" loading="lazy"></li>
</ul>
<h3 id="httpåè®®">HTTPåè®®</h3>
<p>httpæŠ¥æ–‡å°±æ˜¯å®¢æˆ·ç«¯ï¼ˆå¦‚æµè§ˆå™¨ï¼‰å’ŒwebæœåŠ¡å™¨é€šä¿¡æ—¶å‘é€å’Œå“åº”çš„çš„æ•°æ®ã€‚<br>
httpè¯·æ±‚ç”±ä¸‰éƒ¨åˆ†ç»„æˆåˆ†åˆ«æ˜¯ï¼š<strong>è¯·æ±‚è¡Œã€æ¶ˆæ¯æŠ¥å¤´ã€è¯·æ±‚æ­£æ–‡</strong><br>
httpå“åº”ä¹Ÿæ˜¯ç”±ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼Œåˆ†åˆ«æ˜¯ï¼š<strong>çŠ¶æ€è¡Œã€æ¶ˆæ¯æŠ¥å¤´ã€å“åº”æ­£æ–‡</strong><br>
ä¸ç¼“å­˜ç›¸å…³çš„ä¿¡æ¯ï¼Œéƒ½åŒ…å«åœ¨æ¶ˆæ¯æŠ¥å¤´(header)ä¸­</p>
<h4 id="ä¸ç¼“å­˜æœ‰å…³çš„header">ä¸ç¼“å­˜æœ‰å…³çš„header</h4>
<p><strong>Requestï¼š</strong></p>
<table>
<thead>
<tr>
<th>å‚æ•°</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>Cache-Control: max-age=0</td>
<td>ä»¥ç§’ä¸ºå•ä½</td>
</tr>
<tr>
<td>If-Modified-Since: Mon, 19 Nov 2012 08:38:01 GMT</td>
<td>ç¼“å­˜æ–‡ä»¶çš„æœ€åä¿®æ”¹æ—¶é—´ã€‚</td>
</tr>
<tr>
<td>If-None-Match: &quot;0693f67a67cc1:0&quot;</td>
<td>ç¼“å­˜æ–‡ä»¶çš„Etagå€¼</td>
</tr>
<tr>
<td>Cache-Control: no-cache</td>
<td>ä¸ä½¿ç”¨ç¼“å­˜</td>
</tr>
<tr>
<td>Pragma: no-cache</td>
<td>ä¸ä½¿ç”¨ç¼“å­˜</td>
</tr>
</tbody>
</table>
<p><strong>Response:</strong></p>
<table>
<thead>
<tr>
<th>å‚æ•°</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>Cache-Control: public</td>
<td>å“åº”è¢«ç¼“å­˜, ä»£ç†æœåŠ¡å™¨å¯ç¼“å­˜</td>
</tr>
<tr>
<td>Cache-Control: private</td>
<td>å“åº”è¢«ç¼“å­˜, åªå®¢æˆ·ç«¯ç¼“å­˜</td>
</tr>
<tr>
<td>Cache-Control:no-cache</td>
<td>æé†’æµè§ˆå™¨è¦ä»æœåŠ¡å™¨æå–æ–‡æ¡£è¿›è¡ŒéªŒè¯</td>
</tr>
<tr>
<td>Cache-Control:no-store</td>
<td>ç»å¯¹ç¦æ­¢ç¼“å­˜ï¼ˆç”¨äºæœºå¯†ï¼Œæ•æ„Ÿæ–‡ä»¶ï¼‰</td>
</tr>
<tr>
<td>Cache-Control: max-age=60</td>
<td>60ç§’ä¹‹åç¼“å­˜è¿‡æœŸï¼ˆç›¸å¯¹æ—¶é—´ï¼‰</td>
</tr>
<tr>
<td>Date: Mon, 19 Nov 2012 08:39:00 GMT</td>
<td>å½“å‰responseå‘é€çš„æ—¶é—´</td>
</tr>
<tr>
<td>Expires: Mon, 19 Nov 2012 08:40:01 GMT</td>
<td>ç¼“å­˜è¿‡æœŸçš„æ—¶é—´ï¼ˆç»å¯¹æ—¶é—´ï¼‰</td>
</tr>
<tr>
<td>Last-Modified: Mon, 19 Nov 2012 08:38:01 GMT</td>
<td>æœåŠ¡å™¨ç«¯æ–‡ä»¶çš„æœ€åä¿®æ”¹æ—¶é—´</td>
</tr>
<tr>
<td>ETag: &quot;20b1add7ec1cd1:0&quot;</td>
<td>æœåŠ¡å™¨ç«¯æ–‡ä»¶çš„Etagå€¼</td>
</tr>
</tbody>
</table>
<h4 id="expires">Expires</h4>
<p>Expiresçš„å€¼ä¸ºwebæœåŠ¡å™¨è¿”å›çš„åˆ°æœŸæ—¶é—´(GMT æ ¼æ—å¨æ²»æ—¶é—´),æµè§ˆå™¨ä¸‹æ¬¡è¯·æ±‚æ—¶é—´å°äºæœåŠ¡å™¨è¿”å›çš„æ—¶é—´åˆ™æµè§ˆå™¨ç›´æ¥ä»ç¼“å­˜ä¸­è·å–æ•°æ®ï¼Œè€Œä¸ç”¨å†æ¬¡å‘é€è¯·æ±‚</p>
<h4 id="cache-control">Cache-Control</h4>
<p>Cache-Controlå¸¸è§çš„å–å€¼æœ‰<strong>privateã€publicã€no-cacheã€max-ageï¼Œno-store</strong><br>
private:å®¢æˆ·ç«¯å¯ä»¥ç¼“å­˜<br>
public :å®¢æˆ·ç«¯å’Œä»£ç†æœåŠ¡å™¨éƒ½å¯ç¼“å­˜<br>
max-age=:ç¼“å­˜å­˜å‚¨çš„æœ€å¤§å‘¨æœŸï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´ç¼“å­˜è¢«è®¤ä¸ºè¿‡æœŸï¼ˆå•ä½ç§’ï¼‰<br>
no-cache:è¿™ä¸ªå¾ˆå®¹æ˜“è®©äººäº§ç”Ÿè¯¯è§£ï¼Œä½¿äººè¯¯ä»¥ä¸ºæ˜¯å“åº”ä¸è¢«ç¼“å­˜ï¼Œå®é™…ä¸ŠCache-Control:no-cacheæ˜¯ä¼šè¢«ç¼“å­˜çš„ï¼Œåªä¸è¿‡æ¯æ¬¡åœ¨å‘æµè§ˆå™¨æä¾›å“åº”æ•°æ®æ—¶ï¼Œæµè§ˆå™¨æ¯æ¬¡éƒ½è¦å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œç”±æœåŠ¡å™¨æ¥å†³ç­–æ¥è¯„ä¼°ç¼“å­˜çš„æœ‰æ•ˆæ€§ã€‚<br>
no-store: æ‰€æœ‰å†…å®¹éƒ½ä¸ç¼“å­˜ï¼ˆçœŸçœŸçš„ä¸ç¼“å­˜ï¼‰<br>
æ›´å¤šè¯¦ç»†çš„Cache-Controlçš„å–å€¼å‚è€ƒMDNæ–‡æ¡£https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Cache-Control</p>
<h4 id="å¼ºåˆ¶ç¼“å­˜expireså’Œcache-controlåŒºåˆ«">å¼ºåˆ¶ç¼“å­˜:Expireså’ŒCache-ControlåŒºåˆ«</h4>
<p>Expireså’ŒCache-controlç§°ä¸ºå¼ºåˆ¶ç¼“å­˜ï¼Œéƒ½æ˜¯åœ¨ç¼“å­˜æœªå¤±æ•ˆæ—¶ï¼Œæµè§ˆå™¨ä¸å‘æœåŠ¡ç«¯å‘èµ·è¯·æ±‚ï¼Œç›´æ¥ä»ç¼“å­˜ä¸­å–æ•°æ®ã€‚<br>
Expiresæ˜¯ä¸Šå¤æ—¶ä»£Http1.0çš„ä¸œè¥¿äº†ï¼Œç°åœ¨é»˜è®¤æµè§ˆå™¨å‡é»˜è®¤ä½¿ç”¨çš„æ˜¯Http1.1äº†ï¼Œæ‰€ä»¥å®ƒçš„ä½œç”¨æ˜¯å¯ä»¥åŸºæœ¬å¿½ç•¥ã€‚Expiresæœ‰ä¸€ä¸ªç¼ºç‚¹ï¼Œå°±æ˜¯è¿”å›çš„æ—¶é—´çš„æœåŠ¡å™¨çš„ç»å¯¹æ—¶é—´ï¼Œç”¨æœ¬åœ°æ—¶é—´å’ŒæœåŠ¡ç«¯æ—¶é—´æ¯”è¾ƒæ˜¯å¦è¿‡æœŸï¼Œæ˜¯ä¸ä¸¥è°¨çš„ï¼Œç”¨æˆ·æ˜¯å¯ä»¥éšä¾¿ä¿®æ”¹æœ¬åœ°æ—¶é—´çš„ï¼Œé‚£è¿™æ ·ç¼“å­˜éšæ—¶å¯ä»¥è¿‡æœŸï¼Œæ‰€ä»¥è¢«Cache-Control:max-age=å–ä»£äº†ï¼Œåœ¨http1.1ä¸­Cache-Controlä¼˜å…ˆçº§é«˜äºExpiresã€‚è½¯ä»¶å·¥ç¨‹çš„ç‰¹ç‚¹æ˜¯å‘ä¸‹å…¼å®¹ï¼ŒExpiresä¸€ç›´å°±æ²¡æœ‰æŠ›å¼ƒï¼Œå¯¹äºä½¿ç”¨http1.0åè®®çš„æµè§ˆå™¨ä»ç„¶æœ‰ä½œç”¨ã€‚</p>
<h4 id="last-modified">Last-Modified</h4>
<p>æœåŠ¡å™¨å“åº”æµè§ˆå™¨è¯·æ±‚ï¼Œå‘Šè¯‰æµè§ˆå™¨èµ„æºçš„æœ€åä¿®æ”¹æ—¶é—´</p>
<h4 id="etag">Etag</h4>
<p>æœåŠ¡å™¨å“åº”è¯·æ±‚æ—¶ï¼Œå‘Šè¯‰å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰å½“å‰è¯·æ±‚çš„èµ„æºåœ¨æœåŠ¡å™¨æ ‡è¯†ï¼ˆEtagçš„ç”Ÿæˆç®—æ³•ç”±æœåŠ¡å™¨å†³å®šï¼Œä¸åŒçš„webæœåŠ¡å™¨ç”Ÿæˆetagçš„ç®—æ³•å¯èƒ½è¿˜ä¸ä¸€æ ·,Httpåè®®å¹¶æ²¡æœ‰è¦æ±‚etagçš„ç”Ÿæˆè§„åˆ™ï¼Œå¦‚æ–‡ä»¶å°çš„æ—¶å€™å¯ä»¥ä½¿ç”¨md5sum sha1sum,æˆ–è€…æ ¹æ®æ–‡ä»¶ä¿®æ”¹æ—¶é—´ï¼Œæ–‡ä»¶å¤§å°ï¼Œæ–‡ä»¶inodeæ–‡ä»¶å±æ€§ç»¼åˆç”Ÿæˆï¼Œè¿™é‡Œä¸åšè¯¦ç»†å™è¿°ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶ç†è§£ä¸ºä¸€ä¸ªèµ„æºçš„å”¯ä¸€æ ‡è¯†ï¼Œåªè¦æ–‡ä»¶å‘ç”Ÿå˜åŒ–Etagçš„å€¼ä¹Ÿå˜åŒ–ã€‚</p>
<h4 id="å¯¹æ¯”ç¼“å­˜last-modifiedif-modified-sinceå’Œetagif-none-match">å¯¹æ¯”ç¼“å­˜:Last-Modified/If-Modified-Sinceå’ŒEtag/If-None-Match</h4>
<p>Last-Modifiedå’ŒEtagç§°ä¸ºå¯¹æ¯”ç¼“å­˜ï¼Œæ‰€è°“å¯¹æ¯”ç¼“å­˜ï¼Œé¡¾æ˜æ€è®®ï¼Œå°±æ˜¯éœ€è¦æœåŠ¡å™¨æ¥æ¯”è¾ƒåˆ¤æ–­ï¼Œæ¥å‘Šè¯‰å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰æ˜¯å¦å¯ä»¥ä½¿ç”¨æœ¬åœ°ç¼“å­˜ï¼Œå¯¹æ¯”ç¼“å­˜ç”Ÿæ•ˆæ—¶ï¼ŒæœåŠ¡å™¨è¿”å›ç»™å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰çš„Http Codeä¸º304,æœåŠ¡å™¨åªæ˜¯è¿”å›çš„http headerä¿¡æ¯ï¼Œå¹¶æ— å“åº”æ­£æ–‡ï¼Œå®¢æˆ·ç«¯é€šè¿‡æœåŠ¡å™¨è¿”å›çš„çŠ¶æ€ç 304ï¼ŒçŸ¥é“æœ¬åœ°ç¼“å­˜å¹¶æ— ä¿®æ”¹ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨æœ¬åœ°ç¼“å­˜ï¼Œè¿™æ ·å¤§å¤§çš„è¾ƒå°‘çš„å®¢æˆ·ç«¯è¯·æ±‚å“åº”æ—¶é—´ã€‚<br>
å¯¹æ¯”ç¼“å­˜å¤§è‡´æµç¨‹æ˜¯è¿™æ ·çš„ï¼Œå½“æµè§ˆå™¨è¯·æ±‚æœåŠ¡å™¨çš„æŸèµ„æºæ—¶, æœåŠ¡å™¨å¾—åˆ°èµ„æºçš„æœ€åä¿®æ”¹æ—¶é—´(Last-Modified)æˆ–æ ¹æ®ä¸€å®šçš„ç®—æ³•ç”Ÿæˆèµ„æºçš„æ ‡è¯†ï¼ˆEtagï¼‰ï¼Œå¹¶å°†Last-Modifiedæˆ–If-Modified-Sinceè¿”å›ç»™æµè§ˆå™¨ï¼Œæµè§ˆå™¨æŠŠLast-Modifiedæˆ–Etag å’Œ èµ„æºå†…å®¹åŒæ—¶ç¼“å­˜åœ¨æœ¬åœ°ï¼Œå½“ä¸‹æ¬¡å†æ¬¡å‘æœåŠ¡å™¨è¯·æ±‚æ­¤èµ„æºæ—¶ï¼Œä¼šå°†If-Modified-Since: Mon, 07 Nov 2016 07:51:11 GMT æˆ–If-None-Match: xxxxxxx&quot;çš„è¯·æ±‚å¤´æŠŠå‘é€ç»™æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨å†æ¬¡è®¡ç®—èµ„æºçš„Last-Modifiedæˆ–Etag,å¦‚æœå’Œå®¢æˆ·ç«¯ä¼ æ¥çš„å€¼æ¯”è¾ƒä¸ç›¸åŒï¼Œåˆ™è¡¨æ˜èµ„æºå‘ç”Ÿäº†å˜åŒ–ï¼Œåˆ™ç»™æµè§ˆå™¨è¿”å›Http Code 200ã€‚å¹¶å°†èµ„æºå†…å®¹è¿”å›ç»™æµè§ˆå™¨ï¼Œå¦‚æœç›¸åŒè¡¨ç¤ºæ²¡æœ‰å˜åŒ–å°±ç»™æµè§ˆå™¨è¿”å›Http Code 304 ï¼Œå¹¶ä¸éœ€è¦è¿”å›èµ„æºå†…å®¹ç»™æµè§ˆå™¨ã€‚<br>
å¯¹äºæµè§ˆå™¨æ¥è¯´çš„è¯ï¼Œä¸€èˆ¬ä¼šåœ¨å¼ºåˆ¶ç¼“å­˜è¿‡æœŸçš„æƒ…å†µä¸‹ï¼ˆæˆ–è€…æŒ‰F5åˆ·æ–°,ä¸åŒçš„æµè§ˆå™¨å¯èƒ½ä¸ä¸€æ ·ï¼Œfirefoxæ˜¯æŒ‰F5ï¼‰å¦‚æœèµ„æºåŸå…ˆçš„å“åº”headerä¸­å¸¦æœ‰Last-Modifiedå’ŒEtagçš„è¯ï¼Œæµè§ˆå™¨è¯·æ±‚æ—¶ä¼šåœ¨è¯·æ±‚headerä¸­å¸¦ä¸ŠIf-Modified-Sinceå’ŒIf-None-Matchã€‚</p>
<h4 id="last-modifiedå’ŒetagåŒºåˆ«">Last-Modifiedå’ŒEtagåŒºåˆ«</h4>
<p>åœ¨è¿™é‡Œï¼Œä¹Ÿè®¸ä½ å¯èƒ½ä¼šé—®ï¼Œé€šè¿‡Last-Modifiedå°±å¯ä»¥çŸ¥é“èµ„æºå†…å®¹æ˜¯å¦å‘ç”Ÿäº†å˜åŒ–ï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦Etagå‘¢ï¼Œè¿™ä¸æ˜¯å¤šæ­¤ä¸€ä¸¾å—ï¼Ÿï¼Œä¸»è¦åŸå› Etagè§£å†³äº†Last-modifiedæ²¡èƒ½è§£å†³çš„é—®é¢˜ï¼ŒEtagæ¯”Last-Modifiedæ›´åŠ ä¸¥è°¨ã€‚<br>
1.ä¸€äº›æ–‡ä»¶ä¹Ÿè®¸ä¼šå‘¨æœŸæ€§çš„æ›´æ”¹ï¼Œä½†æ˜¯ä»–çš„å†…å®¹å¹¶ä¸æ”¹å˜(ä»…ä»…æ”¹å˜çš„ä¿®æ”¹æ—¶é—´)ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¹¶ä¸å¸Œæœ›å®¢æˆ·ç«¯è®¤ä¸ºè¿™ä¸ªæ–‡ä»¶è¢«ä¿®æ”¹äº†<br>
2.æŸäº›æ–‡ä»¶ä¿®æ”¹éå¸¸é¢‘ç¹ï¼Œæ¯”å¦‚åœ¨ç§’ä»¥ä¸‹çš„æ—¶é—´å†…è¿›è¡Œä¿®æ”¹ï¼Œ(æ¯”æ–¹è¯´1så†…ä¿®æ”¹äº†Næ¬¡)ï¼ŒIf-Modified-Sinceèƒ½æ£€æŸ¥åˆ°çš„ç²’åº¦æ˜¯sçº§çš„ï¼Œè¿™ç§ä¿®æ”¹æ— æ³•åˆ¤æ–­<br>
3.å¦‚éœ€è¦å¯¹åŠ¨æ€ç”Ÿæˆçš„å†…å®¹åšç¼“å­˜ï¼Œé‚£å°±å¯ä»¥ç”¨etagæ¥æ§åˆ¶ç¼“å­˜äº†<br>
éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœåŒæ—¶æœ‰Last-Modifiedå’ŒEtagå­˜åœ¨ï¼Œåœ¨å‘é€è¯·æ±‚æ—¶ï¼Œæµè§ˆå™¨ä¼šä¸€æ¬¡æ€§çš„å°†è¿™ä¸¤ä¸ªå€¼éƒ½å‘ç»™æœåŠ¡å™¨ï¼Œæ²¡æœ‰ä¼˜å…ˆçº§ï¼ŒæœåŠ¡å™¨æ˜¯éƒ½æ¯”è¾ƒï¼Œè¿˜æ˜¯åªæ¯”è¾ƒä¸€ä¸ªï¼Œä¸åŒçš„webæœåŠ¡å™¨å¯èƒ½æ¯”è¾ƒé€»è¾‘ä¸ä¸€æ ·å§ã€‚</p>
<h4 id="httpè¯·æ±‚å¤´ä¸­cache-control-no-cacheçš„æ„ä¹‰">Httpè¯·æ±‚å¤´ä¸­Cache-Control: no-cacheçš„æ„ä¹‰</h4>
<p>ä¸€èˆ¬æŒ‰ctrl+f5å¼ºåˆ¶åˆ·æ–°æ—¶ï¼Œè¯·æ±‚å¤´é‡Œé¢éƒ½å¸¦æœ‰Cache-Control: no-cacheï¼Œå…¶å®è¿™æ˜¯è·³è¿‡æœ¬åœ°çš„å¼ºåˆ¶ç¼“å­˜å’Œå‘Šè¯‰æœåŠ¡å™¨è·³è¿‡å¯¹æ¯”ç¼“å­˜ï¼Œä¹Ÿå°±æ˜¯é‡æ–°è¯·æ±‚èµ„æºäº†ã€‚å¯¹äºå‰ç«¯åŒå­¦åœ¨é€šè¿‡GETè¯·æ±‚åç«¯APIæ¥å£æ—¶ï¼Œåœ¨ajaxçš„è¯·æ±‚å¤´ä¸­ç»Ÿä¸€å¸¦ä¸ŠCache-Control: no-cache</p>
<h3 id="ç¼“å­˜ä½“ç³»å…³ç³»">ç¼“å­˜ä½“ç³»å…³ç³»</h3>
<figure data-type="image" tabindex="2"><img src="https://fanguyun214.github.io/post-images/1578896118118.png" alt="" loading="lazy"></figure>
<h3 id="å‡ ç§çŠ¶æ€ç çš„åŒºåˆ«">å‡ ç§çŠ¶æ€ç çš„åŒºåˆ«</h3>
<figure data-type="image" tabindex="3"><img src="https://fanguyun214.github.io/post-images/1578896170202.png" alt="" loading="lazy"></figure>
<h3 id="æ€»ç»“">æ€»ç»“</h3>
<ol>
<li>å¯¹äºå¼ºåˆ¶ç¼“å­˜ï¼ˆ200ï¼‰ï¼ŒæœåŠ¡å™¨é€šçŸ¥æµè§ˆå™¨ä¸€ä¸ªç¼“å­˜æ—¶é—´ï¼Œåœ¨ç¼“å­˜æ—¶é—´å†…ï¼Œä¸‹æ¬¡è¯·æ±‚ï¼Œç›´æ¥ç”¨ç¼“å­˜ï¼Œä¸åœ¨æ—¶é—´å†…ï¼Œæ‰§è¡Œå¯¹æ¯”ç¼“å­˜ç­–ç•¥ã€‚</li>
<li>å¯¹äºå¯¹æ¯”ç¼“å­˜ï¼ˆä¹Ÿç§°304ç¼“å­˜ï¼‰ï¼Œå°†ç¼“å­˜ä¿¡æ¯ä¸­çš„Etagå’ŒLast-Modifiedé€šè¿‡è¯·æ±‚å‘é€ç»™æœåŠ¡å™¨ï¼Œç”±æœåŠ¡å™¨æ ¡éªŒï¼Œè¿”å›304çŠ¶æ€ç æ—¶ï¼Œæµè§ˆå™¨ç›´æ¥ä½¿ç”¨ç¼“å­˜ã€‚</li>
</ol>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[å…¬ä¼—å·&H5å¾®ä¿¡æ”¯ä»˜æ¥å…¥]]></title>
        <id>https://fanguyun214.github.io/post/gong-zhong-hao-andh5-wei-xin-zhi-fu-jie-ru/</id>
        <link href="https://fanguyun214.github.io/post/gong-zhong-hao-andh5-wei-xin-zhi-fu-jie-ru/">
        </link>
        <updated>2019-12-03T02:43:20.000Z</updated>
        <summary type="html"><![CDATA[<p>å•†æˆ·åœ¨å¾®ä¿¡å…¬ä¼—å¹³å°æˆ–å¼€æ”¾å¹³å°æäº¤å¾®ä¿¡æ”¯ä»˜ç”³è¯·ï¼Œå¾®ä¿¡æ”¯ä»˜å·¥ä½œäººå‘˜å®¡æ ¸èµ„æ–™æ— è¯¯åå¼€é€šç›¸åº”çš„å¾®ä¿¡æ”¯ä»˜æƒé™ã€‚å¾®ä¿¡æ”¯ä»˜ç”³è¯·å®¡æ ¸é€šè¿‡åï¼Œå•†æˆ·åœ¨ç”³è¯·èµ„æ–™å¡«å†™çš„é‚®ç®±ä¸­æ”¶å–åˆ°ç”±å¾®ä¿¡æ”¯ä»˜å°åŠ©æ‰‹å‘é€çš„é‚®ä»¶ï¼Œæ­¤é‚®ä»¶åŒ…å«å¼€å‘æ—¶éœ€è¦ä½¿ç”¨çš„æ”¯ä»˜è´¦æˆ·ä¿¡æ¯ã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>å•†æˆ·åœ¨å¾®ä¿¡å…¬ä¼—å¹³å°æˆ–å¼€æ”¾å¹³å°æäº¤å¾®ä¿¡æ”¯ä»˜ç”³è¯·ï¼Œå¾®ä¿¡æ”¯ä»˜å·¥ä½œäººå‘˜å®¡æ ¸èµ„æ–™æ— è¯¯åå¼€é€šç›¸åº”çš„å¾®ä¿¡æ”¯ä»˜æƒé™ã€‚å¾®ä¿¡æ”¯ä»˜ç”³è¯·å®¡æ ¸é€šè¿‡åï¼Œå•†æˆ·åœ¨ç”³è¯·èµ„æ–™å¡«å†™çš„é‚®ç®±ä¸­æ”¶å–åˆ°ç”±å¾®ä¿¡æ”¯ä»˜å°åŠ©æ‰‹å‘é€çš„é‚®ä»¶ï¼Œæ­¤é‚®ä»¶åŒ…å«å¼€å‘æ—¶éœ€è¦ä½¿ç”¨çš„æ”¯ä»˜è´¦æˆ·ä¿¡æ¯ã€‚</p>
<!-- more -->
<p><a href="https://pay.weixin.qq.com/wiki/doc/api/H5.php?chapter=3_1">æ”¯ä»˜è´¦æˆ·è¯´æ˜</a></p>
<h3 id="æ”¯ä»˜æ¥å…¥æµç¨‹">æ”¯ä»˜æ¥å…¥æµç¨‹</h3>
<figure data-type="image" tabindex="1"><img src="https://fanguyun214.github.io/post-images/1578881317795.png" alt="" loading="lazy"></figure>
<h3 id="æ”¯ä»˜åœºæ™¯">æ”¯ä»˜åœºæ™¯</h3>
<h4 id="jsapiå…¬ä¼—å·æ”¯ä»˜">JSAPIï¼ˆå…¬ä¼—å·æ”¯ä»˜ï¼‰</h4>
<p>å•†æˆ·å·²æœ‰H5ç½‘ç«™ï¼Œç”¨æˆ·é€šè¿‡æ¶ˆæ¯æˆ–æ‰«æäºŒç»´ç åœ¨å¾®ä¿¡å†…æ‰“å¼€ç½‘é¡µæ—¶ï¼Œå¯ä»¥è°ƒç”¨å¾®ä¿¡æ”¯ä»˜å®Œæˆä¸‹å•è´­ä¹°çš„æµç¨‹<br>
åªèƒ½ä»å¾®ä¿¡æµè§ˆå™¨ä¸­å‘èµ·<br>
å¯ç”¨å¾®ä¿¡æµè§ˆå™¨å†…ç½®æ–¹æ³•ï¼Œä¸éœ€è¦å¼•å…¥å¾®ä¿¡jssdk<br>
<a href="https://pay.weixin.qq.com/wiki/doc/api/jsapi.php?chapter=7_1">å®˜æ–¹æ–‡æ¡£</a></p>
<h4 id="h5æ”¯ä»˜">H5æ”¯ä»˜</h4>
<p>H5æ”¯ä»˜æ˜¯æŒ‡å•†æˆ·åœ¨å¾®ä¿¡å®¢æˆ·ç«¯å¤–çš„ç§»åŠ¨ç«¯ç½‘é¡µå±•ç¤ºå•†å“æˆ–æœåŠ¡ï¼Œç”¨æˆ·åœ¨å‰è¿°é¡µé¢ç¡®è®¤ä½¿ç”¨å¾®ä¿¡æ”¯ä»˜æ—¶ï¼Œ<br>
å•†æˆ·å‘èµ·æœ¬æœåŠ¡å‘¼èµ·å¾®ä¿¡å®¢æˆ·ç«¯è¿›è¡Œæ”¯ä»˜ã€‚ä¸»è¦ç”¨äºè§¦å±ç‰ˆçš„æ‰‹æœºæµè§ˆå™¨è¯·æ±‚å¾®ä¿¡æ”¯ä»˜çš„åœºæ™¯ã€‚å¯ä»¥æ–¹ä¾¿çš„ä»å¤–éƒ¨æµè§ˆå™¨å”¤èµ·å¾®ä¿¡æ”¯ä»˜<br>
æ”¯ä»˜é…ç½®ï¼šç™»å½•å•†æˆ·å¹³å°--&gt;äº§å“ä¸­å¿ƒ--&gt;æˆ‘çš„äº§å“--&gt;æ”¯ä»˜äº§å“â†’H5æ”¯ä»˜<br>
ç”¨æˆ·ä»éå¾®ä¿¡æµè§ˆå™¨è¿›å…¥å‘èµ·æ”¯ä»˜ï¼Œä¸èƒ½ä»å¾®ä¿¡å®¢æˆ·ç«¯è°ƒèµ·<br>
è¦æ±‚å•†æˆ·å·²æœ‰H5å•†åŸç½‘ç«™ï¼Œå¹¶ä¸”å·²ç»è¿‡ICPå¤‡æ¡ˆ<br>
<a href="https://pay.weixin.qq.com/wiki/doc/api/H5.php?chapter=15_1">å®˜æ–¹æ–‡æ¡£</a></p>
<hr>
<h3 id="jsapiæ”¯ä»˜å…¬ä¼—å·æ”¯ä»˜">JSAPIæ”¯ä»˜ï¼ˆå…¬ä¼—å·æ”¯ä»˜ï¼‰</h3>
<p><strong>æ­¥éª¤ä¸€ï¼šæ·»åŠ å¼€å‘è€…ï¼Œå¾®ä¿¡æˆæƒç™»å½•é…ç½®</strong></p>
<p>æ·»åŠ å¼€å‘è€…<br>
å…¬ä¼—å·ç™»å½•ç®¡ç†åå°ï¼Œå¯ç”¨å¼€å‘è€…ä¸­å¿ƒï¼Œåœ¨å¼€å‘è€…å·¥å…·â€”â€”web å¼€å‘è€…å·¥å…·é¡µé¢ï¼Œå‘å¼€å‘è€…å¾®ä¿¡å·å‘é€ç»‘å®šé‚€è¯·ï¼š<br>
<img src="https://fanguyun214.github.io/post-images/1575341547646.jpeg" alt="" loading="lazy"></p>
<p>å¾®ä¿¡æˆæƒç™»å½•<br>
å¼€å‘è€…éœ€è¦å…ˆåˆ°å…¬ä¼—å¹³å°å®˜ç½‘ä¸­çš„â€œå¼€å‘ - æ¥å£æƒé™ - ç½‘é¡µæœåŠ¡ - ç½‘é¡µå¸å· - ç½‘é¡µæˆæƒè·å–ç”¨æˆ·åŸºæœ¬ä¿¡æ¯â€çš„é…ç½®é€‰é¡¹ä¸­ï¼Œä¿®æ”¹æˆæƒå›è°ƒåŸŸåã€‚è¿™é‡Œå¡«å†™çš„æ˜¯åŸŸåï¼ˆæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼‰ï¼Œè€Œä¸æ˜¯URLï¼Œå› æ­¤è¯·å‹¿åŠ  http:// ç­‰åè®®å¤´ï¼Œæˆæƒå›è°ƒåŸŸåé…ç½®è§„èŒƒä¸ºå…¨åŸŸåï¼Œæ¯”å¦‚éœ€è¦ç½‘é¡µæˆæƒçš„åŸŸå ä¸ºï¼šwww.qq.comï¼Œé…ç½®ä»¥åæ­¤åŸŸåä¸‹é¢çš„é¡µé¢http://www.qq.com/music.html ã€ http://www.qq.com/login.html éƒ½å¯ä»¥è¿›è¡ŒOAuth2.0é‰´æƒã€‚ä½†http://pay.qq.com ã€ http://music.qq.com ã€ http://qq.comæ— æ³•è¿›è¡ŒOAuth2.0é‰´æƒã€‚å›è°ƒåŸŸåæœ€å¤šæ·»åŠ ä¸¤ä¸ªï¼Œéœ€ä¸Šä¼ æŒ‡å®šæ–‡ä»¶è‡³å›è°ƒåŸŸåæ ¹ç›®å½•ï¼š<br>
<img src="https://fanguyun214.github.io/post-images/1575341597303.png" alt="" loading="lazy"></p>
<table>
<thead>
<tr>
<th>scopeå‚æ•°</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>snsapi_base</td>
<td>é™é»˜æˆæƒï¼Œè·å–openidï¼Œç›´æ¥è¿›å…¥ä¸šåŠ¡é¡µé¢ï¼Œç”¨æˆ·æ— æ„ŸçŸ¥</td>
</tr>
<tr>
<td>snsapi_userinfo</td>
<td>éœ€è¦ç”¨æˆ·æ‰‹åŠ¨åŒæ„ï¼Œè·å–ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ï¼Œå¯¹äºå·²å…³æ³¨å…¬ä¼—å·çš„ç”¨æˆ·ï¼Œå¦‚æœç”¨æˆ·ä»å…¬ä¼—å·çš„ä¼šè¯æˆ–è€…è‡ªå®šä¹‰èœå•è¿›å…¥æœ¬å…¬ä¼—å·çš„ç½‘é¡µæˆæƒé¡µï¼Œå³ä½¿æ˜¯scopeä¸ºsnsapi_userinfoï¼Œä¹Ÿæ˜¯é™é»˜æˆæƒï¼Œç”¨æˆ·æ— æ„ŸçŸ¥</td>
</tr>
</tbody>
</table>
<p>å…·ä½“è€Œè¨€ï¼Œç½‘é¡µæˆæƒæµç¨‹åˆ†ä¸ºå››æ­¥ï¼š</p>
<p>1ã€å¼•å¯¼ç”¨æˆ·è¿›å…¥æˆæƒé¡µé¢åŒæ„æˆæƒï¼Œè·å–codeï¼Œæ¥å£ç¤ºä¾‹:</p>
<pre><code>https://open.weixin.qq.com/connect/oauth2/authorize?appid=APPID&amp;redirect_uri=REDIRECT_URI&amp;response_type=code&amp;scope=SCOPE&amp;state=STATE#wechat_redirect
</code></pre>
<p>2ã€é€šè¿‡codeæ¢å–ç½‘é¡µæˆæƒaccess_tokenï¼ˆä¸åŸºç¡€æ”¯æŒä¸­çš„access_tokenä¸åŒï¼‰</p>
<p>3ã€å¦‚æœéœ€è¦ï¼Œå¼€å‘è€…å¯ä»¥åˆ·æ–°ç½‘é¡µæˆæƒaccess_tokenï¼Œé¿å…è¿‡æœŸ</p>
<p>4ã€é€šè¿‡ç½‘é¡µæˆæƒaccess_tokenå’Œopenidè·å–ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ï¼ˆæ”¯æŒUnionIDæœºåˆ¶ï¼‰</p>
<p>å‰ç«¯æˆæƒè·å–codeåé€šè¿‡codeè°ƒç”¨åç«¯æ¥å£è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œéœ€è¦æä¾›AppIdï¼ŒAppSecret</p>
<p><a href="https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/Wechat_webpage_authorization.html">å¾®ä¿¡å®˜æ–¹æ–‡æ¡£</a></p>
<p><strong>æ­¥éª¤äºŒï¼šè®¾ç½®æ”¯ä»˜åŸŸåä¸æ”¯ä»˜å›è°ƒç›®å½•ã€‚</strong></p>
<p>åœ¨å¾®ä¿¡å•†æˆ·å¹³å°ï¼ˆpay.weixin.qq.comï¼‰è®¾ç½®æ‚¨çš„JSAPIæ”¯ä»˜æ”¯ä»˜ç›®å½•ï¼Œè®¾ç½®è·¯å¾„ï¼šå•†æˆ·å¹³å°--&gt;äº§å“ä¸­å¿ƒâ†’å¼€å‘é…ç½®ï¼ŒJSAPIæ”¯ä»˜åœ¨è¯·æ±‚æ”¯ä»˜çš„æ—¶å€™ä¼šæ ¡éªŒè¯·æ±‚æ¥æºæ˜¯å¦æœ‰åœ¨å•†æˆ·å¹³å°åšäº†é…ç½®ï¼Œæ‰€ä»¥å¿…é¡»ç¡®ä¿æ”¯ä»˜ç›®å½•å·²ç»æ­£ç¡®çš„è¢«é…ç½®ï¼Œå¦åˆ™å°†éªŒè¯å¤±è´¥ï¼Œè¯·æ±‚æ”¯ä»˜ä¸æˆåŠŸã€‚</p>
<p>æ”¯ä»˜ç›®å½•é…ç½®<br>
<img src="https://fanguyun214.github.io/post-images/1575341966467.png" alt="" loading="lazy"><br>
è¯·æ±‚ç›®å½•ä¸è®¾ç½®ç›®å½•å¿…é¡»ä¸€è‡´ï¼Œå¦åˆ™éªŒè¯å¤±è´¥ï¼Œæ”¯ä»˜ä¸æˆåŠŸã€‚</p>
<p><strong>æ­¥éª¤ä¸‰ï¼šå¾®ä¿¡å†…è°ƒç”¨æ”¯ä»˜å¯ç”¨å¾®ä¿¡æµè§ˆå™¨å†…ç½®æ–¹æ³•ï¼ˆä¸éœ€è¦å¼•å…¥å¾®ä¿¡jssdkï¼‰</strong>ï¼š</p>
<pre><code>if (typeof WeixinJSBridge === 'undefined') {
    if (document.addEventListener) {
        document.addEventListener('WeixinJSBridgeReady', onBridgeReady, false);
    } else if (document.attachEvent) {
        document.attachEvent('WeixinJSBridgeReady', onBridgeReady);
        document.attachEvent('onWeixinJSBridgeReady', onBridgeReady);
    }
} else {
    WeixinJSBridge.invoke(
        'getBrandWCPayRequest',
        {
        appId: newLevelOrder.appId,
        timeStamp: newLevelOrder.timeStamp, // æ”¯ä»˜ç­¾åæ—¶é—´æˆ³ï¼Œæ³¨æ„å¾®ä¿¡jssdkä¸­çš„æ‰€æœ‰ä½¿ç”¨timestampå­—æ®µå‡ä¸ºå°å†™ã€‚ä½†æœ€æ–°ç‰ˆçš„æ”¯ä»˜åå°ç”Ÿæˆç­¾åä½¿ç”¨çš„timeStampå­—æ®µåéœ€å¤§å†™å…¶ä¸­çš„Så­—ç¬¦
        nonceStr: newLevelOrder.nonceStr, // æ”¯ä»˜ç­¾åéšæœºä¸²ï¼Œä¸é•¿äº 32 ä½
        package: `prepay_id=${newLevelOrder.prePayId}`, // ç»Ÿä¸€æ”¯ä»˜æ¥å£è¿”å›çš„prepay_idå‚æ•°å€¼ï¼Œæäº¤æ ¼å¼å¦‚ï¼šprepay_id=\*\*\*ï¼‰
        signType: 'MD5', // ç­¾åæ–¹å¼ï¼Œé»˜è®¤ä¸º'SHA1'ï¼Œä½¿ç”¨æ–°ç‰ˆæ”¯ä»˜éœ€ä¼ å…¥'MD5'
        paySign: newLevelOrder.paySign, // æ”¯ä»˜ç­¾å
        },
        function(res: any) {
        if (res.err_msg === 'get_brand_wcpay_request:ok') {
            // ä½¿ç”¨ä»¥ä¸Šæ–¹å¼åˆ¤æ–­å‰ç«¯è¿”å›,å¾®ä¿¡å›¢é˜Ÿéƒ‘é‡æç¤ºï¼š
            //res.err_msgå°†åœ¨ç”¨æˆ·æ”¯ä»˜æˆåŠŸåè¿”å›okï¼Œä½†å¹¶ä¸ä¿è¯å®ƒç»å¯¹å¯é ã€‚
            // Toast.info('æ”¯ä»˜æˆåŠŸ', 1, () =&gt; {});
            router.push('/package-buy/pay-success');
        } else if (res.err_msg === 'get_brand_wcpay_request:cancel') {
            Toast.info('å–æ¶ˆæ”¯ä»˜', 1);
        } else if (res.err_msg === 'get_brand_wcpay_request:fail') {
            // Toast.info('æ”¯ä»˜å¤±è´¥', 1);
            router.push(
            `/package-buy/pay-fail?name=${query.name}&amp;price=${query.h5Price}&amp;packid=${query.id}&amp;type=${query.type}`,
            );
        }
        },
    );
}
</code></pre>
<p>ç½‘é¡µç«¯æ¥å£è¯·æ±‚å‚æ•°åˆ—è¡¨ï¼ˆå‚æ•°éœ€è¦é‡æ–°è¿›è¡Œç­¾åè®¡ç®—ï¼Œå‚ä¸ç­¾åçš„å‚æ•°ä¸ºï¼šappIdã€timeStampã€nonceStrã€packageã€signTypeï¼Œå‚æ•°åŒºåˆ†å¤§å°å†™ä¸é¡ºåºã€‚ï¼‰<br>
è°ƒèµ·æ”¯ä»˜è¯·æ±‚å‚æ•°ç”±åç«¯serverè°ƒç”¨ç»Ÿä¸€ä¸‹å•æ¥å£è¿”å›ï¼Œéœ€æä¾›AppIdç­‰ã€‚</p>
<p><a href="https://pay.weixin.qq.com/wiki/doc/api/jsapi.php?chapter=20_1">å¾®ä¿¡æ”¯ä»˜æ¥å£ç­¾åæ ¡éªŒå·¥å…·</a>ï¼Œæ­¤å·¥å…·æ—¨åœ¨å¸®åŠ©å¼€å‘è€…æ£€æµ‹è°ƒç”¨ã€å¾®ä¿¡æ”¯ä»˜æ¥å£APIã€‘æ—¶å‘é€çš„è¯·æ±‚å‚æ•°ä¸­ç”Ÿæˆçš„ç­¾åæ˜¯å¦æ­£ç¡®ã€‚<br>
æœ¬åœ°å¼€å‘ä½¿ç”¨å¼€å‘è€…å·¥å…·ï¼Œå¯ç”¨https://ngrok.com/åšå†…ç½‘ç©¿é€ï¼Œå®ç°æœ¬åœ°æˆæƒå›è°ƒï¼Œæ”¯ä»˜è°ƒèµ·éœ€çœŸæœºç¯å¢ƒ<br>
<a href="https://pay.weixin.qq.com/wiki/doc/api/H5.php?chapter=2_2">å¾®ä¿¡å¹³å°ä¸åè¯è¯´æ˜</a></p>
<hr>
<h3 id="h5æ”¯ä»˜æ¥å…¥">H5æ”¯ä»˜æ¥å…¥</h3>
<p>å¾®ä¿¡å¹³å°ç”³è¯·ï¼šç™»å½•å¾®ä¿¡å•†æˆ·å¹³å°--&gt;äº§å“ä¸­å¿ƒ--&gt;æˆ‘çš„äº§å“--&gt;æ”¯ä»˜äº§å“--&gt; H5æ”¯ä»˜<br>
<img src="https://fanguyun214.github.io/post-images/1575342323250.jpg" alt="" loading="lazy"><br>
ç”³è¯·æµç¨‹ï¼šé€‰æ‹© H5æ”¯ä»˜--&gt;å¡«å†™ H5 æ”¯ä»˜äº§å“è®¾ç½®<br>
<img src="https://fanguyun214.github.io/post-images/1575342372576.jpg" alt="" loading="lazy"><br>
1ï¼‰å†™å…¥å¯¹åº”çš„æ”¯ä»˜åŸŸåï¼ˆæœ€å¤šå¯æ·»åŠ 5ä¸ªï¼‰ï¼ŒåŸŸåå¿…é¡»é€šè¿‡ ICP å¤‡æ¡ˆï¼›å½“åŸŸåå¤‡æ¡ˆä¸»ä½“ä¸å…¬å¸åç§°ä¸ä¸€è‡´ï¼Œéœ€è¦ä¸Šä¼ æˆæƒå‡½ï¼ˆè®¾ç½®é¡µé¢ä¸æ”¯æŒç›´æ¥ä¸Šä¼ ï¼‰ï¼›ä¸Šä¼ æ–¹å¼ï¼šè´¦æˆ·ä¸­å¿ƒ--&gt;ä¼ä¸šè´¦å·--&gt;å…¬å¸ç½‘ç«™ï¼Œè¾“å…¥ç½‘å€ï¼Œä¸Šä¼ æˆæƒå‡½ï¼ˆå®¡æ ¸3-7ä¸ªå·¥ä½œæ—¥ï¼‰<br>
2ï¼‰å¡«å†™å”®å–åœºæ™¯/ä½¿ç”¨äº§å“<br>
3ï¼‰è¾“å…¥äº§å“å¯¹åº”ç½‘ç«™åŸŸå<br>
ç‚¹å‡»æäº¤ç”³è¯·ï¼Œé¡µé¢æç¤ºå®¡æ ¸æ—¶é—´ä¸º3-5ä¸ªå·¥ä½œæ—¥ï¼ˆå®¡æ ¸ç»“æœä¼šåé¦ˆåœ¨æ¶ˆæ¯ä¸­å¿ƒï¼‰</p>
<p><strong>æµç¨‹ï¼š</strong><br>
1ã€ç”¨æˆ·åœ¨å•†æˆ·ä¾§å®Œæˆä¸‹å•ï¼Œä½¿ç”¨å¾®ä¿¡æ”¯ä»˜è¿›è¡Œæ”¯ä»˜<br>
2ã€ç”±å•†æˆ·åå°å‘å¾®ä¿¡æ”¯ä»˜å‘èµ·ä¸‹å•è¯·æ±‚ï¼ˆè°ƒç”¨ç»Ÿä¸€ä¸‹å•æ¥å£ï¼‰æ³¨ï¼šäº¤æ˜“ç±»å‹trade_type=MWEB<br>
3ã€ç»Ÿä¸€ä¸‹å•æ¥å£è¿”å›æ”¯ä»˜ç›¸å…³å‚æ•°ç»™å•†æˆ·åå°ï¼Œå¦‚æ”¯ä»˜è·³è½¬urlï¼ˆå‚æ•°åâ€œmweb_urlâ€ï¼‰ï¼Œå•†æˆ·é€šè¿‡mweb_urlè°ƒèµ·å¾®ä¿¡æ”¯ä»˜ä¸­é—´é¡µ<br>
4ã€ä¸­é—´é¡µè¿›è¡ŒH5æƒé™çš„æ ¡éªŒï¼Œå®‰å…¨æ€§æ£€æŸ¥ï¼ˆæ­¤å¤„å¸¸è§é”™è¯¯è¯·è§ä¸‹æ–‡ï¼‰<br>
5ã€å¦‚æ”¯ä»˜æˆåŠŸï¼Œå•†æˆ·åå°ä¼šæ¥æ”¶åˆ°å¾®ä¿¡ä¾§çš„å¼‚æ­¥é€šçŸ¥<br>
6ã€ç”¨æˆ·åœ¨å¾®ä¿¡æ”¯ä»˜æ”¶é“¶å°å®Œæˆæ”¯ä»˜æˆ–å–æ¶ˆæ”¯ä»˜,è¿”å›å•†æˆ·é¡µé¢ï¼ˆé»˜è®¤ä¸ºè¿”å›æ”¯ä»˜å‘èµ·é¡µé¢ï¼‰<br>
7ã€å•†æˆ·åœ¨å±•ç¤ºé¡µé¢ï¼Œå¼•å¯¼ç”¨æˆ·ä¸»åŠ¨å‘èµ·æ”¯ä»˜ç»“æœçš„æŸ¥è¯¢<br>
8,9ã€å•†æˆ·åå°åˆ¤æ–­æ˜¯å¦æ¥åˆ°æ”¶å¾®ä¿¡ä¾§çš„æ”¯ä»˜ç»“æœé€šçŸ¥ï¼Œå¦‚æ²¡æœ‰ï¼Œåå°è°ƒç”¨æˆ‘ä»¬çš„è®¢å•æŸ¥è¯¢æ¥å£ç¡®è®¤è®¢å•çŠ¶æ€<br>
10ã€å±•ç¤ºæœ€ç»ˆçš„è®¢å•æ”¯ä»˜ç»“æœç»™ç”¨æˆ·</p>
<hr>
<h3 id="ä½¿ç”¨js-sdkå®ç°å…¬ä¼—å·æ”¯ä»˜">ä½¿ç”¨JS-SDKå®ç°å…¬ä¼—å·æ”¯ä»˜</h3>
<p><strong>æ­¥éª¤ä¸€ï¼š åœ¨å…¬ä¼—å·åå°é…ç½®ç›¸å…³å‚æ•°â€œç½‘é¡µæˆæƒåŸŸåâ€ã€â€œJSæ¥å£å®‰å…¨åŸŸåâ€ï¼Œåœ¨å•†æˆ·åå°é…ç½®â€œæ”¯ä»˜æˆæƒç›®å½•â€ã€‚</strong></p>
<table>
<thead>
<tr>
<th>å‚æ•°åç§°</th>
<th>é…ç½®åœ°å€</th>
<th>æ„ä¹‰</th>
<th>å¯é…ç½®ä¸ªæ•°</th>
</tr>
</thead>
<tbody>
<tr>
<td>ç½‘é¡µæˆæƒåŸŸå</td>
<td>å…¬ä¼—å·åå°-å…¬ä¼—å·è®¾ç½®-åŠŸèƒ½è®¾ç½®</td>
<td>åœ¨è·å–codeçš„æ¥å£ä¸­é…ç½®çš„redirect_uriå¿…é¡»åœ¨è¿™ä¸ªåŸŸåä¸‹</td>
<td>2ä¸ª</td>
</tr>
<tr>
<td>JSæ¥å£å®‰å…¨åŸŸå</td>
<td>å…¬ä¼—å·åå°-å…¬ä¼—å·è®¾ç½®-åŠŸèƒ½è®¾ç½®</td>
<td>è°ƒç”¨å¾®ä¿¡å¼€æ”¾çš„JSæ¥å£çš„é¡µé¢å¿…é¡»åœ¨æ­¤åŸŸåä¸‹</td>
<td>3ä¸ª</td>
</tr>
<tr>
<td>æ”¯ä»˜æˆæƒç›®å½•</td>
<td>äº§å“ä¸­å¿ƒ-å¼€å‘é…ç½®-æ”¯ä»˜æˆæƒç›®å½•</td>
<td>è°ƒèµ·å¾®ä¿¡æ”¯ä»˜çš„é¡µé¢æ‰€åœ¨çš„ç›®å½•</td>
<td>5ä¸ª</td>
</tr>
</tbody>
</table>
<p><strong>æ­¥éª¤äºŒï¼šåœ¨éœ€è¦è°ƒç”¨JSæ¥å£çš„é¡µé¢å¼•å…¥JS-SDK</strong>: <script src="https://res.wx.qq.com/open/js/jweixin-1.4.0.js"></script>ã€‚</p>
<p><strong>æ­¥éª¤ä¸‰ï¼šé€šè¿‡configæ¥å£æ³¨å…¥æƒé™éªŒè¯é…ç½®ã€‚</strong></p>
<p>æ‰€æœ‰éœ€è¦ä½¿ç”¨JS-SDKçš„é¡µé¢å¿…é¡»å…ˆæ³¨å…¥é…ç½®ä¿¡æ¯ï¼Œå¦åˆ™å°†æ— æ³•è°ƒç”¨ï¼ˆåŒä¸€ä¸ªurlä»…éœ€è°ƒç”¨ä¸€æ¬¡ï¼Œå¯¹äºå˜åŒ–urlçš„SPAçš„web appå¯åœ¨æ¯æ¬¡urlå˜åŒ–æ—¶è¿›è¡Œè°ƒç”¨ï¼Œç›®å‰Androidå¾®ä¿¡å®¢æˆ·ç«¯ä¸æ”¯æŒpushStateçš„H5æ–°ç‰¹æ€§ï¼Œæ‰€ä»¥ä½¿ç”¨pushStateæ¥å®ç°web appçš„é¡µé¢ä¼šå¯¼è‡´ç­¾åå¤±è´¥ï¼Œæ­¤é—®é¢˜ä¼šåœ¨Android6.2ä¸­ä¿®å¤ï¼‰ã€‚</p>
<pre><code>wx.config({
    debug: true, // å¼€å¯è°ƒè¯•æ¨¡å¼,è°ƒç”¨çš„æ‰€æœ‰apiçš„è¿”å›å€¼ä¼šåœ¨å®¢æˆ·ç«¯alertå‡ºæ¥ï¼Œè‹¥è¦æŸ¥çœ‹ä¼ å…¥çš„å‚æ•°ï¼Œå¯ä»¥åœ¨pcç«¯æ‰“å¼€ï¼Œå‚æ•°ä¿¡æ¯ä¼šé€šè¿‡logæ‰“å‡ºï¼Œä»…åœ¨pcç«¯æ—¶æ‰ä¼šæ‰“å°ã€‚
    appId: '', // å¿…å¡«ï¼Œå…¬ä¼—å·çš„å”¯ä¸€æ ‡è¯†
    timestamp: , // å¿…å¡«ï¼Œç”Ÿæˆç­¾åçš„æ—¶é—´æˆ³
    nonceStr: '', // å¿…å¡«ï¼Œç”Ÿæˆç­¾åçš„éšæœºä¸²
    signature: '',// å¿…å¡«ï¼Œç­¾å
    jsApiList: [] // å¿…å¡«ï¼Œéœ€è¦ä½¿ç”¨çš„JSæ¥å£åˆ—è¡¨
});
</code></pre>
<p><strong>æ­¥éª¤å››ï¼šé€šè¿‡readyæ¥å£å¤„ç†æˆåŠŸéªŒè¯ã€é€šè¿‡erroræ¥å£å¤„ç†å¤±è´¥éªŒè¯ã€‚</strong></p>
<pre><code>wx.ready(function () {
    wx.checkJsApi({
        jsApiList: ['chooseWXPay'], // éœ€è¦æ£€æµ‹çš„JSæ¥å£åˆ—è¡¨ï¼Œæ‰€æœ‰JSæ¥å£åˆ—è¡¨è§é™„å½•2,
        success: function () {
        // ä»¥é”®å€¼å¯¹çš„å½¢å¼è¿”å›ï¼Œå¯ç”¨çš„apiå€¼trueï¼Œä¸å¯ç”¨ä¸ºfalse
        // å¦‚ï¼š{&quot;checkResult&quot;:{&quot;chooseImage&quot;:true},&quot;errMsg&quot;:&quot;checkJsApi:ok&quot;}
        }
    });
});
</code></pre>
<p>configä¿¡æ¯éªŒè¯åä¼šæ‰§è¡Œreadyæ–¹æ³•ï¼Œæ‰€æœ‰æ¥å£è°ƒç”¨éƒ½å¿…é¡»åœ¨configæ¥å£è·å¾—ç»“æœä¹‹åï¼Œconfigæ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯çš„å¼‚æ­¥æ“ä½œï¼Œæ‰€ä»¥å¦‚æœéœ€è¦åœ¨é¡µé¢åŠ è½½æ—¶å°±è°ƒç”¨ç›¸å…³æ¥å£ï¼Œåˆ™é¡»æŠŠç›¸å…³æ¥å£æ”¾åœ¨readyå‡½æ•°ä¸­è°ƒç”¨æ¥ç¡®ä¿æ­£ç¡®æ‰§è¡Œã€‚å¯¹äºç”¨æˆ·è§¦å‘æ—¶æ‰è°ƒç”¨çš„æ¥å£ï¼Œåˆ™å¯ä»¥ç›´æ¥è°ƒç”¨ï¼Œä¸éœ€è¦æ”¾åœ¨readyå‡½æ•°ä¸­ã€‚</p>
<pre><code>wx.error(function(res){
    // configä¿¡æ¯éªŒè¯å¤±è´¥ä¼šæ‰§è¡Œerrorå‡½æ•°ï¼Œå¦‚ç­¾åè¿‡æœŸå¯¼è‡´éªŒè¯å¤±è´¥ï¼Œå…·ä½“é”™è¯¯ä¿¡æ¯å¯ä»¥æ‰“å¼€         configçš„debugæ¨¡å¼æŸ¥çœ‹ï¼Œä¹Ÿå¯ä»¥åœ¨è¿”å›çš„reså‚æ•°ä¸­æŸ¥çœ‹ï¼Œå¯¹äºSPAå¯ä»¥åœ¨è¿™é‡Œæ›´æ–°ç­¾åã€‚
});
</code></pre>
<p><strong>æ­¥éª¤äº”ï¼šå‘èµ·ä¸€ä¸ªå¾®ä¿¡æ”¯ä»˜è¯·æ±‚ã€‚</strong></p>
<pre><code>wx.chooseWXPay({
  timestamp: 0, // æ”¯ä»˜ç­¾åæ—¶é—´æˆ³ï¼Œæ³¨æ„å¾®ä¿¡jssdkä¸­çš„æ‰€æœ‰ä½¿ç”¨timestampå­—æ®µå‡ä¸ºå°å†™ã€‚ä½†æœ€æ–°ç‰ˆçš„æ”¯ä»˜åå°ç”Ÿæˆç­¾åä½¿ç”¨çš„timeStampå­—æ®µåéœ€å¤§å†™å…¶ä¸­çš„Så­—ç¬¦
  nonceStr: '', // æ”¯ä»˜ç­¾åéšæœºä¸²ï¼Œä¸é•¿äº 32 ä½
  package: '', // ç»Ÿä¸€æ”¯ä»˜æ¥å£è¿”å›çš„prepay_idå‚æ•°å€¼ï¼Œæäº¤æ ¼å¼å¦‚ï¼šprepay_id=\*\*\*ï¼‰
  signType: '', // ç­¾åæ–¹å¼ï¼Œé»˜è®¤ä¸º'SHA1'ï¼Œä½¿ç”¨æ–°ç‰ˆæ”¯ä»˜éœ€ä¼ å…¥'MD5'
  paySign: '', // æ”¯ä»˜ç­¾å
  success: function (res) {
    // æ”¯ä»˜æˆåŠŸåçš„å›è°ƒå‡½æ•°
  }
});
</code></pre>
<p>å‚æ•°é€šè¿‡ç»Ÿä¸€ä¸‹å•æ¥å£æ‹¿åˆ°ï¼ŒpaySign é‡‡ç”¨ç»Ÿä¸€çš„å¾®ä¿¡æ”¯ä»˜ Sign ç­¾åç”Ÿæˆæ–¹æ³•ï¼Œæ³¨æ„è¿™é‡Œ appId ä¹Ÿè¦å‚ä¸ç­¾åï¼ŒappId ä¸ config ä¸­ä¼ å…¥çš„ appId ä¸€è‡´ï¼Œå³æœ€åå‚ä¸ç­¾åçš„å‚æ•°æœ‰appId, timeStamp, nonceStr, package, signTypeã€‚</p>
<p><a href="https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/JS-SDK.html">JS-SDKä½¿ç”¨æ–‡æ¡£</a></p>
]]></content>
    </entry>
</feed>